Transformer升级之路：4、二维位置的旋转式位置编码 - 科学空间|Scientific Spaces
![MobileSideBar](https://kexue.fm/usr/themes/geekg/images/slide-button.png "MobileSideBar")
## SEARCH
## MENU
* [打赏](https://kexue.fm/reward.html)
* [公式](https://kexue.fm/latex.html)
* [天象](https://kexue.fm/ac.html)
* [链接](https://kexue.fm/links.html)
* [时光](https://kexue.fm/me.html)
* [博览](https://kexue.fm/science.html)
* [归档](https://kexue.fm/content.html)
## CATEGORIES
* [千奇百怪](https://kexue.fm/category/Everything)
* [天文探索](https://kexue.fm/category/Astronomy)
* [数学研究](https://kexue.fm/category/Mathematics)
* [物理化学](https://kexue.fm/category/Phy-chem)
* [信息时代](https://kexue.fm/category/Big-Data)
* [生物自然](https://kexue.fm/category/Biology)
* [图片摄影](https://kexue.fm/category/Photograph)
* [问题百科](https://kexue.fm/category/Questions)
* [生活/情感](https://kexue.fm/category/Life-Feeling)
* [资源共享](https://kexue.fm/category/Resources)
## NEWPOSTS
* [让炼丹更科学一些（四）：新恒等式，...](https://kexue.fm/archives/11494)
* [为什么DeltaNet要加L2 N...](https://kexue.fm/archives/11486)
* [让炼丹更科学一些（三）：SGD的终...](https://kexue.fm/archives/11480)
* [让炼丹更科学一些（二）：将结论推广...](https://kexue.fm/archives/11469)
* [滑动平均视角下的权重衰减和学习率](https://kexue.fm/archives/11459)
* [生成扩散模型漫谈（三十一）：预测数...](https://kexue.fm/archives/11428)
* [Muon优化器指南：快速上手与关键细节](https://kexue.fm/archives/11416)
* [AdamW的Weight RMS的...](https://kexue.fm/archives/11404)
* [n个正态随机数的最大值的渐近估计](https://kexue.fm/archives/11390)
* [流形上的最速下降：5. 对偶梯度下降](https://kexue.fm/archives/11388)
## COMMENTS
* [且寻: same。本来想转成二重积分的，但想半天整不出来，搞出来这个半...](https://kexue.fm/archives/11480/comment-page-1#comment-29057)
* [苏剑林: 是梯度均值为零的假设。这个问题不是在“数值模拟”一节讨论过了吗...](https://kexue.fm/archives/11267/comment-page-1#comment-29056)
* [苏剑林: X与单位阵的平均平方误差(mse)，作为它跟单位阵的差距，有什...](https://kexue.fm/archives/7180/comment-page-2#comment-29055)
* [苏剑林: 从公式$(12)$到公式$(15)$，都在推导和解释你说的这个...](https://kexue.fm/archives/9209/comment-page-8#comment-29054)
* [苏剑林: 相对位置编码，似乎没有太多选择了，要不RoPE这种，算是乘性了...](https://kexue.fm/archives/8130/comment-page-7#comment-29053)
* [苏剑林: 学习了一下，感觉这个更多是证明，而不是理解？而且这个证明也没有...](https://kexue.fm/archives/11480/comment-page-1#comment-29052)
* [苏剑林: 那还不如直接softmax attention？](https://kexue.fm/archives/11320/comment-page-1#comment-29051)
* [苏剑林: 可以啊，L1 Norm一定大于等于L2 Norm，所以L1 N...](https://kexue.fm/archives/11486/comment-page-1#comment-29050)
* [苏剑林: 你本来要用数值模拟算两重积分，我现在帮你把一重积分算出来了，你...](https://kexue.fm/archives/9119/comment-page-14#comment-29049)
* [苏剑林: learned, thanks](https://kexue.fm/archives/11158/comment-page-1#comment-29048)
## USERLOGIN
* [登录](https://kexue.fm/admin/login.php)
[科学空间|Scientific Spaces](https://kexue.fm)
* [登录](https://kexue.fm/admin/login.php)
* [打赏](https://kexue.fm/reward.html)
* [公式](https://kexue.fm/latex.html)
* [天象](https://kexue.fm/ac.html)
* [链接](https://kexue.fm/links.html)
* [时光](https://kexue.fm/me.html)
* [博览](https://kexue.fm/science.html)
* [归档](https://kexue.fm/content.html)
渴望成为一个小飞侠* [![](https://kexue.fm/usr/themes/geekg/images/rss.png)
欢迎订阅](https://kexue.fm/feed)
* [![](https://kexue.fm/usr/themes/geekg/images/mail.png)
个性邮箱](https://kexue.fm/archives/119)
* [![](https://kexue.fm/usr/themes/geekg/images/Saturn.png)
天象信息](https://kexue.fm/ac.html)
* [![](https://kexue.fm/usr/themes/geekg/images/iss.png)
观测ISS](https://kexue.fm/archives/41)
* [![](https://kexue.fm/usr/themes/geekg/images/pi.png)
LaTeX](https://kexue.fm/latex.html)
* [![](https://kexue.fm/usr/themes/geekg/images/mlogo.png)
关于博主](https://kexue.fm/me.html)
欢迎访问“科学空间”，这里将与您共同探讨自然科学，回味人生百态；也期待大家的分享～* [**千奇百怪**Everything](https://kexue.fm/category/Everything)
* [**天文探索**Astronomy](https://kexue.fm/category/Astronomy)
* [**数学研究**Mathematics](https://kexue.fm/category/Mathematics)
* [**物理化学**Phy-chem](https://kexue.fm/category/Phy-chem)
* [**信息时代**Big-Data](https://kexue.fm/category/Big-Data)
* [**生物自然**Biology](https://kexue.fm/category/Biology)
* [**图片摄影**Photograph](https://kexue.fm/category/Photograph)
* [**问题百科**Questions](https://kexue.fm/category/Questions)
* [**生活/情感**Life-Feeling](https://kexue.fm/category/Life-Feeling)
* [**资源共享**Resources](https://kexue.fm/category/Resources)
* [**千奇百怪**](https://kexue.fm/category/Everything)
* [**天文探索**](https://kexue.fm/category/Astronomy)
* [**数学研究**](https://kexue.fm/category/Mathematics)
* [**物理化学**](https://kexue.fm/category/Phy-chem)
* [**信息时代**](https://kexue.fm/category/Big-Data)
* [**生物自然**](https://kexue.fm/category/Biology)
* [**图片摄影**](https://kexue.fm/category/Photograph)
* [**问题百科**](https://kexue.fm/category/Questions)
* [**生活/情感**](https://kexue.fm/category/Life-Feeling)
* [**资源共享**](https://kexue.fm/category/Resources)
[首页](https://kexue.fm)[数学研究](https://kexue.fm/category/Mathematics)[信息时代](https://kexue.fm/category/Big-Data)Transformer升级之路：4、二维位置的旋转式位置编码
10May
# [Transformer升级之路：4、二维位置的旋转式位置编码](https://kexue.fm/archives/8397)
By苏剑林|2021-05-10|198839位读者|:
在之前的文章[《Transformer升级之路：2、博采众长的旋转式位置编码》](https://kexue.fm/archives/8265)中我们提出了旋转式位置编码RoPE以及对应的Transformer模型RoFormer。由于笔者主要研究的领域还是NLP，所以本来这个事情对于笔者来说已经完了。但是最近一段时间，Transformer模型在视觉领域也大火，各种Vision Transformer（ViT）层出不穷，于是就有了问题：二维情形的RoPE应该是怎样的呢？
咋看上去，这个似乎应该只是一维情形的简单推广，但其中涉及到的推导和理解却远比我们想象中复杂，本文就对此做一个分析，从而深化我们对RoPE的理解。
## 二维RoPE[#](#二维RoPE)
什么是二维位置？对应的二维RoPE又是怎样的？它的难度在哪里？在这一节中，我们先简单介绍二维位置，然后直接给出二维RoPE的结果和推导思路，在随后的几节中，我们再详细给出推导过程。
### 二维位置[#](#二维位置)
在NLP中，语言的位置信息是一维的，换句话说，我们需要告诉模型这个词是句子的第几个词；但是在CV中，图像的位置信息是二维的，即我们需要告诉模型这个特征是在第几行、第几列。这里的二维指的是完整描述位置信息需要两个数字，并不是指位置向量的维数。
有读者可能想：简单展平后当作一维的处理不行吗？确实不大行，比如一个$h\\times h$的feature map，位置$(x,y)$展平后就变成了$xh + y$，而位置$(x+1,y)$和$(x,y+1)$展平后就分别变成了$xh+y+h$和$xh+y+1$，两者与$xh + y$的差分别是$h$和$1$。然而，按照我们直观的认识，$(x+1,y)$、$(x,y+1)$它们与$(x,y)$的距离应该是一样的才对，但是展平后却得到了不一样的$h$和$1$，这未免就不合理了。
所以，我们需要专门为二维情形设计的位置编码，不能简单地展平为一维来做。### 标准答案[#](#标准答案)
经过后面的一番推导，得到二维RoPE的一个解为：
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_{x,y}=\\left(
\\begin{array}{cc:cc}
\\cos x\\theta & -\sin& -\sin x\\theta & 0 & 0& 0 & 0 \\\\
\\sin x\\theta & \cos & \cos x\\theta & 0 & 0& 0 & 0 \\\\
\\hdashline
0 & 0 & \& 0 & \cos y\\theta & -\sin& -\sin y\\theta \\\\
0 & 0 & \& 0 & \sin y\\theta & \cos & \cos y\\theta \\\\
\\end{array}\\right)\\label{eq:rope-2d}\\end{equation}
其中这个解很容易理解，它是两个一维RoPE组成的分块矩阵，实现上它就是将输入向量分为两半，一半施加$x$的一维RoPE，一半施加$y$的一维RoPE。由此形式我们也不难类比三维、四维等位置的RoPE。
矩阵$\\eqref{eq:rope-2d}$是一个正交矩阵，它满足两个关键性质：
> 1、
**> 相对性**> ：即$\boldsymbol{\mathcal{R}}_{x_1,y_1}^{\top}\boldsymbol{\mathcal{R}}_{x_2,y_2}=\boldsymbol{\mathcal{R}}_{x_2-x_1,y_2-y_1}$，也正是由于这个性质，RoPE才具有通过绝对位置实现相对位置的能力；
> 2、
**> 可逆性**> ：给定$\boldsymbol{\mathcal{R}}_{x,y}$可以反解出$x,y$，这意味着对位置信息的编码是无损的。
某种意义上来说，式$\\eqref{eq:rope-2d}$是满足上述两个性质的最简单解，也就是说，虽然存在略有不同的解满足上述两个性质，但是它们形式上和实现上都相对复杂些。
### 推导思路[#](#推导思路)
事后来看，RoPE其实就是找到了矩阵$\\boldsymbol{\\mathcal{R}}\_n=\\begin{pmatrix}\\cos n\\theta & -\sin& -\sin n\\theta\\\\ \\sin n\\theta & \cos & \cos n\\theta\\end{pmatrix}$，使得满足“相对性”条件：
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_m^{\\top}\\boldsymbol{\\mathcal{R}}\_n=\\boldsymbol{\\mathcal{R}}\_{n-m}\\label{eq:re}\\end{equation}
所以，不难想到，二维RoPE的基本要求也是满足相对性，即要找到矩阵$\\boldsymbol{\\mathcal{R}}\_{x,y}$，使得它满足二维的相对性条件$\\boldsymbol{\\mathcal{R}}\_{x\_1,y\_1}^{\\top}\\boldsymbol{\\mathcal{R}}\_{x\_2,y\_2}=\\boldsymbol{\\mathcal{R}}\_{x\_2-x\_1,y\_2-y\_1}$。不过，如果仅仅是这个要求的话，可行解就很多了，比如直接让
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_{x,y} = \\begin{pmatrix}\\cos (x+y)\\theta & -\sin& -\sin (x+y)\\theta\\\\ \\sin (x+y)\\theta & \cos & \cos (x+y)\\theta\\end{pmatrix}\\end{equation}
但这个解的问题是，我们无法从$x+y$逆向推出$(x,y)$，这意味着这个选择对位置信息来说是有损的，所以我们需要多一个“可逆性”，保证可以从位置矩阵中无损地重构出原始位置信号。
对此，我们有两个比较自然的途径选择：1、四元数；2、矩阵指数。接下来我们将会逐一介绍它们。
## 四元数[#](#四元数)
在一维RoPE的推导中，我们主要以复数为工具，而[四元数（Quaternion）](https://en.wikipedia.org/wiki/Quaternion)是复数的推广，它同时也保留了复数的很多性质，所以用它来推导二维RoPE也算是一个自然的思路。不过很遗憾，这是一条走不通的途径，但笔者仍然将思考过程放置在此，供大家参考。
### 复数与矩阵[#](#复数与矩阵)
在高中时我们就学习过，复数$a+b\\boldsymbol{i}$跟二维向量$(a,b)$时一一对应的（为了跟后面的四元数对齐，这里把虚数单位$\\boldsymbol{i}$也加粗了），但这个对应关系只能保持加减法对应（因为向量没有通用的乘法运算）。更精妙的对应是将复数与矩阵对应
\\begin{equation}a+b\\boldsymbol{i} \\quad \\leftrightarrow \\quad \\begin{pmatrix} a & -b \\& -b \\ b & a \en& a \end{pmatrix}\\end{equation}
在这个映射下，复数的加减乘除与矩阵的加减乘除一一对应，比如\\begin{equation}\\begin{array}{ccc}
(a+b\\boldsymbol{i})(c+d\\boldsymbol{i}) &=& (ac&=& (ac - bd) + (ad + bc)\\boldsymbol{i} \\\\[5pt]
\\begin{pmatrix} a & -b \\& -b \\ b & a \en& a \end{pmatrix}\\begin{pmatrix} c & -d \\& -d \\ d & c \en& c \end{pmatrix} &=& \be&=& \begin{pmatrix} ac - bd & - ad & - ad - bc \\\\ ad + bc & ac - & ac - bd \\end{pmatrix}
\\end{array}\\end{equation}
所以，矩阵映射才是复数域的完全同构，而向量映射只是直观的几何理解。复数的矩阵映射也是RoPE的重要基础，在[《Transformer升级之路：2、博采众长的旋转式位置编码》](https://kexue.fm/archives/8265)中我们已经推导得到RoPE的复数表示是$\\boldsymbol{q}e^{n\\boldsymbol{i}\\theta}=(\\cos n\\theta + \\boldsymbol{i}\\sin n\\theta)\\boldsymbol{q}$，所以根据复数的矩阵映射，$\\cos n\\theta + \\boldsymbol{i}\\sin n\\theta$就对应着矩阵
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_n=\\begin{pmatrix}\\cos n\\theta & -\sin& -\sin n\\theta\\\\ \\sin n\\theta & \cos & \cos n\\theta\\end{pmatrix}\\end{equation}
从而得到了一维RoPE的矩阵形式。
### 四元数简介[#](#四元数简介)
前面说了，四元数是复数是一种推广，事实上它还是矩阵的“鼻祖”，从历史上来说，是先有四元数然后才有一般的矩阵运算，并且四元数启发了矩阵的很多运算。早年笔者也写了[《与向量的渊源极深的四元数》](https://kexue.fm/archives/898)、[《几何的数与数的几何：超复数的浅探究》](https://kexue.fm/archives/2291)等文章来介绍四元数，欢迎读者参考。
如果说复数是一个二维向量，那么四元数就是一个四维向量，表示为$a+b\\boldsymbol{i}+c\\boldsymbol{j}+d\\boldsymbol{k}$，这里的$\\boldsymbol{i}^2=\\boldsymbol{j}^2=\\boldsymbol{k}^2=-1$，但是它们本身都各不相等，几个基之间的运算规则是：
\\begin{array}{c|cccc}
\\times & 1 & \& 1 & \boldsymbol{i} & \bold& \boldsymbol{j} & \bold& \boldsymbol{k} \\\\
\\hline
1 & 1 & \& 1 & \boldsymbol{i} & \bold& \boldsymbol{j} & \bold& \boldsymbol{k} \\\\
\\boldsymbol{i} & \bold& \boldsymbol{i} & -1 & & -1 & \\boldsymbol{k} & -\bol& -\boldsymbol{j} \\\\
\\boldsymbol{j} & \bold& \boldsymbol{j} & -\bol& -\boldsymbol{k} & -1 & & -1 & \\boldsymbol{i} \\\\
\\boldsymbol{k} & \bold& \boldsymbol{k} & \bold& \boldsymbol{j} & -\bol& -\boldsymbol{i} & -1 \\& -1 \\
\\end{array}
在当时它给人们最大的冲击是非交换性，比如$\\boldsymbol{i}\\boldsymbol{j}=-\\boldsymbol{j}\\boldsymbol{i}\\neq \\boldsymbol{j}\\boldsymbol{i}$。但除此之外，它跟复数运算其实是高度相似的。
比如类似复数的欧拉公式\\begin{equation}e^{a+b\\boldsymbol{i}+c\\boldsymbol{j}+d\\boldsymbol{k}} = e^a\\left(\\cos r + \\frac{b\\boldsymbol{i}+c\\boldsymbol{j}+d\\boldsymbol{k}}{r}\\sin r\\right)\\label{eq:euler}\\end{equation}
这里$r = \\Vert b\\boldsymbol{i}+c\\boldsymbol{j}+d\\boldsymbol{k}\\Vert = \\sqrt{b^2+c^2+d^2}$。此外，还有类似的矩阵映射
\\begin{equation}
a+b\\boldsymbol{i}+c\\boldsymbol{j}+d\\boldsymbol{k} \\quad \\leftrightarrow \\quad \\begin{pmatrix}
a & -b & & -b & -c & -d \\& -d \\
b & a & -& a & -d & c \\
c & d & a& d & a & -b \\& -b \\
d & -c & b & a
\\end{pmatrix}\\label{eq:mapping}\\end{equation}
### 违背相对性[#](#违背相对性)
关于这些公式背后的起源，那就说来话长了，这里也不打算细谈，有兴趣的读者请自行搜索资料阅读。有了欧拉公式和指数映射后，读者或许反应过来：一维RoPE无非是$e^{n\\boldsymbol{i}\\theta}$对应的矩阵映射，那么二维RoPE的话将$e^{x\\boldsymbol{i}\\theta + y\\boldsymbol{j}\\theta}$映射为矩阵形式不就行了？
笔者一开始也是这样想的，很遗憾，这是错的。错在哪里呢？在一维RoPE中，我们利用了内积的复数表示：
\\begin{equation}\\langle\\boldsymbol{q},\\boldsymbol{k}\\rangle=\\text{Re}[\\boldsymbol{q}\\boldsymbol{k}^\*]\\end{equation}
该恒等式在四元数中同样成立，因此可以照搬。接着我们利用了复指数：\\begin{equation}\\langle\\boldsymbol{q}e^{m\\boldsymbol{i}\\theta},\\boldsymbol{k}\\boldsymbol{q}e^{n\\boldsymbol{i}\\theta}\\rangle=\\text{Re}\\left[\\left(\\boldsymbol{q}e^{m\\boldsymbol{i}\\theta}\\right)\\left(\\boldsymbol{k}e^{n\\boldsymbol{i}\\theta}\\right)^\*\\right]=\\text{Re}\\left[\\boldsymbol{q}e^{m\\boldsymbol{i}\\theta}e^{-n\\boldsymbol{i}\\theta}\\boldsymbol{k}^\*\\right]=\\text{Re}\\left[\\boldsymbol{q}e^{(m-n)\\boldsymbol{i}\\theta}\\boldsymbol{k}^\*\\right]\\end{equation}
前两个等号都可以照搬到四元数中，关键是第三个等号在四元数中并不恒成立！一般地，对于两个四元数$\\boldsymbol{p},\\boldsymbol{q}$，等式$e^{\\boldsymbol{p}+\\boldsymbol{q}}=e^{\\boldsymbol{p}}e^{\\boldsymbol{q}}$并不成立！更广义来说，对于两个乘法不满足交换律的对象，一般都有$e^{\\boldsymbol{p}+\\boldsymbol{q}}\\neq e^{\\boldsymbol{p}}e^{\\boldsymbol{q}}$。
所以，推导到最后，由于指数乘法无法转换为加法，最后的相对性没法得到保证。因此通过四元数推导这条路，就此夭折了...
## 矩阵指数[#](#矩阵指数)
四元数的矩阵映射表明四元数事实上代表了一簇特定的$4\\times 4$矩阵，四元数推导走不通，那么或许使用一般的矩阵分析可以走得通。事实上确实如此，在这一节中，我们将利用矩阵指数给出一个推导结果。
### 矩阵指数[#](#矩阵指数)
这里的[矩阵指数](https://en.wikipedia.org/wiki/Matrix_exponential)，并不是神经网络的用指数函数作为激活函数的逐位运算，而是是按照幂级数定义的运算：
\\begin{equation}\\exp \\boldsymbol{B} = \\sum\_{k=0}^{\\infty}\\frac{\\boldsymbol{B}^k}{k!}\\end{equation}
其中$\\boldsymbol{B}^k$是指按照矩阵乘法将$k$个$\\boldsymbol{B}$连乘。关于矩阵指数，笔者之前曾写过[《恒等式 det(exp(A)) = exp(Tr(A)) 赏析》](https://kexue.fm/archives/6377)，也欢迎参考阅读。
矩阵指数是非常重要的一种矩阵运算，它可以直接写出常系数微分方程组$\\frac{d}{dt}\\boldsymbol{x}\_t=\\boldsymbol{A}\\boldsymbol{x}\_t$的解：
\\begin{equation}\\boldsymbol{x}\_t = \\big(\\exp t\\boldsymbol{A}\\big)\\boldsymbol{x}\_0\\end{equation}
当然这跟本文的主题关系不大。对于RoPE的推导，我们主要利用到矩阵指数的如下性质：
\\begin{equation}\\boldsymbol{A}\\boldsymbol{B} = \\boldsymbol{B}\\boldsymbol{A} \\quad\\Rightarrow\\quad \\big(\\exp \\boldsymbol{A}\\big)\\big(\\exp \\boldsymbol{B}\\big) = \\exp \\big(\\boldsymbol{A} + \\boldsymbol{B}\\big)\\label{eq:expm-ex}\\end{equation}
也就是说，如果$\\boldsymbol{A},\\boldsymbol{B}$的乘法可以交换，那么矩阵指数就可以像数的指数一样将乘法转换为加法。不过要注意这是一个充分不必要条件。
至于怎么把矩阵指数算出来，这里没法再展开介绍了，但是很多软件库已经自带了矩阵指数运算，比如数值计算库scipy和tensorflow都有`expm`函数，而符号计算的话，Mathematica里边有`MatrixExp`函数。
### 一维通解[#](#一维通解)
为什么能够将RoPE跟矩阵指数联系起来呢？因为一维的RoPE存在比较简单的指数表达式：
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_n=\\begin{pmatrix}\\cos n\\theta & -\sin& -\sin n\\theta\\\\ \\sin n\\theta & \cos & \cos n\\theta\\end{pmatrix}=\\exp\\left\\{n\\theta\\begin{pmatrix}0 & -1\\ & -1\\ 1 & 0\end& 0\end{pmatrix}\\right\\}\\label{eq:rope-exp}\\end{equation}
于是笔者开始思考如下形式的矩阵作为RoPE的解：
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_n=\\exp n\\boldsymbol{B}\\end{equation}
其中$\\boldsymbol{B}$是一个跟$n$无关的矩阵。RoPE的必要条件是满足“相对性”条件$\\eqref{eq:re}$，于是我们分析
\\begin{equation}\\big(\\exp m\\boldsymbol{B}\\big)^{\\top}\\big(\\exp n\\boldsymbol{B}\\big) = \\big(\\exp m\\boldsymbol{B}^{\\top}\\big)\\big(\\exp n\\boldsymbol{B}\\big)\\end{equation}
这里先假设$\\boldsymbol{B}^{\\top},\\boldsymbol{B}$是可交换的，那么根据式$\\eqref{eq:expm-ex}$有
\\begin{equation}\\big(\\exp m\\boldsymbol{B}^{\\top}\\big)\\big(\\exp n\\boldsymbol{B}\\big) = \\exp \\big(m\\boldsymbol{B}^{\\top} + n\\boldsymbol{B}\\big)\\end{equation}
要让$m\\boldsymbol{B}^{\\top} + n\\boldsymbol{B}=(n-m)\\boldsymbol{B}$，只需要满足
\\begin{equation}\\boldsymbol{B}^{\\top} = - \\boldsymbol{B}\\end{equation}
这便是“相对性”给出的约束条件，刚才我们还假设了$\\boldsymbol{B}^{\\top},\\boldsymbol{B}$是可交换的，现在可以检验满足这个等式的$\\boldsymbol{B}^{\\top},\\boldsymbol{B}$一定是可交换的，所以结果是自洽的。
这也就是说，对于任何满足$\\boldsymbol{B}^{\\top} + \\boldsymbol{B} = 0$的矩阵$\\boldsymbol{B}$，$\\exp n\\boldsymbol{B}$都是方程$\\eqref{eq:re}$的解，并且还可以证明它一定是正交矩阵。当然，根据$\\exp n\\boldsymbol{B}=\\left(\\exp \\boldsymbol{B}\\right)^n$，我们更直接的得到：对于任意正交矩阵$\\boldsymbol{O}$，$\\boldsymbol{\\mathcal{R}}\_n=\\boldsymbol{O}^n$都是方程$\\eqref{eq:re}$的解。
对于$2\\times 2$的矩阵来说，$\\boldsymbol{B}^{\\top} + \\boldsymbol{B} = 0$的通解是$\\boldsymbol{B}=\\begin{pmatrix}0 & -\the& -\theta\\\\ \\theta & 0\end& 0\end{pmatrix}$，于是就有了如式$\\eqref{eq:rope-exp}$的解。
### 二维约束[#](#二维约束)
类似地，对于二维RoPE，我们考虑
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_{x,y}=\\exp \\big(x\\boldsymbol{B}\_1 + y\\boldsymbol{B}\_2\\big)\\end{equation}
作为候选解。重复上述关于“相对性”条件的推导：先假设$x\_1\\boldsymbol{B}\_1^{\\top} + y\_1\\boldsymbol{B}\_2^{\\top}$与$x\_2\\boldsymbol{B}\_1 + y\_2\\boldsymbol{B}\_2$是可交换的，那么我们可以得到如下约束条件：
\\begin{equation}\\boldsymbol{B}\_1^{\\top} + \\boldsymbol{B}\_1 = 0,\\quad \\boldsymbol{B}\_2^{\\top} + \\boldsymbol{B}\_2 = 0\\end{equation}
然而，$x\_1\\boldsymbol{B}\_1^{\\top} + y\_1\\boldsymbol{B}\_2^{\\top}$与$x\_2\\boldsymbol{B}\_1 + y\_2\\boldsymbol{B}\_2$可交换，意味着$(\\boldsymbol{B}\_1,\\boldsymbol{B}\_1^{\\top})$、$(\\boldsymbol{B}\_2,\\boldsymbol{B}\_2^{\\top})$、$(\\boldsymbol{B}\_1,\\boldsymbol{B}\_2^{\\top})$和$(\\boldsymbol{B}\_2,\\boldsymbol{B}\_1^{\\top})$都可交换，但是上述两个约束只能保证$(\\boldsymbol{B}\_1,\\boldsymbol{B}\_1^{\\top})$和$(\\boldsymbol{B}\_2,\\boldsymbol{B}\_2^{\\top})$可交换，不能保证后两者的交换性，所以我们需要把它作为约束条件补充上去，得到：
\\begin{equation}\\left\\{\\begin{aligned}
&\bolds&\boldsymbol{B}\_1^{\\top} + \\boldsymbol{B}\_1 = 0\\\\
&\bolds&\boldsymbol{B}\_2^{\\top} + \\boldsymbol{B}\_2 = 0\\\\
&\bolds&\boldsymbol{B}\_1 \\boldsymbol{B}\_2^{\\top} = \\boldsymbol{B}\_2^{\\top} \\boldsymbol{B}\_1
\\end{aligned}\\right.\\label{eq:2d-conds}\\end{equation}
不难证明在前两个条件下，新增的约束条件也相当于$\\boldsymbol{B}\_1 \\boldsymbol{B}\_2 = \\boldsymbol{B}\_2 \\boldsymbol{B}\_1$。
### RoPE现身[#](#RoPE现身)
由于满足前两个条件的$2\\times 2$矩阵只有一个独立参数，不满足“可逆性”，所以我们至少要考虑$3\\times 3$矩阵，它有3个独立参数
\\begin{equation}\\begin{pmatrix}0 & -a & & -a & -b \\\\ a & 0 & -& 0 & -c \\\\ b & c & 0& c & 0\\end{pmatrix}\\end{equation}
为了保证可逆性，我们不妨设$\\boldsymbol{B}\_1,\\boldsymbol{B}\_2$是“正交”的，比如设：
\\begin{equation}\\boldsymbol{B}\_1=\\begin{pmatrix}0 & -a & & -a & 0 \\\\ a & 0 & 0& 0 & 0 \\\\ 0 & 0 & 0& 0 & 0\\end{pmatrix},\\quad\\boldsymbol{B}\_2=\\begin{pmatrix}0 & 0 & -& 0 & -b \\\\ 0 & 0 & -& 0 & -c \\\\ b & c & 0& c & 0\\end{pmatrix}\\end{equation}
不失一般性还可以设$a=1$，那么由条件$\\eqref{eq:2d-conds}$解得$b=0,c=0$，即$\\boldsymbol{B}\_2$只能是全零解，这不符合我们的要求。Mathematica的求解代码为：
```
`B[a\_, b\_, c\_] = {{0, -a, -b}, {a, 0, -c}, {b, c, 0}}; B1 = B[1, 0, 0]; B2 = B[0, b, c]; Solve[{Dot[B1, B2] == Dot[B2, B1]}, {b, c}]`
```
因此，我们至少要考虑$4\\times 4$矩阵，它有6个独立参数，不失一般性，考虑正交分解：
\\begin{equation}\\boldsymbol{B}\_1=\\begin{pmatrix}0 & -a & & -a & -b & 0 \\ & 0 \\ a & 0 & -& 0 & -c & 0 \\ & 0 \\ b & c & 0& c & 0 & 0 \\ & 0 \\ 0 & 0 & 0& 0 & 0 & 0\end& 0\end{pmatrix},\\quad\\boldsymbol{B}\_2=\\begin{pmatrix}0 & 0 & 0& 0 & 0 & -d \\& -d \\ 0 & 0 & 0& 0 & 0 & -e \\& -e \\ 0 & 0 & 0& 0 & 0 & -f \\& -f \\ d & e & f& e & f & 0\end& 0\end{pmatrix}\\end{equation}
解得\\begin{equation}d=cf,\\quad e=-bf\\end{equation}
求解代码：```
`B[a\_, b\_, c\_, d\_, e\_, f\_] = {{0, -a, -b, -d}, {a, 0, -c, -e}, {b, c, 0, -f}, {d, e, f, 0}}; B1 = B[1, b, c, 0, 0, 0]; B2 = B[0, 0, 0, d, e, f]; Solve[{Dot[B1, B2] == Dot[B2, B1]}, {b, c, d, e, f}]`
```
可以发现结果没有对$f$提出约束，所以从最简单起见，我们可以让$f=1$，剩下的$b,c,d,e$全部为0，此时
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_{x,y}=\\exp \\,\\begin{pmatrix}0 & -x & & -x & 0 & 0 \\ & 0 \\ x & 0 & 0& 0 & 0 & 0 \\ & 0 \\ 0 & 0 & 0& 0 & 0 & -y \\& -y \\ 0 & 0 & y& 0 & y & 0\end& 0\end{pmatrix}\\end{equation}
可以增加个参数$\\theta$，完成展开，就得到：
\\begin{equation}\\boldsymbol{\\mathcal{R}}\_{x,y}=\\exp \\,\\left\\{\\begin{pmatrix}0 & -x & & -x & 0 & 0 \\ & 0 \\ x & 0 & 0& 0 & 0 & 0 \\ & 0 \\ 0 & 0 & 0& 0 & 0 & -y \\& -y \\ 0 & 0 & y& 0 & y & 0\end& 0\end{pmatrix}\\theta\\right\\}=\\left(
\\begin{array}{cc:cc}
\\cos x\\theta & -\sin& -\sin x\\theta & 0 & 0& 0 & 0 \\\\
\\sin x\\theta & \cos & \cos x\\theta & 0 & 0& 0 & 0 \\\\
\\hdashline
0 & 0 & \& 0 & \cos y\\theta & -\sin& -\sin y\\theta \\\\
0 & 0 & \& 0 & \sin y\\theta & \cos & \cos y\\theta \\\\
\\end{array}\\right)\\end{equation}
## 延伸故事[#](#延伸故事)
至此，关于二维RoPE的推导介绍完毕。现在读者可能想问的是效果如何？很遗憾，现在还没有很完整的实验结果，毕竟笔者之前也没做过ViT相关的工作，而这个二维RoPE的推导也刚完成没多久，所以进展比较慢，只能说初步的结果显示还是挺有效的。EleutherAI团队的成员也实验过这个方案，效果也比已有的其他位置编码好。
说到EleutherAI团队，这里再多说几句。EleutherAI团队是前段时候比较火的号称要“复现GPT3”的那个团队，我们在文章[《Transformer升级之路：2、博采众长的旋转式位置编码》](https://kexue.fm/archives/8265)中提出了RoPE及RoFormer后，有幸得到了EleutherAI团队的关注，他们做了很多补充实验，确认了RoPE比很多其他位置编码都更加有效（参考他们的博客[《Rotary Embeddings: A Relative Revolution》](https://blog.eleuther.ai/rotary-embeddings/)），这促使我们完成了英文论文[《RoFormer: Enhanced Transformer with Rotary Position Embedding》](https://papers.cool/arxiv/2104.09864)并提交到了Arxiv上。而关于二维RoPE的疑问，最初也是来源于EleutherAI团队。
## 文章小结[#](#文章小结)
本文介绍了我们对RoPE的二维推广，主要以“相对性”、“可逆性”为出发点来确定二维RoPE的最终形式，尝试了四元数和矩阵指数两种推导过程，最终通过矩阵指数来给出了最终的解，从推导过程中我们还可以深化对RoPE的理解。
***转载到请包括本文地址：** [https://kexue.fm/archives/8397](https://kexue.fm/archives/8397)*
***更详细的转载事宜请参考：*** [《科学空间FAQ》](https://kexue.fm/archives/6508#文章如何转载/引用)
**如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。**
**如果您觉得本文还不错，欢迎[分享](#share)/[打赏](#pay)本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！**
打赏![科学空间](https://kexue.fm/usr/themes/geekg/payment/wx.png)
微信打赏![科学空间](https://kexue.fm/usr/themes/geekg/payment/zfb.png)
支付宝打赏因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。 你还可以[**点击这里**](http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=tN7d1drY3drrx8H0xcWa19vZ)或在下方评论区留言来告知你的建议或需求。
**如果您需要引用本文，请参考：**
苏剑林. (May. 10, 2021). 《Transformer升级之路：4、二维位置的旋转式位置编码 》[Blog post]. Retrieved from[https://kexue.fm/archives/8397](https://kexue.fm/archives/8397)
@online{kexuefm-8397,
title={Transformer升级之路：4、二维位置的旋转式位置编码},
author={苏剑林},
year={2021},
month={May},
url={\\url{https://kexue.fm/archives/8397}},
}
分类：[数学研究](https://kexue.fm/category/Mathematics),[信息时代](https://kexue.fm/category/Big-Data) 标签：[复数](https://kexue.fm/tag/复数/),[矩阵](https://kexue.fm/tag/矩阵/),[attention](https://kexue.fm/tag/attention/),[位置编码](https://kexue.fm/tag/位置编码/),[rope](https://kexue.fm/tag/rope/)[77 评论](https://kexue.fm/archives/8397#comments)
&lt;[GlobalPointer：用统一的方式处理嵌套和非嵌套NER](https://kexue.fm/archives/8373)|[变分自编码器（七）：球面上的VAE（vMF-VAE）](https://kexue.fm/archives/8404)&gt;
### 你也许还对下面的内容感兴趣* [为什么DeltaNet要加L2 Normalize？](https://kexue.fm/archives/11486)
* [Muon优化器指南：快速上手与关键细节](https://kexue.fm/archives/11416)
* [流形上的最速下降：5. 对偶梯度下降](https://kexue.fm/archives/11388)
* [低精度Attention可能存在有偏的舍入误差](https://kexue.fm/archives/11371)
* [随机矩阵的谱范数的快速估计](https://kexue.fm/archives/11335)
* [为什么线性注意力要加Short Conv？](https://kexue.fm/archives/11320)
* [流形上的最速下降：4. Muon + 谱球面](https://kexue.fm/archives/11241)
* [流形上的最速下降：3. Muon + Stiefel](https://kexue.fm/archives/11221)
* [流形上的最速下降：2. Muon + 正交](https://kexue.fm/archives/11215)
* [矩阵r次方根和逆r次方根的高效计算](https://kexue.fm/archives/11175)
[发表你的看法](#comment_form)
1. [&laquo;](https://kexue.fm/archives/8397/comment-page-2#comments)
2. [1](https://kexue.fm/archives/8397/comment-page-1#comments)
3. [2](https://kexue.fm/archives/8397/comment-page-2#comments)
4. [3](https://kexue.fm/archives/8397/comment-page-3#comments)
ShadowSinger
May 29th, 2025
苏神你好，请教一下，原文“但这个解的问题是，我们无法从x+y逆向推出(x,y)，这意味着这个选择对位置信息来说是有损的，所以我们需要多一个“可逆性”，保证可以从位置矩阵中无损地重构出原始位置信号。”
是否可以理解为（假设Q x1=0,y1=0)，K (x2,y2)=(3,4),(-3,4),(-3,-4),(0,5),(-5,0)都是不一样的，即R(x2-x1)(y2-y1)实际上提供了旋转变化的、正负可知的无损相对位置信息？
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27730#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 June 3rd, 2025
嗯，是这个意思。[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27747#respond-post-8397)
[盏一](http://hidva.com)
June 17th, 2025
苏神, 请教一下\> 并且还可以证明它一定是正交矩阵是怎么证明的. 我本来以为隐式利用了$\\Vert R\_n q \\Vert = \\Vert q \\Vert$ 这一条件, 即前文提到的:
\> 正交矩阵，它不会改变向量的模长但忽然发现在$B^T + B = 0$ 的前提下, $\\Vert \\exp nB q \\Vert $ = 0! 更迷惑了.
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27907#respond-post-8397)
[盏一](http://hidva.com)发表于 June 17th, 2025
呃, 是我脑子乱了... 忘了$\\exp(0) = I$. 所以只要$\\Vert B^T+B=0 \\Vert$, 就有\\Vert R\_n q \\Vert = \\Vert q \\Vert. 那证明B 是正交矩阵缺少还少个$B^2 = -I$ 的类似条件?
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27908#respond-post-8397)
[盏一](http://hidva.com)
June 17th, 2025
哦哦哦你是说$\\exp nB$ 是正交矩阵! 并不是说B.
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27910#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 June 20th, 2025
对。$\\boldsymbol{B}$是反对称矩阵，那么$\\exp n\\boldsymbol{B}$就是正交矩阵。
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27937#respond-post-8397)
HikaruNight
June 27th, 2025
苏老师，想请教一下如果把四元数放在三维RoPE里面是不是可行的
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=27985#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 July 2nd, 2025
不满足交换律是硬伤，不知道你打算怎么解决这一点。[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28030#respond-post-8397)
mali35
July 29th, 2025
苏神有注意到这篇所给出点乘形式的2d rope么：https://jerryxio.ng/posts/nd-rope/ 他使用的是2d平面上的点，与平面一个等速螺线上点的向量乘积作为旋转量
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28244#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 July 30th, 2025
学习了一下，这个推广形式有点妙，确实更加大一统些，我再悟一下。[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28260#respond-post-8397)
YYQ 发表于August 5th, 2025
苏神有没有时间解析一下这篇blog, 看了一下感觉一知半解[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28304#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 August 6th, 2025
好像也没什么技术难度啊[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28319#respond-post-8397)
mali35
July 29th, 2025
哦不对，幅值是指数增长的，它好像是是个对数螺线。他这种方式下，1d的位置编码只是一个幅值项指数变化，但是角度项不变的特殊形式。甚至有可能通过添加更多维度的方向，来直接实现多模态的位置编码的大一统，比如图文就是角度旋转的2d+角度不变的1d方向。
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28248#respond-post-8397)
yzyyzyhhh
November 22nd, 2025
苏老师你好，我是数学系的学生，我发现可以用一些理论来简洁地导出一般情况下的nD RoPE，涵盖了我目前见过的所有RoPE,您感兴趣的话可以看一看：https://github.com/happyyzy/position-encoding-and-representation-theory
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28859#respond-post-8397)
yzyyzyhhh 发表于November 22nd, 2025
这个框架直接把相对位置不变性抽象为数学上的群表示，所以非常general和简洁。
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28860#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 November 24th, 2025
感谢分享。我简单扫了一下，可能对于你的背景来说更简洁，但对于一般读者（包括我）来说，应该是引入了更多的概念了...
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28888#respond-post-8397)
yzyyzyhhh 发表于November 25th, 2025
苏老师我想到一种不需要更多概念的方法：2DROPE相比1D的难点在于要搞清楚两个可交换的正交矩阵长啥样，3DRPOE要搞清楚三个这样的矩阵长啥样。
如你文章里所说，如果用矩阵指数来考虑，只能得到一个充分不必要条件。其实有一个标准的结论是说：多个两两可交换的正交矩阵可以同时块对角化，对角块就是二维的旋转或者1，-1，这个结论的证明只需要数学归纳法和线性代数。
如此一来框架就清晰了：要得到nDROPE的公式，就要搞清楚n个两两交换的正交矩阵长啥样，用这个结论搞清楚就直接给出一般公式。
[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28910#respond-post-8397)
[苏剑林](https://kexue.fm)发表于 November 26th, 2025
嗯，这个好理解很多，我没问题。[回复评论](https://kexue.fm/archives/8397/comment-page-3?replyTo=28916#respond-post-8397)
1. [&laquo;](https://kexue.fm/archives/8397/comment-page-2#comments)
2. [1](https://kexue.fm/archives/8397/comment-page-1#comments)
3. [2](https://kexue.fm/archives/8397/comment-page-2#comments)
4. [3](https://kexue.fm/archives/8397/comment-page-3#comments)
[取消回复](https://kexue.fm/archives/8397#respond-post-8397)
你的大名电子邮箱个人网站（选填）1. 可以使用LaTeX代码，点击“预览效果”可查看效果；
2. 可以通过点击评论楼层编号来引用该楼层；3. 网站可能会有点卡，如非确认评论失败，请**不要重复点击提交**。
********************
### 内容速览5. [二维RoPE](#二维RoPE)
6. [二维位置](#二维位置)
7. [标准答案](#标准答案)
8. [推导思路](#推导思路)
9. [四元数](#四元数)
10. [复数与矩阵](#复数与矩阵)
11. [四元数简介](#四元数简介)
12. [违背相对性](#违背相对性)
13. [矩阵指数](#矩阵指数)
14. [矩阵指数](#矩阵指数)
15. [一维通解](#一维通解)
16. [二维约束](#二维约束)
17. [RoPE现身](#RoPE现身)
18. [延伸故事](#延伸故事)
19. [文章小结](#文章小结)
********************
### 智能搜索支持整句搜索！网站自动使用[结巴分词](https://github.com/fxsjy/jieba)进行分词，并结合ngrams排序算法给出合理的搜索结果。
********************
### 热门标签[生成模型](https://kexue.fm/tag/生成模型/)[attention](https://kexue.fm/tag/attention/)[优化](https://kexue.fm/tag/优化/)[语言模型](https://kexue.fm/tag/语言模型/)[模型](https://kexue.fm/tag/模型/)[网站](https://kexue.fm/tag/网站/)[梯度](https://kexue.fm/tag/梯度/)[概率](https://kexue.fm/tag/概率/)[矩阵](https://kexue.fm/tag/矩阵/)[优化器](https://kexue.fm/tag/优化器/)[转载](https://kexue.fm/tag/转载/)[微分方程](https://kexue.fm/tag/微分方程/)[分析](https://kexue.fm/tag/分析/)[天象](https://kexue.fm/tag/天象/)[深度学习](https://kexue.fm/tag/深度学习/)[积分](https://kexue.fm/tag/积分/)[python](https://kexue.fm/tag/python/)[扩散](https://kexue.fm/tag/扩散/)[力学](https://kexue.fm/tag/力学/)[无监督](https://kexue.fm/tag/无监督/)[几何](https://kexue.fm/tag/几何/)[节日](https://kexue.fm/tag/节日/)[生活](https://kexue.fm/tag/生活/)[文本生成](https://kexue.fm/tag/文本生成/)[数论](https://kexue.fm/tag/数论/)
********************
********************
### 随机文章* [意犹未尽——继续光学曲线](https://kexue.fm/archives/1058)
* [【NASA每日一图】春分时刻的土星](https://kexue.fm/archives/143)
* [哥本哈根气候大会召开情况](https://kexue.fm/archives/300)
* [圆满的句号——汽车站的邂逅](https://kexue.fm/archives/947)
* [计算夏至的精确时刻2——提高精确度](https://kexue.fm/archives/906)
* [高斯型积分的微扰展开（二）](https://kexue.fm/archives/3241)
* [关于交错级数的审敛法则](https://kexue.fm/archives/159)
* [无固定点的单摆运动](https://kexue.fm/archives/1344)
* [从谱范数梯度到新式权重衰减的思考](https://kexue.fm/archives/10648)
* [[备份]全国大学生数学建模竞赛论文LaTex模板](https://kexue.fm/archives/2935)
********************
********************
### 最近评论* [且寻](https://kexue.fm/archives/11480/comment-page-1#comment-29057): same。本来想转成二重积分的，但想半天整不出来，搞出来这个半成品...
* [苏剑林](https://kexue.fm/archives/11267/comment-page-1#comment-29056): 是梯度均值为零的假设。这个问题不是在“数值模拟”一节讨论过了吗？而且最终结果跟实际观测是接近的...
* [苏剑林](https://kexue.fm/archives/7180/comment-page-2#comment-29055): X与单位阵的平均平方误差(mse)，作为它跟单位阵的差距，有什么问题？当然取误差最大值也是一个...
* [苏剑林](https://kexue.fm/archives/9209/comment-page-8#comment-29054): 从公式$(12)$到公式$(15)$，都在推导和解释你说的这个事啊，以$\\mathbb{E}\_...
* [苏剑林](https://kexue.fm/archives/8130/comment-page-7#comment-29053): 相对位置编码，似乎没有太多选择了，要不RoPE这种，算是乘性了，要不Alibi这种加性。你还想...
* [苏剑林](https://kexue.fm/archives/11480/comment-page-1#comment-29052): 学习了一下，感觉这个更多是证明，而不是理解？而且这个证明也没有比原始证明简单。我说的缺乏直观理...
* [苏剑林](https://kexue.fm/archives/11320/comment-page-1#comment-29051): 那还不如直接softmax attention？
* [苏剑林](https://kexue.fm/archives/11486/comment-page-1#comment-29050): 可以啊，L1 Norm一定大于等于L2 Norm，所以L1 Norm归一化后模长小于等于1
* [苏剑林](https://kexue.fm/archives/9119/comment-page-14#comment-29049): 你本来要用数值模拟算两重积分，我现在帮你把一重积分算出来了，你只需要算一重积分了，怎么会更难呢...
* [苏剑林](https://kexue.fm/archives/11158/comment-page-1#comment-29048): learned, thanks
********************
********************
### 友情链接* [Cool Papers](https://papers.cool)
* [数学研发](https://bbs.emath.ac.cn)
* [Seatop](http://www.seatop.com.cn/)
* [Xiaoxia](https://xiaoxia.org/)
* [积分表-网络版](https://kexue.fm/sci/integral/index.html)
* [丝路博傲](http://blog.dvxj.com/)
* [数学之家](http://www.2math.cn/)
* [有趣天文奇观](http://interesting-sky.china-vo.org/)
* [TwistedW](http://www.twistedwg.com/)
* [godweiyang](https://godweiyang.com/)
* [AI柠檬](https://blog.ailemon.net/)
* [王登科-DK博客](https://greatdk.com)
* [ESON](https://blog.eson.org/)
* [枫之羽](https://fzhiy.net/)
* [coding-zuo](https://coding-zuo.github.io/)
* [博科园](https://www.bokeyuan.net/)
* [孔皮皮的博客](https://www.kppkkp.top/)
* [运鹏的博客](https://yunpengtai.top/)
* [jiming.site](https://jiming.site/)
* [OmegaXYZ](https://www.omegaxyz.com/)
* [EAI猩球](https://www.robotech.ink/)
* [文举的博客](https://liwenju0.com/)
* [申请链接](https://kexue.fm/links.html)
********************
[![署名-非商业用途-保持一致](https://kexue.fm/usr/themes/geekg/images/cc.gif)](http://creativecommons.org/licenses/by-nc-nd/2.5/cn/)本站采用创作共用版权协议，要求署名、非商业用途和保持一致。转载本站内容必须也遵循“[署名-非商业用途-保持一致](http://creativecommons.org/licenses/by-nc-nd/2.5/cn/)”的创作共用协议。
©2009-2025 Scientific Spaces. All rights reserved. Theme by[laogui](http://www.laogui.com). Powered by[Typecho](http://typecho.org). 备案号:[粤ICP备09093259号-1/2](https://beian.miit.gov.cn/)。