Loading \[MathJax\]/extensions/TeX/boldsymbol.js

![MobileSideBar](https://kexue.fm/usr/themes/geekg/images/slide-button.png)

## SEARCH

## MENU

- [打赏](https://kexue.fm/reward.html)
- [公式](https://kexue.fm/latex.html)
- [天象](https://kexue.fm/ac.html)
- [链接](https://kexue.fm/links.html)
- [时光](https://kexue.fm/me.html)
- [博览](https://kexue.fm/science.html)
- [归档](https://kexue.fm/content.html)

## CATEGORIES

- [千奇百怪](https://kexue.fm/category/Everything)
- [天文探索](https://kexue.fm/category/Astronomy)
- [数学研究](https://kexue.fm/category/Mathematics)
- [物理化学](https://kexue.fm/category/Phy-chem)
- [信息时代](https://kexue.fm/category/Big-Data)
- [生物自然](https://kexue.fm/category/Biology)
- [图片摄影](https://kexue.fm/category/Photograph)
- [问题百科](https://kexue.fm/category/Questions)
- [生活/情感](https://kexue.fm/category/Life-Feeling)
- [资源共享](https://kexue.fm/category/Resources)

## NEWPOSTS

- [让炼丹更科学一些（五）：基于梯度精...](https://kexue.fm/archives/11530)
- [让炼丹更科学一些（四）：新恒等式，...](https://kexue.fm/archives/11494)
- [为什么DeltaNet要加L2 N...](https://kexue.fm/archives/11486)
- [让炼丹更科学一些（三）：SGD的终...](https://kexue.fm/archives/11480)
- [让炼丹更科学一些（二）：将结论推广...](https://kexue.fm/archives/11469)
- [滑动平均视角下的权重衰减和学习率](https://kexue.fm/archives/11459)
- [生成扩散模型漫谈（三十一）：预测数...](https://kexue.fm/archives/11428)
- [Muon优化器指南：快速上手与关键细节](https://kexue.fm/archives/11416)
- [AdamW的Weight RMS的...](https://kexue.fm/archives/11404)
- [n个正态随机数的最大值的渐近估计](https://kexue.fm/archives/11390)

## COMMENTS

- [Bin: 今天偶然从某个论坛看到有人推荐您的博客，定睛一看竟然是华师同院...](https://kexue.fm/archives/1990/comment-page-2#comment-29105)
- [Rapture D: 我有一个问题，为什么不考虑亥姆霍兹定理和斯托克斯公式。](https://kexue.fm/archives/11530/comment-page-1#comment-29104)
- [mofheka: 苏神是还在用jax是么？最近在做基于Google Pathwa...](https://kexue.fm/archives/11390/comment-page-1#comment-29103)
- [长琴: 看懂这篇博客也不是一件容易的事情。](https://kexue.fm/archives/11530/comment-page-1#comment-29102)
- [AlexLi: 苏老师，请教一下(7)式中将 μ(xt) 传给 $p...](https://kexue.fm/archives/9257/comment-page-4#comment-29101)
- [tyler\_zxc: "Performer的思想是将标准的Attention线性化，...](https://kexue.fm/archives/7921/comment-page-2#comment-29100)
- [我: 似乎并非mHC提出矩阵的思想？之前hyper connecti...](https://kexue.fm/archives/11494/comment-page-1#comment-29099)
- [winter: 苏神您好，假如对于比较均匀的attention weightP...](https://kexue.fm/archives/10847/comment-page-1#comment-29098)
- [苏剑林: KL散度、JS散度、W距离啥的，都行啊，看你喜欢哪个](https://kexue.fm/archives/8512/comment-page-2#comment-29097)
- [苏剑林: 没有绝对公平的对比方法，主要看你关心什么。比如，如果只关心推理...](https://kexue.fm/archives/9119/comment-page-14#comment-29096)

## USERLOGIN

- [登录](https://kexue.fm/admin/login.php)

[科学空间\|Scientific Spaces](https://kexue.fm/)

- [登录](https://kexue.fm/admin/login.php)
- [打赏](https://kexue.fm/reward.html)
- [公式](https://kexue.fm/latex.html)
- [天象](https://kexue.fm/ac.html)
- [链接](https://kexue.fm/links.html)
- [时光](https://kexue.fm/me.html)
- [博览](https://kexue.fm/science.html)
- [归档](https://kexue.fm/content.html)

渴望成为一个小飞侠

- [![](https://kexue.fm/usr/themes/geekg/images/rss.png)\\
\\
欢迎订阅](https://kexue.fm/feed)
- [![](https://kexue.fm/usr/themes/geekg/images/mail.png)\\
\\
个性邮箱](https://kexue.fm/archives/119)
- [![](https://kexue.fm/usr/themes/geekg/images/Saturn.png)\\
\\
天象信息](https://kexue.fm/ac.html)
- [![](https://kexue.fm/usr/themes/geekg/images/iss.png)\\
\\
观测ISS](https://kexue.fm/archives/41)
- [![](https://kexue.fm/usr/themes/geekg/images/pi.png)\\
\\
LaTeX](https://kexue.fm/latex.html)
- [![](https://kexue.fm/usr/themes/geekg/images/mlogo.png)\\
\\
关于博主](https://kexue.fm/me.html)

欢迎访问“科学空间”，这里将与您共同探讨自然科学，回味人生百态；也期待大家的分享～

- [**千奇百怪** Everything](https://kexue.fm/category/Everything)
- [**天文探索** Astronomy](https://kexue.fm/category/Astronomy)
- [**数学研究** Mathematics](https://kexue.fm/category/Mathematics)
- [**物理化学** Phy-chem](https://kexue.fm/category/Phy-chem)
- [**信息时代** Big-Data](https://kexue.fm/category/Big-Data)
- [**生物自然** Biology](https://kexue.fm/category/Biology)
- [**图片摄影** Photograph](https://kexue.fm/category/Photograph)
- [**问题百科** Questions](https://kexue.fm/category/Questions)
- [**生活/情感** Life-Feeling](https://kexue.fm/category/Life-Feeling)
- [**资源共享** Resources](https://kexue.fm/category/Resources)

- [**千奇百怪**](https://kexue.fm/category/Everything)
- [**天文探索**](https://kexue.fm/category/Astronomy)
- [**数学研究**](https://kexue.fm/category/Mathematics)
- [**物理化学**](https://kexue.fm/category/Phy-chem)
- [**信息时代**](https://kexue.fm/category/Big-Data)
- [**生物自然**](https://kexue.fm/category/Biology)
- [**图片摄影**](https://kexue.fm/category/Photograph)
- [**问题百科**](https://kexue.fm/category/Questions)
- [**生活/情感**](https://kexue.fm/category/Life-Feeling)
- [**资源共享**](https://kexue.fm/category/Resources)

[首页](https://kexue.fm/) [信息时代](https://kexue.fm/category/Big-Data) Transformer升级之路：6、旋转位置编码的完备性分析

28Dec

# [Transformer升级之路：6、旋转位置编码的完备性分析](https://kexue.fm/archives/9403)

By 苏剑林 \|
2022-12-28 \|
70744位读者 \|

在去年的文章 [《Transformer升级之路：2、博采众长的旋转式位置编码》](https://kexue.fm/archives/8265) 中，笔者提出了旋转位置编码（RoPE），当时的出发点只是觉得用绝对位置来实现相对位置是一件“很好玩的事情”，并没料到其实际效果还相当不错，并为大家所接受，不得不说这真是一个意外之喜。后来，在 [《Transformer升级之路：4、二维位置的旋转式位置编码》](https://kexue.fm/archives/8397) 中，笔者讨论了二维形式的RoPE，并研究了用矩阵指数表示的RoPE的一般解。

既然有了一般解，那么自然就会引出一个问题：我们常用的RoPE，只是一个以二维旋转矩阵为基本单元的分块对角矩阵，如果换成一般解，理论上效果会不会更好呢？本文就来回答这个问题。

## 指数通解 [\#](https://kexue.fm/archives/9403\#%E6%8C%87%E6%95%B0%E9%80%9A%E8%A7%A3)

在 [《Transformer升级之路：4、二维位置的旋转式位置编码》](https://kexue.fm/archives/8397) 中，我们将RoPE抽象地定义为任意满足下式的方阵

\\begin{equation}\\boldsymbol{\\mathcal{R}}\_m^{\\top}\\boldsymbol{\\mathcal{R}}\_n=\\boldsymbol{\\mathcal{R}}\_{n-m}\\label{eq:re}\\end{equation}

然后，我们探讨了如下矩阵指数形式的解

\\begin{equation}\\boldsymbol{\\mathcal{R}}\_n=\\exp n\\boldsymbol{B}\\end{equation}

这里的矩阵指数，不是像Softmax那样的激活函数式的element-wise运算，而是按照泰勒级数定义的“ [Matrix Exponential](https://en.wikipedia.org/wiki/Matrix_exponential)”。根据“ [Baker–Campbell–Hausdorff公式](https://en.wikipedia.org/wiki/Baker%E2%80%93Campbell%E2%80%93Hausdorff_formula)”，我们有

\\begin{equation}\\begin{aligned}
\\boldsymbol{\\mathcal{R}}\_m^{\\top}\\boldsymbol{\\mathcal{R}}\_n=&\\,\\big(\\exp m\\boldsymbol{B}\\big)^{\\top}\\big(\\exp n\\boldsymbol{B}\\big) = \\big(\\exp m\\boldsymbol{B}^{\\top}\\big)\\big(\\exp n\\boldsymbol{B}\\big) \\\
=&\\,\\exp\\left(m\\boldsymbol{B}^{\\top} + n\\boldsymbol{B} + \\frac{1}{2}mn\\left\[\\boldsymbol{B}^{\\top}, \\boldsymbol{B}\\right\]+\\cdots\\right)
\\end{aligned}\\end{equation}

这里\\left\[\\boldsymbol{A}, \\boldsymbol{B}\\right\]=\\boldsymbol{A}\\boldsymbol{B}-\\boldsymbol{B}\\boldsymbol{A}，\\cdots省略的都是m,n的三次或三次以上的项。按照式\\eqref{eq:re}，那么上式指数部分应该等于(n-m)\\boldsymbol{B}，这就推出

\\begin{equation}\\boldsymbol{B}^{\\top} = - \\boldsymbol{B}\\end{equation}

即要求\\boldsymbol{B}是反对称矩阵。

## 正交通解 [\#](https://kexue.fm/archives/9403\#%E6%AD%A3%E4%BA%A4%E9%80%9A%E8%A7%A3)

进一步地，我们有(\\exp \\boldsymbol{B})^{\\top}(\\exp \\boldsymbol{B})=\\exp(\\boldsymbol{B}-\\boldsymbol{B}) = \\boldsymbol{I}和\\exp n\\boldsymbol{B} = \\left(\\exp\\boldsymbol{B}\\right)^n，前者说明\\exp\\boldsymbol{B}是正交矩阵，后者则启示我们这是不是可以推广到任意正交矩阵？不难验证，答案是肯定的，我们有结论：

> 对于任意正交矩阵\\boldsymbol{O}，\\boldsymbol{\\mathcal{R}}\_n=\\boldsymbol{O}^n是满足式\\eqref{eq:re}的解。

值得指出的是，在实数域内，并非所有正交矩阵能写成\\exp\\boldsymbol{B}的形式，所以\\boldsymbol{O}^n实际上比矩阵指数形式更宽泛。从 [《恒等式 det(exp(A)) = exp(Tr(A)) 赏析》](https://kexue.fm/archives/6377) 可知\\det(\\exp(\\boldsymbol{A})) = \\exp(\\text{Tr}(\\boldsymbol{A})) > 0，所以能写成矩阵指数形式的正交矩阵行列式必然大于0（即等于1），事实上这个结果反过来也成立，即行列式等于1的正交矩阵，必然可以写成\\exp\\boldsymbol{B}的形式，其中\\boldsymbol{B}是反对称矩阵。（参考 [《Why can any orthogonal matrix be written as O=e^A》](https://math.stackexchange.com/questions/2467531/why-can-any-orthogonal-matrix-be-written-as-o-ea)）。

对于\\det(\\boldsymbol{O}) = -1的正交矩阵，我们有\\boldsymbol{O}=\\boldsymbol{O}\_+ \\boldsymbol{I}\_-，其中\\boldsymbol{I}\_-是对角线有一个-1、剩下都是1的对角阵，\\boldsymbol{O}\_+是\\det(\\boldsymbol{O}\_+) = 1的正交矩阵，它可以写成\\exp\\boldsymbol{B}的形式，此时\\boldsymbol{O}^n = (\\boldsymbol{O}\_+ \\boldsymbol{I}\_-)^n = \\boldsymbol{I}\_-^n\\exp n\\boldsymbol{B}。这也就是说，即便对于\\det(\\boldsymbol{O}) = -1的\\boldsymbol{O}^n，也只是\\exp n\\boldsymbol{B}的简单变换，所以接下来我们主要研究\\exp n\\boldsymbol{B}形式的解。

## 完备分析 [\#](https://kexue.fm/archives/9403\#%E5%AE%8C%E5%A4%87%E5%88%86%E6%9E%90)

众所周知，我们平时所用的RoPE位置编码，是如下形式的分块对角矩阵：

\\begin{equation}\\scriptsize{\\left(\\begin{array}{cc:cc:cc:cc}
\\cos n\\theta\_0 & -\\sin n\\theta\_0 & 0 & 0 & \\cdots & \\cdots & 0 & 0 \\\
\\sin n\\theta\_0 & \\cos n\\theta\_0 & 0 & 0 & \\cdots & \\cdots & 0 & 0 \\\
\\hdashline
0 & 0 & \\cos n\\theta\_1 & -\\sin n\\theta\_1 & \\cdots & \\cdots & 0 & 0 \\\
0 & 0 & \\sin n\\theta\_1 & \\cos n\\theta\_1 & \\cdots & \\cdots & 0 & 0 \\\
\\hdashline
\\vdots & \\vdots & \\vdots & \\vdots & \\ddots & \\ddots & \\vdots & \\vdots \\\
\\vdots & \\vdots & \\vdots & \\vdots & \\ddots & \\ddots & \\vdots & \\vdots \\\
\\hdashline
0 & 0 & 0 & 0 & \\cdots & \\cdots & \\cos n\\theta\_{d/2-1} & -\\sin n\\theta\_{d/2-1} \\\
0 & 0 & 0 & 0 & \\cdots & \\cdots & \\sin n\\theta\_{d/2-1} & \\cos n\\theta\_{d/2-1} \\\
\\end{array}\\right)}\\end{equation}

它可以简写成

\\begin{equation}\\begin{pmatrix}
\\boldsymbol{R}\_{n\\theta\_0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{0} \\\
\\boldsymbol{0} & \\boldsymbol{R}\_{n\\theta\_1} & \\cdots & \\boldsymbol{0} \\\
\\vdots & \\vdots & \\ddots & \\vdots \\\
\\boldsymbol{0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{R}\_{n\\theta\_{d/2-1}} \\\
\\end{pmatrix} = \\exp n\\begin{pmatrix}
\\boldsymbol{J}\_{\\theta\_0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{0} \\\
\\boldsymbol{0} & \\boldsymbol{J}\_{\\theta\_1} & \\cdots & \\boldsymbol{0} \\\
\\vdots & \\vdots & \\ddots & \\vdots \\\
\\boldsymbol{0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{J}\_{\\theta\_{d/2-1}} \\\
\\end{pmatrix}\\end{equation}

其中

\\begin{equation}\\boldsymbol{R}\_{\\theta} = \\begin{pmatrix} \\cos\\theta & -\\sin\\theta \\\ \\sin\\theta & \\cos\\theta \\end{pmatrix},\\quad \\boldsymbol{J}\_{\\theta} = \\begin{pmatrix} 0 & -\\theta \\\ \\theta & 0\\end{pmatrix}\\end{equation}

这种选择可以说是最简单的一种，其本质原因可以说是为了降低计算量。那么，所谓完备性问题，就是要回答：如上的分块对角矩阵的特例，相比全参数\\exp n\\boldsymbol{B}，是否有能力上的缺失？换句话说，如果不考虑计算量，将\\boldsymbol{B}替换为一般的反对称矩阵，效果是否可能会有提升？

回答这个问题不困难，事实上，对于任意偶数阶反对称矩阵，它都可以对角化为分块对角矩阵

\\begin{equation}\\boldsymbol{\\Lambda} = \\begin{pmatrix}
\\boldsymbol{J}\_{\\theta\_0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{0} \\\
\\boldsymbol{0} & \\boldsymbol{J}\_{\\theta\_1} & \\cdots & \\boldsymbol{0} \\\
\\vdots & \\vdots & \\ddots & \\vdots \\\
\\boldsymbol{0} & \\boldsymbol{0} & \\cdots & \\boldsymbol{J}\_{\\theta\_{d/2-1}} \\\
\\end{pmatrix}\\end{equation}

该结论可以参考 [Skew-symmetric matrix](https://en.wikipedia.org/wiki/Skew-symmetric_matrix#Spectral_theory)。也就是说，存在可逆矩阵\\boldsymbol{P}，使得\\boldsymbol{B}=\\boldsymbol{P}\\boldsymbol{\\Lambda}\\boldsymbol{P}^{-1}，于是

\\begin{equation}\\exp n\\boldsymbol{B} = \\exp \\left(n\\boldsymbol{P}\\boldsymbol{\\Lambda}\\boldsymbol{P}^{-1}\\right) = \\boldsymbol{P}(\\exp n\\boldsymbol{\\Lambda})\\boldsymbol{P}^{-1}\\end{equation}

也就是说，任意的\\exp n\\boldsymbol{B}与分块对角的\\exp n\\boldsymbol{\\Lambda}，仅仅相差一个相似变换，而我们在Self Attention中应用RoPE时，是

\\begin{equation}\\boldsymbol{q}^{\\top}\\big(\\exp (n-m)\\boldsymbol{B}\\big)\\boldsymbol{k} = \\big(\\boldsymbol{P}^{\\top}\\boldsymbol{q}\\big)^{\\top}\\big(\\exp (n-m)\\boldsymbol{\\Lambda}\\big)\\big(\\boldsymbol{P}^{-1}\\boldsymbol{k}\\big)\\end{equation}

由于\\boldsymbol{q},\\boldsymbol{k}一般都是输入\\boldsymbol{x}经过某个可学习的线性变换而来，\\boldsymbol{P}^{\\top},\\boldsymbol{P}^{-1}原则上都可以吸收到线性变换的训练参数中，因此直接设为\\boldsymbol{q}^{\\top}\\big(\\exp (n-m)\\boldsymbol{\\Lambda}\\big)\\boldsymbol{k}理论上不会损失一般性。

所以，对于Self Attention来说，问题的答案是否定的。不过，如果是 [线性Attention](https://kexue.fm/archives/%E7%BA%BF%E6%80%A7Attention%E7%9A%84%E6%8E%A2%E7%B4%A2%EF%BC%9AAttention%E5%BF%85%E9%A1%BB%E6%9C%89%E4%B8%AASoftmax%E5%90%97%EF%BC%9F)，答案会有少许区别，因为线性Attention的\\boldsymbol{q},\\boldsymbol{k}加了个激活函数：

\\begin{equation}\\phi(\\boldsymbol{q})^{\\top}\\big(\\exp (n-m)\\boldsymbol{B}\\big)\\varphi(\\boldsymbol{k}) = \\big(\\boldsymbol{P}^{\\top}\\phi(\\boldsymbol{q})\\big)^{\\top}\\big(\\exp (n-m)\\boldsymbol{\\Lambda}\\big)\\big(\\boldsymbol{P}^{-1}\\varphi(\\boldsymbol{k})\\big)\\end{equation}

这就导致了\\boldsymbol{P}^{\\top},\\boldsymbol{P}^{-1}不一定能吸收到线性变换的训练参数中，因此对线性Attention补上两个参数矩阵，是有可能带来提升的。

## 文章小结 [\#](https://kexue.fm/archives/9403\#%E6%96%87%E7%AB%A0%E5%B0%8F%E7%BB%93)

本文简单分析了RoPE的完备性问题，表明对于Self Attention来说，目前的分块对角型RoPE不会损失一般性。

_**转载到请包括本文地址：** [https://kexue.fm/archives/9403](https://kexue.fm/archives/9403 "Transformer升级之路：6、旋转位置编码的完备性分析")_

_**更详细的转载事宜请参考：**_ [《科学空间FAQ》](https://kexue.fm/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8 "《科学空间FAQ》")

**如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。**

**如果您觉得本文还不错，欢迎 [分享](https://kexue.fm/archives/9403#share)/ [打赏](https://kexue.fm/archives/9403#pay) 本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！**

打赏

![科学空间](https://kexue.fm/usr/themes/geekg/payment/wx.png)

微信打赏

![科学空间](https://kexue.fm/usr/themes/geekg/payment/zfb.png)

支付宝打赏

因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。

你还可以 [**点击这里**](http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=tN7d1drY3drrx8H0xcWa19vZ) 或在下方评论区留言来告知你的建议或需求。

**如果您需要引用本文，请参考：**

苏剑林. (Dec. 28, 2022). 《Transformer升级之路：6、旋转位置编码的完备性分析 》\[Blog post\]. Retrieved from [https://kexue.fm/archives/9403](https://kexue.fm/archives/9403)

@online{kexuefm-9403,

         title={Transformer升级之路：6、旋转位置编码的完备性分析},

         author={苏剑林},

         year={2022},

         month={Dec},

         url={\\url{https://kexue.fm/archives/9403}},

}


分类： [信息时代](https://kexue.fm/category/Big-Data)    标签： [矩阵](https://kexue.fm/tag/%E7%9F%A9%E9%98%B5/), [attention](https://kexue.fm/tag/attention/), [位置编码](https://kexue.fm/tag/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81/), [rope](https://kexue.fm/tag/rope/)[20 评论](https://kexue.fm/archives/9403#comments)

< [生成扩散模型漫谈（十五）：构建ODE的一般步骤（中）](https://kexue.fm/archives/9379 "生成扩散模型漫谈（十五）：构建ODE的一般步骤（中）") \| [智能家居之热水器零冷水技术原理浅析](https://kexue.fm/archives/9405 "智能家居之热水器零冷水技术原理浅析") >

### 你也许还对下面的内容感兴趣

- [为什么DeltaNet要加L2 Normalize？](https://kexue.fm/archives/11486 "为什么DeltaNet要加L2 Normalize？")
- [Muon优化器指南：快速上手与关键细节](https://kexue.fm/archives/11416 "Muon优化器指南：快速上手与关键细节")
- [流形上的最速下降：5\. 对偶梯度下降](https://kexue.fm/archives/11388 "流形上的最速下降：5. 对偶梯度下降")
- [低精度Attention可能存在有偏的舍入误差](https://kexue.fm/archives/11371 "低精度Attention可能存在有偏的舍入误差")
- [随机矩阵的谱范数的快速估计](https://kexue.fm/archives/11335 "随机矩阵的谱范数的快速估计")
- [为什么线性注意力要加Short Conv？](https://kexue.fm/archives/11320 "为什么线性注意力要加Short Conv？")
- [流形上的最速下降：4\. Muon + 谱球面](https://kexue.fm/archives/11241 "流形上的最速下降：4. Muon + 谱球面")
- [流形上的最速下降：3\. Muon + Stiefel](https://kexue.fm/archives/11221 "流形上的最速下降：3. Muon + Stiefel")
- [流形上的最速下降：2\. Muon + 正交](https://kexue.fm/archives/11215 "流形上的最速下降：2. Muon + 正交")
- [矩阵r次方根和逆r次方根的高效计算](https://kexue.fm/archives/11175 "矩阵r次方根和逆r次方根的高效计算")

[发表你的看法](https://kexue.fm/archives/9403#comment_form)

[Doraemonzzz](https://doraemonzzz.com/)

December 28th, 2022

苏神，我们的一篇工作从类似的角度讨论了这个问题，有一些实验结果：https://openreview.net/forum?id=xMWFqb5Uyk&referrer=%5BAuthor%20Console%5D(%2Fgroup%3Fid%3DICLR.cc%2F2023%2FConference%2FAuthors%23your-submissions)

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20653#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
December 28th, 2022

好的好的，感谢推荐，我等会拜读一下。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20654#respond-post-9403)

[Doraemonzzz](https://doraemonzzz.com/) 发表于
December 28th, 2022

苏神，我添加了spaces\_ac\_cn微信，可否通过一下。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20655#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
December 28th, 2022

已通过

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20663#respond-post-9403)

Enrico Shippole

January 7th, 2023

Dear Su Jianlin,

I was wondering how you handled issues relating to length extrapolation for Rotary Embeddings and relative positional encoding for the encoder? From my understanding, Rotary Embeddings work best for the decoder since they do not length-generalize that well.

I greatly admire and appreciate your research.

Thank you,

Enrico

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20712#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
January 9th, 2023

Thanks for your appreciation. In next 2 blog posts I will discuss this topic.

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20718#respond-post-9403)

Cecilia Lee

January 11th, 2023

式子（10）和（11）第一个括号上是不是少了一个转置

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20732#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
January 13th, 2023

你说\\big(\\exp (n-m)\\boldsymbol{B}\\big)？为什么要多一个转置？

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20746#respond-post-9403)

test123

January 18th, 2023

想请教一下公式10，左右两边是怎么相等的？

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20771#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
January 19th, 2023

因为式(9)

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20782#respond-post-9403)

test123 发表于
January 19th, 2023

那不是应该

\\begin{equation}\\boldsymbol{q}^{\\top}\\big(\\exp (n-m)\\boldsymbol{B}\\big)\\boldsymbol{k} = \\big(\\boldsymbol{q}^{\\top}\\boldsymbol{p}\\big)\\big(\\exp (n-m)\\boldsymbol{\\Lambda}\\big)\\big(\\boldsymbol{P}^{-1}\\boldsymbol{k}\\big)\\end{equation}

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20785#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
January 30th, 2023

哦哦，对的，我忘记多写个转置了。已修正，谢谢指出。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=20816#respond-post-9403)

Mr Yan

July 9th, 2023

请教一下，如果m，n属于R^2,那这个公式会推导成什么样子。

我现在在研究输入不是一行文本，而是一个矩阵文本的情形，需要用R^2来表示位置坐标。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=22182#respond-post-9403)

Mr Yan 发表于
July 9th, 2023

抱歉，之前看过第四篇文章，忘记了，我重新拜读一遍再提问..

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=22183#respond-post-9403)

Mr Yan 发表于
July 9th, 2023

实验了一下RoPE 2D，我是把输入的向量分别施加x和y的一维RoPE，然后拼起来（输出的embedding比输入维度翻了一倍），然后发现确实收敛速度快了不少，最终效果也有提升。

基本上是

绝对位置编码 1D < RoPE 1D < 绝对位置编码 2D < RoPE 2D

我的任务上最终精度，绝对位置编码 2D 和 RoPE 2D没特别多，但是在收敛速度上有非常明显的提升。

大神666

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=22187#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
July 10th, 2023

好的，恭喜，那就假设您已经解决了这个问题哈。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=22207#respond-post-9403)

sdz0114 发表于
October 1st, 2025

您好，最近在学习一些RoPE的相关知识，想咨询下您实现的RoPE 2D就是对每个token，进行X和Y的RoPE，然后concat对吗？

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=28602#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
October 3rd, 2025

每个token的hidden state，一半的dims做X的RoPE，另一半的dims做Y的RoPE，然后拼接。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=28614#respond-post-9403)

whc

December 16th, 2025

https://arxiv.org/abs/2502.02562 里提出两种低成本parameterize P的方法

其中之一是用DFT matrix作为固定的P, 这样运算速度不太慢，效果上也有一些提升，尤其是机器人相关任务上

您觉得这个工作有意思么

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=29011#respond-post-9403)

[苏剑林](https://kexue.fm/) 发表于
December 18th, 2025

感觉看场景吧，如果是文本llm下感觉没什么必要性。

[回复评论](https://kexue.fm/archives/9403/comment-page-1?replyTo=29020#respond-post-9403)

[取消回复](https://kexue.fm/archives/9403#respond-post-9403)

你的大名

电子邮箱

个人网站（选填）

1\. 可以使用LaTeX代码，点击“预览效果”可查看效果；

2\. 可以通过点击评论楼层编号来引用该楼层；

3\. 网站可能会有点卡，如非确认评论失败，请 **不要重复点击提交**。

### 内容速览

[指数通解](https://kexue.fm/archives/9403#%E6%8C%87%E6%95%B0%E9%80%9A%E8%A7%A3)
[正交通解](https://kexue.fm/archives/9403#%E6%AD%A3%E4%BA%A4%E9%80%9A%E8%A7%A3)
[完备分析](https://kexue.fm/archives/9403#%E5%AE%8C%E5%A4%87%E5%88%86%E6%9E%90)
[文章小结](https://kexue.fm/archives/9403#%E6%96%87%E7%AB%A0%E5%B0%8F%E7%BB%93)

### 智能搜索

支持整句搜索！网站自动使用 [结巴分词](https://github.com/fxsjy/jieba) 进行分词，并结合ngrams排序算法给出合理的搜索结果。

### 热门标签

[生成模型](https://kexue.fm/tag/%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/) [attention](https://kexue.fm/tag/attention/) [优化](https://kexue.fm/tag/%E4%BC%98%E5%8C%96/) [语言模型](https://kexue.fm/tag/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/) [模型](https://kexue.fm/tag/%E6%A8%A1%E5%9E%8B/) [梯度](https://kexue.fm/tag/%E6%A2%AF%E5%BA%A6/) [网站](https://kexue.fm/tag/%E7%BD%91%E7%AB%99/) [概率](https://kexue.fm/tag/%E6%A6%82%E7%8E%87/) [矩阵](https://kexue.fm/tag/%E7%9F%A9%E9%98%B5/) [优化器](https://kexue.fm/tag/%E4%BC%98%E5%8C%96%E5%99%A8/) [转载](https://kexue.fm/tag/%E8%BD%AC%E8%BD%BD/) [微分方程](https://kexue.fm/tag/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/) [分析](https://kexue.fm/tag/%E5%88%86%E6%9E%90/) [天象](https://kexue.fm/tag/%E5%A4%A9%E8%B1%A1/) [深度学习](https://kexue.fm/tag/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/) [积分](https://kexue.fm/tag/%E7%A7%AF%E5%88%86/) [python](https://kexue.fm/tag/python/) [扩散](https://kexue.fm/tag/%E6%89%A9%E6%95%A3/) [力学](https://kexue.fm/tag/%E5%8A%9B%E5%AD%A6/) [无监督](https://kexue.fm/tag/%E6%97%A0%E7%9B%91%E7%9D%A3/) [几何](https://kexue.fm/tag/%E5%87%A0%E4%BD%95/) [节日](https://kexue.fm/tag/%E8%8A%82%E6%97%A5/) [生活](https://kexue.fm/tag/%E7%94%9F%E6%B4%BB/) [文本生成](https://kexue.fm/tag/%E6%96%87%E6%9C%AC%E7%94%9F%E6%88%90/) [数论](https://kexue.fm/tag/%E6%95%B0%E8%AE%BA/)

### 随机文章

- [生成扩散模型漫谈（二十一）：中值定理加速ODE采样](https://kexue.fm/archives/9881)
- [漫谈几何量子化](https://kexue.fm/archives/2348)
- [【理解黎曼几何】5\. 黎曼曲率](https://kexue.fm/archives/4014)
- [四次方程的根式求解（通俗版）](https://kexue.fm/archives/114)
- [科学空间：2011年6月重要天象](https://kexue.fm/archives/1370)
- [用RecomposIt简单给图片换背景](https://kexue.fm/archives/622)
- [exp(x)在x=0处的偶次泰勒展开式总是正的](https://kexue.fm/archives/7919)
- [概率视角下的线性模型：逻辑回归有解析解吗？](https://kexue.fm/archives/8578)
- [又是一年农耕时...](https://kexue.fm/archives/825)
- [狄拉克函数：级数逼近](https://kexue.fm/archives/4187)

### 最近评论

- [Bin](https://kexue.fm/archives/1990/comment-page-2#comment-29105): 今天偶然从某个论坛看到有人推荐您的博客，定睛一看竟然是华师同院的往届师兄！看到这篇2013年的...
- [Rapture D](https://kexue.fm/archives/11530/comment-page-1#comment-29104): 我有一个问题，为什么不考虑亥姆霍兹定理和斯托克斯公式。
- [mofheka](https://kexue.fm/archives/11390/comment-page-1#comment-29103): 苏神是还在用jax是么？最近在做基于Google Pathway的理念做一个动态版的MPMD框...
- [长琴](https://kexue.fm/archives/11530/comment-page-1#comment-29102): 看懂这篇博客也不是一件容易的事情。
- [AlexLi](https://kexue.fm/archives/9257/comment-page-4#comment-29101): 苏老师，请教一下(7)式中将 \\mu(x\_t) 传给 p\_o 进行推理的操作。 $x\_...
- [tyler\_zxc](https://kexue.fm/archives/7921/comment-page-2#comment-29100): "Performer的思想是将标准的Attention线性化，所以为什么不干脆直接训练一个线性...
- [我](https://kexue.fm/archives/11494/comment-page-1#comment-29099): 似乎并非mHC提出矩阵的思想？之前hyper connection就是了
- [winter](https://kexue.fm/archives/10847/comment-page-1#comment-29098): 苏神您好，假如对于比较均匀的attention weightP，往往呈现long tail分布...
- [苏剑林](https://kexue.fm/archives/8512/comment-page-2#comment-29097): KL散度、JS散度、W距离啥的，都行啊，看你喜欢哪个
- [苏剑林](https://kexue.fm/archives/9119/comment-page-14#comment-29096): 没有绝对公平的对比方法，主要看你关心什么。比如，如果只关心推理成本和推理效果，那么有的方法可以...

### 友情链接

- [Cool Papers](https://papers.cool/)
- [数学研发](https://bbs.emath.ac.cn/)
- [Seatop](http://www.seatop.com.cn/)
- [Xiaoxia](https://xiaoxia.org/)
- [积分表-网络版](https://kexue.fm/sci/integral/index.html)
- [丝路博傲](http://blog.dvxj.com/)
- [数学之家](http://www.2math.cn/)
- [有趣天文奇观](http://interesting-sky.china-vo.org/)
- [TwistedW](http://www.twistedwg.com/)
- [godweiyang](https://godweiyang.com/)
- [AI柠檬](https://blog.ailemon.net/)
- [王登科-DK博客](https://greatdk.com/)
- [ESON](https://blog.eson.org/)
- [枫之羽](https://fzhiy.net/)
- [coding-zuo](https://coding-zuo.github.io/)
- [博科园](https://www.bokeyuan.net/)
- [孔皮皮的博客](https://www.kppkkp.top/)
- [运鹏的博客](https://yunpengtai.top/)
- [jiming.site](https://jiming.site/)
- [OmegaXYZ](https://www.omegaxyz.com/)
- [EAI猩球](https://www.robotech.ink/)
- [文举的博客](https://liwenju0.com/)
- [申请链接](https://kexue.fm/links.html)

[![署名-非商业用途-保持一致](https://kexue.fm/usr/themes/geekg/images/cc.gif)](http://creativecommons.org/licenses/by-nc-nd/2.5/cn/) 本站采用创作共用版权协议，要求署名、非商业用途和保持一致。转载本站内容必须也遵循“ [署名-非商业用途-保持一致](http://creativecommons.org/licenses/by-nc-nd/2.5/cn/)”的创作共用协议。



© 2009-2026 Scientific Spaces. All rights reserved. Theme by [laogui](http://www.laogui.com/). Powered by [Typecho](http://typecho.org/). 备案号: [粤ICP备09093259号-1/2](https://beian.miit.gov.cn/ "粤ICP备09093259号")。