## SEARCH

## MENU

- [打赏](https://kexue.fm/reward.html)
- [公式](https://kexue.fm/latex.html)
- [天象](https://kexue.fm/ac.html)
- [链接](https://kexue.fm/links.html)
- [时光](https://kexue.fm/me.html)
- [博览](https://kexue.fm/science.html)
- [归档](https://kexue.fm/content.html)

## CATEGORIES

- [千奇百怪](https://kexue.fm/category/Everything)
- [天文探索](https://kexue.fm/category/Astronomy)
- [数学研究](https://kexue.fm/category/Mathematics)
- [物理化学](https://kexue.fm/category/Phy-chem)
- [信息时代](https://kexue.fm/category/Big-Data)
- [生物自然](https://kexue.fm/category/Biology)
- [图片摄影](https://kexue.fm/category/Photograph)
- [问题百科](https://kexue.fm/category/Questions)
- [生活/情感](https://kexue.fm/category/Life-Feeling)
- [资源共享](https://kexue.fm/category/Resources)

## NEWPOSTS

- [msign的导数](https://kexue.fm/archives/11025)
- [通过msign来计算mclip（奇...](https://kexue.fm/archives/11006)
- [msign算子的Newton-Sc...](https://kexue.fm/archives/10996)
- [等值振荡定理：最优多项式逼近的充要条件](https://kexue.fm/archives/10972)
- [生成扩散模型漫谈（三十）：从瞬时速...](https://kexue.fm/archives/10958)
- [MoE环游记：5、均匀分布的反思](https://kexue.fm/archives/10945)
- [msign算子的Newton-Sc...](https://kexue.fm/archives/10922)
- [Transformer升级之路：2...](https://kexue.fm/archives/10907)
- [一道概率不等式：盯着它到显然成立为止！](https://kexue.fm/archives/10902)
- [SVD的导数](https://kexue.fm/archives/10878)

## COMMENTS

- [盏一: 哦哦哦 你是说 $\\exp nB$ 是正交矩阵! 并不是说 B.](https://kexue.fm/archives/8397/comment-page-3#comment-27910)
- [盏一: 呃, 是我脑子乱了... 忘了 $\\exp(0) = I$. ...](https://kexue.fm/archives/8397/comment-page-3#comment-27909)
- [盏一: 呃, 是我脑子乱了... 忘了 $\\exp(0) = I$. ...](https://kexue.fm/archives/8397/comment-page-3#comment-27908)
- [盏一: 苏神, 请教一下\> 并且还可以证明它一定是正交矩阵是怎么证明的...](https://kexue.fm/archives/8397/comment-page-3#comment-27907)
- [sk: 请问公式14是怎么得出来的？](https://kexue.fm/archives/8265/comment-page-8#comment-27906)
- [tll1945tll1937: 真心实意的向大家请教问题：看了文章“对齐全量微调！这是我看过最...](https://kexue.fm/archives/10266/comment-page-1#comment-27901)
- [oYo\_logan: \[comment=27017\]苏剑林\[/comment\]苏神，...](https://kexue.fm/archives/10757/comment-page-1#comment-27897)
- [z123: 在参数矩阵较多的CNN小模型上，Muon会明显慢于Adam，这...](https://kexue.fm/archives/10592/comment-page-1#comment-27896)
- [dry: 苏神好，一直有个疑问，ReFlow构建的ODE是$dx\_t/d...](https://kexue.fm/archives/10958/comment-page-2#comment-27895)
- [tyj: 感觉和之前的一篇文章很像，应该算是concurrent wor...](https://kexue.fm/archives/10958/comment-page-2#comment-27894)

## USERLOGIN

- [登录](https://kexue.fm/admin/login.php)

[科学空间\|Scientific Spaces](https://kexue.fm)

- [登录](https://kexue.fm/admin/login.php)
- [打赏](https://kexue.fm/reward.html)
- [公式](https://kexue.fm/latex.html)
- [天象](https://kexue.fm/ac.html)
- [链接](https://kexue.fm/links.html)
- [时光](https://kexue.fm/me.html)
- [博览](https://kexue.fm/science.html)
- [归档](https://kexue.fm/content.html)

渴望成为一个小飞侠

- [欢迎订阅](https://kexue.fm/feed)
- [个性邮箱](https://kexue.fm/archives/119)
- [天象信息](https://kexue.fm/ac.html)
- [观测ISS](https://kexue.fm/archives/41)
- [LaTeX](https://kexue.fm/latex.html)
- [关于博主](https://kexue.fm/me.html)

欢迎访问“科学空间”，这里将与您共同探讨自然科学，回味人生百态；也期待大家的分享～

- [**千奇百怪** Everything](https://kexue.fm/category/Everything)
- [**天文探索** Astronomy](https://kexue.fm/category/Astronomy)
- [**数学研究** Mathematics](https://kexue.fm/category/Mathematics)
- [**物理化学** Phy-chem](https://kexue.fm/category/Phy-chem)
- [**信息时代** Big-Data](https://kexue.fm/category/Big-Data)
- [**生物自然** Biology](https://kexue.fm/category/Biology)
- [**图片摄影** Photograph](https://kexue.fm/category/Photograph)
- [**问题百科** Questions](https://kexue.fm/category/Questions)
- [**生活/情感** Life-Feeling](https://kexue.fm/category/Life-Feeling)
- [**资源共享** Resources](https://kexue.fm/category/Resources)

- [**千奇百怪**](https://kexue.fm/category/Everything)
- [**天文探索**](https://kexue.fm/category/Astronomy)
- [**数学研究**](https://kexue.fm/category/Mathematics)
- [**物理化学**](https://kexue.fm/category/Phy-chem)
- [**信息时代**](https://kexue.fm/category/Big-Data)
- [**生物自然**](https://kexue.fm/category/Biology)
- [**图片摄影**](https://kexue.fm/category/Photograph)
- [**问题百科**](https://kexue.fm/category/Questions)
- [**生活/情感**](https://kexue.fm/category/Life-Feeling)
- [**资源共享**](https://kexue.fm/category/Resources)

[首页](https://kexue.fm) [数学研究](https://kexue.fm/category/Mathematics) [信息时代](https://kexue.fm/category/Big-Data) 生成扩散模型漫谈（二十一）：中值定理加速ODE采样

7Dec

# [生成扩散模型漫谈（二十一）：中值定理加速ODE采样](https://kexue.fm/archives/9881)

By 苏剑林 \|
2023-12-07 \|
118892位读者\|

在生成扩散模型的发展史上， [DDIM](https://kexue.fm/archives/9181) 和同期Song Yang的 [扩散SDE](https://kexue.fm/archives/9209) 都称得上是里程碑式的工作，因为它们建立起了扩散模型与随机微分方程（SDE）、常微分方程（ODE）这两个数学领域的紧密联系，从而允许我们可以利用SDE、ODE已有的各种数学工具来对分析、求解和拓展扩散模型，比如后续大量的加速采样工作都以此为基础，可以说这打开了生成扩散模型的一个全新视角。

本文我们聚焦于ODE。在本系列的 [（六）](https://kexue.fm/archives/9228)、 [（十二）](https://kexue.fm/archives/9280)、 [（十四）](https://kexue.fm/archives/9370)、 [（十五）](https://kexue.fm/archives/9379)、 [（十七）](https://kexue.fm/archives/9497) 等博客中，我们已经推导过ODE与扩散模型的联系，本文则对扩散ODE的采样加速做简单介绍，并重点介绍一种巧妙地利用“中值定理”思想的新颖采样加速方案“AMED”。

## 欧拉方法 [\#](https://kexue.fm/archives/9881\#%E6%AC%A7%E6%8B%89%E6%96%B9%E6%B3%95)

正如前面所说，我们已经有多篇文章推导过扩散模型与ODE的联系，所以这里不重复介绍，而是直接将扩散ODE的采样定义为如下ODE的求解：
\\begin{equation}\\frac{d\\boldsymbol{x}\_t}{dt} = \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)\\label{eq:dm-ode}\\end{equation}
其中$t\\in\[0,T\]$，初值条件是$\\boldsymbol{x}\_T$，要返回的结果是$\\boldsymbol{x}\_0$。原则上我们并不关心$t\\in(0,1)$时的中间值$\\boldsymbol{x}\_t$，只需要最终的$\\boldsymbol{x}\_0$。为了数值求解，我们还需要选定节点$0=t\_0 < t\_1 < t\_2 < \\cdots < t\_N = T$，常见的选择是
\\begin{equation}t\_n=\\left(t\_1^{1 / \\rho}+\\frac{n-1}{N-1}\\left(t\_N^{1 / \\rho}-t\_1^{1 / \\rho}\\right)\\right)^\\rho\\end{equation}
其中$\\rho > 0$。该形式来自 [《Elucidating the Design Space of Diffusion-Based Generative Models》](https://papers.cool/arxiv/2206.00364)（EDM），AMED也沿用了该方案，个人认为节点的选择不算关键要素，因此本文对此不做深究。

最简单的求解器是“欧拉方法”：利用差分近似
\\begin{equation}\\left.\\frac{d\\boldsymbol{x}\_t}{dt}\\right\|\_{t=t\_{n+1}}\\approx \\frac{\\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{x}\_{t\_n}}{t\_{n+1} - t\_n}\\end{equation}
我们可以得到
\\begin{equation}\\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})(t\_{n+1} - t\_n)\\end{equation}
这通常也直接称为DDIM方法，因为是DDIM首先注意到它的采样过程对应于ODE的欧拉法，继而反推出对应的ODE。

## 高阶方法 [\#](https://kexue.fm/archives/9881\#%E9%AB%98%E9%98%B6%E6%96%B9%E6%B3%95)

从数值求解的角度来看，欧拉方法属于一阶近似，特点是简单快捷，缺点是精度差，所以步长不能太小，这意味着单纯利用欧拉法不大可能明显降低采样步数并且保证采样质量。因此，后续的采样加速工作都应用了更高阶的方法。

比如，直觉上差分$\\frac{\\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{x}\_{t\_n}}{t\_{n+1} - t\_n}$应该更接近中间点的导数而不是边界的导数，所以右端也换成$t\_n$和$t\_{n+1}$的平均应该会有更高的精度：
\\begin{equation}\\frac{\\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{x}\_{t\_n}}{t\_{n+1} - t\_n}\\approx \\frac{1}{2}\\left\[\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_n}, t\_n) + \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})\\right\]\\label{eq:heun-0}\\end{equation}
由此我们可以得到
\\begin{equation}\\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\frac{1}{2}\\left\[\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_n}, t\_n) + \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})\\right\](t\_{n+1} - t\_n) \\end{equation}
然而，右端出现了$\\boldsymbol{x}\_{t\_n}$，而我们要做的就是计算$\\boldsymbol{x}\_{t\_n}$，所以这样的等式并不能直接用来迭代，为此，我们用欧拉方法“预估”一下$\\boldsymbol{x}\_{t\_n}$，然后替换掉上式中的$\\boldsymbol{x}\_{t\_n}$：
\\begin{equation}\\begin{aligned}
\\tilde{\\boldsymbol{x}}\_{t\_n}=&\\, \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})(t\_{n+1} - t\_n) \\\
\\boldsymbol{x}\_{t\_n}\\approx&\\, \\boldsymbol{x}\_{t\_{n+1}} - \\frac{1}{2}\\left\[\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\tilde{\\boldsymbol{x}}\_{t\_n}, t\_n) + \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})\\right\](t\_{n+1} - t\_n)
\\end{aligned}\\label{eq:heun}\\end{equation}
这就是EDM所用的“ [Heun方法](https://en.wikipedia.org/wiki/Heun%27s_method)”，是一种二阶方法。这样每步迭代需要算两次$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)$，但精度明显提高，因此可以明显减少迭代步数，总的计算成本是降低的。

二阶方法还有很多变体，比如式$\\eqref{eq:heun-0}$的右端我们可以直接换成中间点$t=(t\_n+t\_{n+1})/2$的函数值，这得到
\\begin{equation}\\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}\\left(\\boldsymbol{x}\_{(t\_n+t\_{n+1})/2}, \\frac{t\_n+t\_{n+1}}{2}\\right)(t\_{n+1} - t\_n) \\end{equation}
中间点也有不同的求法，除了代数平均$(t\_n+t\_{n+1})/2$外，也可以考虑几何平均
\\begin{equation}\\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}\\left(\\boldsymbol{x}\_{\\sqrt{t\_n t\_{n+1}}}, \\sqrt{t\_n t\_{n+1}}\\right)(t\_{n+1} - t\_n) \\label{eq:dpm-solver-2}\\end{equation}
事实上，式$\\eqref{eq:dpm-solver-2}$就是 [DPM-Solver-2](https://papers.cool/arxiv/2206.00927) 的一个特例。

除了二阶方法外，ODE的求解还有不少更高阶的方法，如" [Runge-Kutta方法](https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods)”、“ [线性多步法](https://en.wikipedia.org/wiki/Linear_multistep_method)”等。然而，不管是二阶方法还是高阶方法，虽然都能一定程度上加速扩散ODE的采样，但由于这些都是“通法”，没有针对扩散模型的背景和形式进行定制，因此很难将采样过程的计算步数降到极致（个位数）。

## 中值定理 [\#](https://kexue.fm/archives/9881\#%E4%B8%AD%E5%80%BC%E5%AE%9A%E7%90%86)

至此，本文的主角AMED登场了，其论文 [《Fast ODE-based Sampling for Diffusion Models in Around 5 Steps》](https://papers.cool/arxiv/2312.00094) 前两天才放到Arxiv，可谓“新鲜滚热辣”。AMED并非像传统的ODE求解器那样一味提高理论精度，而是巧妙地类比了“中值定理”，并加上非常小的蒸馏成本，为扩散ODE **定制** 了高速的求解器。

几种扩散ODE-Solver示意图

首先，我们对方程$\\eqref{eq:dm-ode}$两端积分，那么可以写出精确的等式：
\\begin{equation} \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{x}\_{t\_n} = \\int\_{t\_n}^{t\_{n+1}}\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)dt\\end{equation}
如果$\\boldsymbol{v}$只是一维的标量函数，那么由“ [积分中值定理](https://en.wikipedia.org/wiki/Mean_value_theorem#Mean_value_theorems_for_definite_integrals)”我们可以知道存在点$s\_n\\in(t\_n, t\_{n+1})$，使得
\\begin{equation}\\frac{1}{t\_{n+1} - t\_n}\\int\_{t\_n}^{t\_{n+1}}\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)dt = \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{s\_n}, s\_n) \\end{equation}
很遗憾，中值定理对一般的向量函数并不成立。不过，在$t\_{n+1}-t\_n$不太大以及一定的假设之下，我们依然可以类比地写出近似
\\begin{equation}\\frac{1}{t\_{n+1} - t\_n}\\int\_{t\_n}^{t\_{n+1}}\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)dt \\approx \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{s\_n}, s\_n) \\end{equation}
于是我们得到
\\begin{equation} \\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{s\_n}, s\_n)(t\_{n+1}-t\_n)\\end{equation}
当然，目前还只是一个形式解，$s\_n$和$\\boldsymbol{x}\_{s\_n}$怎么来还未解决。对于$\\boldsymbol{x}\_{s\_n}$，我们依然用欧拉方法进行预估，即$\\tilde{\\boldsymbol{x}}\_{s\_n}= \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})(t\_{n+1} - s\_n)$；对于$s\_n$，我们则用一个小型的神经网络去估计它：
\\begin{equation}s\_n = g\_{\\boldsymbol{\\phi}}(\\boldsymbol{h}\_{t\_{n+1}}, t\_{n+1})\\end{equation}
其中$\\boldsymbol{\\phi}$是训练参数，$\\boldsymbol{h}\_{t\_{n+1}}$是U-Net模型$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, t\_{n+1})$的中间特征。最后，为了求解参数$\\boldsymbol{\\phi}$，我们采用蒸馏的思想，预先用步数更多的求解器求出精度更高的轨迹点对$(\\boldsymbol{x}\_{t\_n},\\boldsymbol{x}\_{t\_{n+1}})$，然后最小化估计误差。这就是论文中的AMED-Solver（ **A** pproximate **ME** an- **D** irection Solver），它具备常规ODE-Solver的形式，但又需要额外的蒸馏成本，然而这点蒸馏成本相比其他蒸馏加速方法又几乎可以忽略不计，所以笔者将它理解为“定制”求解器。

定制一词非常关键，扩散ODE的采样加速研究由来已久，在众多研究人员的贡献加成下，非训练的求解器大概已经走了非常远，但依然未能将采样步数降到极致，除非未来我们对扩散模型的理论理解有进一步的突破，否则笔者不认为非训练的求解器还有显著的提升空间。因此，AMED这种带有少量训练成本的加速度，既是“剑走偏锋”、“另辟蹊径”，也是“应运而生”、“顺理成章”。

## 实验结果 [\#](https://kexue.fm/archives/9881\#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C)

在看实验结果之前，我们首先了解一个名为“NFE”的概念，全称是“Number of Function Evaluations”，说白了就是模型$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)$的执行次数，它跟计算量直接挂钩。比如，一阶方法每步迭代的NFE是1，因为只需要执行一次$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_t, t)$，而二阶方法每一步迭代的NFE是2，AMED-Solver的$g\_{\\boldsymbol{\\phi}}$计算量很小，可以忽略不计，所以AMED-Solver每一步的NFE也算是2。为了实现公平的比较，需要保持整个采样过程中总的NFE不变，来对比不同Solver的效果。

基本的实验结果是原论文的Table 2：

AMED的实验结果（Table 2）

这个表格有几个值得特别留意的地方。第一，在NFE不超过5时，二阶的DPM-Solver、EDM效果还不如一阶的DDIM，这是因为Solver的误差不仅跟阶次有关，还跟步长$t\_{n+1}-t\_n$有关，大致上的关系就是$\\mathcal{O}((t\_{n+1}-t\_n)^m)$，其中$m$就是“阶”，在总NFE较小时，高阶方法只能取较大的步长，所以实际精度反而更差，从而效果不佳；第二，同样是二阶方法的SMED-Solver，在小NFE时效果取得了全面SOTA，这充分体现了“定制”的重要性；第三，这里的“AMED-Plugin”是原论文提出的将AMED的思想作为其他ODESolver的“插件”的用法，细节更加复杂一些，但取得了更好的效果。

可能有读者会疑问：既然二阶方法每一步迭代都需要2个NFE，那么表格中怎么会出现奇数的NFE？其实，这是因为作者用到了一个名为“AFS（Analytical First Step）”的技巧来减少了1个NFE。该技巧出自 [《Genie: Higher-order denoising diffusion solvers》](https://papers.cool/arxiv/2210.05475)，具体是指在扩散模型背景下我们发现$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_N}, t\_N)$与$\\boldsymbol{x}\_{t\_N}$非常接近（不同的扩散模型表现可能不大一样，但核心思想都是第一步可以直接解析求解），于是在采样的第一步直接用$\\boldsymbol{x}\_{t\_N}$替代$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_N}, t\_N)$，这就省了一个NFE。论文附录的Table 8、Table 9、Table 10也更详尽地评估了AFS对效果的影响，有兴趣的读者可以自行分析。

最后，由于AMED使用了蒸馏的方法来训练$g\_{\\boldsymbol{\\phi}}$，那么也许会有读者想知道它跟其他蒸馏加速的方案的效果差异，不过很遗憾，论文没有提供相关对比。为此我也邮件咨询过作者，作者表示AMED的蒸馏成本是极低的，CIFAR10只需要在单张A100上训练不到20分钟，256大小的图片也只需要在4张A100上训练几个小时，而相比之下其他蒸馏加速的思路需要的时间是数天甚至数十天，因此作者将AMED视为Solver的工作而不是蒸馏的工作。不过作者也表示，后面有机会也尽可能补上跟蒸馏工作的对比。

## 假设分析 [\#](https://kexue.fm/archives/9881\#%E5%81%87%E8%AE%BE%E5%88%86%E6%9E%90)

前面在讨论中值定理到向量函数的推广时，我们提到“一定的假设之下”，那么这里的假设是什么呢？是否真的成立呢？

不难举出反例证明，即便是二维函数积分中值定理都不恒成立，换言之积分中值定理只在一维函数上成立，这意味着如果高维函数成立积分中值定理，那么该函数所描述的空间轨迹只能是一条直线，也就是说采样过程中所有的$\\boldsymbol{x}\_{t\_0},\\boldsymbol{x}\_{t\_1},\\cdots,\\boldsymbol{x}\_{t\_N}$构成一条直线。这个假设自然非常强，实际上几乎不可能成立，但也侧面告诉我们，要想积分中值定理在高维空间尽可能成立，那么采样轨迹要保持在一个尽可能低维的子空间中。

为了验证这一点，论文作者加大了采样步数得到了较为精确的采样轨迹，然后对轨迹做主成分分析，结果如下图所示：

扩散ODE采样轨迹的主成分分析

主成分分析的结果显示，只保留top1的主成分，就可以保留轨迹的大部分精度，而同时保留前两个主成本，那么后面的误差几乎可以忽略了，这告诉我们采样轨迹几乎都集中在一个二维子平面上，甚至非常接近这个子平面上的的一个直线，于是在$t\_{n+1}-t\_n$并不是特别大的时候，扩散模型的高维空间的积分中值定理也近似成立。

这个结果可能会让人比较意外，但事后来看其实也能解释：在 [《生成扩散模型漫谈（十五）：构建ODE的一般步骤（中）》](https://kexue.fm/archives/9379)、 [《生成扩散模型漫谈（十七）：构建ODE的一般步骤（下）》](https://kexue.fm/archives/9497) 我们介绍了先指定$\\boldsymbol{x}\_T$到$\\boldsymbol{x}\_0$的“伪轨迹”，然后再构建对应的扩散ODE的一般步骤，而实际应用中，我们所构建的“伪轨迹”都是$\\boldsymbol{x}\_T$与$\\boldsymbol{x}\_0$的线性插值（关于$t$可能是非线性的，关于$\\boldsymbol{x}\_T$和$\\boldsymbol{x}\_0$则是线性的），于是构建的“伪轨迹”都是直线，这会进一步鼓励真实的扩散轨迹是一条直线，这就解释了主成分分析的结果。

## 文章小结 [\#](https://kexue.fm/archives/9881\#%E6%96%87%E7%AB%A0%E5%B0%8F%E7%BB%93)

本文简单回顾了扩散ODE的采样加速方法，并重点介绍了前两天刚发布的一个名为“AMED”的新颖加速采样方案，该Solver类比了积分中值定理来构建迭代格式，以极低的蒸馏成本提高了Solver在低NFE时的表现。

_**转载到请包括本文地址：** [https://kexue.fm/archives/9881](https://kexue.fm/archives/9881)_

_**更详细的转载事宜请参考：**_ [《科学空间FAQ》](https://kexue.fm/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8)

**如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。**

**如果您觉得本文还不错，欢迎 [分享](https://kexue.fm/archives/9881#share)/ [打赏](https://kexue.fm/archives/9881#pay) 本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！**

打赏

微信打赏

支付宝打赏

因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以 [**点击这里**](http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=tN7d1drY3drrx8H0xcWa19vZ) 或在下方评论区留言来告知你的建议或需求。

**如果您需要引用本文，请参考：**

苏剑林. (Dec. 07, 2023). 《生成扩散模型漫谈（二十一）：中值定理加速ODE采样 》\[Blog post\]. Retrieved from [https://kexue.fm/archives/9881](https://kexue.fm/archives/9881)

@online{kexuefm-9881,
        title={生成扩散模型漫谈（二十一）：中值定理加速ODE采样},
        author={苏剑林},
        year={2023},
        month={Dec},
        url={\\url{https://kexue.fm/archives/9881}},
}

分类： [数学研究](https://kexue.fm/category/Mathematics), [信息时代](https://kexue.fm/category/Big-Data)    标签： [微分方程](https://kexue.fm/tag/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/), [生成模型](https://kexue.fm/tag/%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/), [扩散](https://kexue.fm/tag/%E6%89%A9%E6%95%A3/)[52 评论](https://kexue.fm/archives/9881#comments)

< [我在Performer中发现了Transformer-VQ的踪迹](https://kexue.fm/archives/9862) \| [注意力机制真的可以“集中注意力”吗？](https://kexue.fm/archives/9889) >

### 你也许还对下面的内容感兴趣

- [生成扩散模型漫谈（三十）：从瞬时速度到平均速度](https://kexue.fm/archives/10958)
- [Transformer升级之路：20、MLA究竟好在哪里？](https://kexue.fm/archives/10907)
- [生成扩散模型漫谈（二十九）：用DDPM来离散编码](https://kexue.fm/archives/10711)
- [细水长flow之TARFLOW：流模型满血归来？](https://kexue.fm/archives/10667)
- [生成扩散模型漫谈（二十八）：分步理解一致性模型](https://kexue.fm/archives/10633)
- [生成扩散模型漫谈（二十七）：将步长作为条件输入](https://kexue.fm/archives/10617)
- [生成扩散模型漫谈（二十六）：基于恒等式的蒸馏（下）](https://kexue.fm/archives/10567)
- [VQ的又一技巧：给编码表加一个线性变换](https://kexue.fm/archives/10519)
- [VQ的旋转技巧：梯度直通估计的一般推广](https://kexue.fm/archives/10489)
- [通向最优分布之路：概率空间的最小化](https://kexue.fm/archives/10289)

[发表你的看法](https://kexue.fm/archives/9881#comment_form)

[生成扩散模型漫谈（二十一）：中值定理加速ODE采样 R11; AI 資訊](https://news.aitime.space/2023/12/74497/)

December 7th, 2023

\[...\]​Read More \[...\]

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23229#respond-post-9881)

梁宇辰

December 8th, 2023

这和Progressive Distillation把多步的teacher蒸到少步数的student有什么区别呢....Consistency Model和CONSISTENCY TRAJECTORY MODEL还考虑了求解的一致性，还有一阶段训练的Consistency Training方法，比这种先进的得多啊。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23232#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 8th, 2023

跟纯粹的蒸馏方法相比，蒸馏成本低很多；跟Consistency Training相比的话...我觉得Consistency Training有点丑...

这个方法特点是保留了Solver本身的特性，一次训练完之后，可以改变NFE来实现不同质量的生成结果。从蒸馏的角度来看的话，可以看作是发现了可以用solver来简化student model的结构。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23241#respond-post-9881)

梁宇辰 发表于
December 8th, 2023

我get到了，蒸馏需要记录下这个中值梯度，而这个solve只需要给出中值位置，用teacher给出梯度，所以solve可以很轻量

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23242#respond-post-9881)

梁宇辰 发表于
December 9th, 2023

不过现有的发展趋势如果像CT一阶段就能训出，只需要很少NFE的类diffusion模型，定制求解器这一方向是不是就没那么重要了呢

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23244#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 9th, 2023

我不大确定，Consistency Training虽然是一阶段的，但是它总训练成本跟“正常训练一个DDPM（或者其它ODE扩散模型） + AMED蒸馏”哪个高呢？相比于扩散模型本身的训练成本，AMED蒸馏几乎可以忽略不计的，那么就看Consistency Training跟原本扩散模型的训练成本差距了。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23245#respond-post-9881)

梁宇辰 发表于
December 9th, 2023

我做的实验是没什么额外成本，甚至有可能通过课程学习大幅降低成本。至于精度损失，又很容易用GAN微调回来

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23246#respond-post-9881)

梁宇辰 发表于
December 9th, 2023

如果考虑GAN微调这种“耍赖”的技术得话，1step是有独特价值的。AMED看起来是至少两次NFE,如果能想办法内置到DDPM,变成1step看起来是不错的思路

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23247#respond-post-9881)

defang 发表于
December 9th, 2023

AMED跟各种ODE-Solver的方法一样，不改变原始梯度场，而Progressive Distillation，Consistency Distillation等等方法是通过改变一些点的梯度场来加速采样。这是他们之间的本质区别。
其次，AMED的思路也可以推广到更少的NFE，这在理论上没有区别。

梁宇辰 发表于
December 9th, 2023

AMED可以看做一种微调技术，冻结DDPM引入少量新参数进行蒸馏训练

solitary\_tian 发表于
January 25th, 2024

您好，请问GAN微调是什么意思呢？有没有什么论文中讲解过这个方法呢

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23595#respond-post-9881)

sdqwqasdasd

December 11th, 2023

这种优化思路会对$g\_\\phi$的输出或者推理步数会有限制吗？$g\_\\phi$的输出是否也要限制在区间$（t\_n，t\_{n+1}）$里？如果给定采样步数$N$进行训练，那么推理的时候是不是好像也得固定$N$效果才最好？另外,如果将$(14)$式中的$h\_{t\_{n+1}}$换成$x\_{t\_{n+1}}$会对结果产生什么程度的影响吗？鄙人知识尚浅，希望多指教！

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23253#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 11th, 2023

$g\_{\\boldsymbol{\\phi}}$只需要输出一个0～1之间的数，然后做变换$t\_n + g\_{\\boldsymbol{\\phi}}(t\_{n+1}-t\_n)$即可（或者其他$\[0,1\]$到$\[t\_n,t\_{n+1}\]$的映射）。

AMED之所以自称Solver，是因为它单次训练之后，还是可以自由地改变NFE以达到不同的生成效果，所以结论是无须固定。

$g\_{\\boldsymbol{\\phi}}$的输入换成$\\boldsymbol{x}\_{t\_{n+1}}$理论上自然没问题，但这可能会让$g\_{\\boldsymbol{\\phi}}$的计算量明显增加（毕竟直接处理原始图片）。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23256#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

不同的节点选择，中值的位置不是会变化吗，AMED应该依赖于节点吧？如果需要自由变化NFE和节点那么需要$h\_{t\_{n+1}}, t\_{n+1}, t\_{n}$三个输入吧,就像CTM那样

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23258#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 11th, 2023

对的，AMED需要先选定$t\_0,t\_1,\\cdots,t\_N$，然后AMED的作用就是用$g\_{\\boldsymbol{\\phi}}$在$t\_i,t\_{i+1}$之间插入一个中间点，它的AMED-Plugin也是这样推广到一般的Solver。

所以如果想改变NFE，那么只需要改变$t\_0,t\_1,\\cdots,t\_N$中的$N$就行。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23260#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

那如果想改变N，不就需要重训solve吗

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23262#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 11th, 2023

AMED的意思是不需要，一次训练，结果可以改变$N$使用。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23266#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

那AMED是怎么识别不同的N呢，有N这个输入项吗

sdqwqasdasd 发表于
December 11th, 2023

可能一个比较说服力的消融实验是随机选一点作为$s\_n$的估计，和训练过后的$g\_\\phi$做对比，不过我在实验部分没看见。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23263#respond-post-9881)

defang 发表于
December 11th, 2023

Table 6已经对s\_n进行了网格搜索，可以看出中间点的取值对结果影响很大。随机选取情况下，NFE=4对应FID 130+，NFE=6对应FID 50+

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23274#respond-post-9881)

sdqwqasdasd 发表于
December 12th, 2023

这个只能说明选取某一个$r$比较好，况且tab.6的那个$r$不是固定DPM-Solver-2的参数吗？不是随机的吧。我很好奇$s\_n$的输出分布，如果不同的$t$的$g\_\\phi$的输出是一致的，那是不是在推理阶段变成非参，并且保证效果？
不过我还是很疑惑为什么它能自由地改变$N$而保持高性能，我们设$s\_n$是基于$N$的前提下采样$(x\_{t\_n},x\_{t\_{n+1}})$作为输入和优化目标，那么目标函数应该是 $\\min\_\\phi\|\|x\_{t\_{n+1}} -v\_\\theta(x\_{t\_{n+1}}-v\_\\theta(x\_{t\_{n+1}},t\_{n+1})(t\_{n+1}-g\_\\phi(h\_{t\_{n+1}},t\_{n+1})),g\_\\phi(h\_{t\_{n+1}},t\_{n+1})))(t\_{n+1}-t\_n)-x\_{t\_n}\|\|$.
一旦$N$变了，那么这个优化目标不就错了吗？中间那一项$v\_\\theta(x\_{t\_{n+1}}-v\_\\theta(x\_{t\_{n+1}},t\_{n+1})(t\_{n+1}-g\_\\phi(h\_{t\_{n+1}},t\_{n+1})),g\_\\phi(h\_{t\_{n+1}},t\_{n+1})))(t\_{n+1}-t\_n)$由于$v\_\\theta$内的函数只与$t\_{n+1}$有关，而后面乘积那一项$(t\_{n+1}-t\_n)$可以视为常数权重,按道理他只会学会一种常数权重的插值模式，但是无论是外推和内插的方式，它对$g\_\\phi$应该是OOD？我不太理解这一点。如果只是说这么训练的效果就是好，那么我就很怀疑是不是能总结出一个很general的$s\_n$，对任意N的采样都能达到一个非常好的效果。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23285#respond-post-9881)

sdqwqasdasd 发表于
December 12th, 2023

退一步来说，如果不同的$N$均训练需要训练不同的solver，这篇工作的价值是不是就可能没有那么大了？因为不具备迁移性。另外，如果以高阶ODE求解方法预先生成轨迹，那么这个方法的性能的上界应该就是高阶ODE，所以这一篇文章的主要贡献应该就是对高阶ODE进行蒸馏？

defang 发表于
December 12th, 2023

1\. 随机的结果之前已经回复了。Fig 7已经给了s\_n的输出分布。
2\. 针对不同的N需要训练不同的$g\_\\phi$，而$g\_\\phi$仅有18k参数，储存和推理成本都非常小。此外，由于不同轨迹几何结构类似，还可以让所有轨迹共享权重（time-wise，网络输入只有t），进而只需存下$g\_\\phi$得到的schedule进行采样即可。这跟以consistency models为代表的蒸馏方法相比，计算量完全不在一个数量级。我们追求的是随着NFE的增加，效果能稳定提升。该性质以consistency models为代表的蒸馏方法不能满足。
3\. 上限显然是teacher跑出来的结果。注意teacher可以通过不断增加NFE提升自身的效果。teacher和student可以是相同的solver也可以是不同的solver。该论文的贡献在于，在不改变原始梯度场的情况下（与各种ODE-Solver的方法相同）找approximate mean direction，而非通过改变一些点的梯度场（如Progressive Distillation，Consistency Distillation等）来实现加速采样。

sdqwqasdasd 发表于
December 12th, 2023

fig 7的一致性我看还是挺高的（浅色的部分应该是方差？），那是不是可以直接用这个训练出来的参数作为每个$s\_n$的估计，效果应该也挺不错的？也就是说不同的$x\_{t\_{n+1}}$并不会影响结果，就像你说的，我们只需要$t\_{n+1}$作为网络的唯一输入，那么$t$是离散的话，那么网络只会输出同等量级的答案，所以其实可以不用网络？

sdqwqasdasd 发表于
December 12th, 2023

大致了解了，谢谢你的解答，这个schedule不知道有没有更好的办法得到，用蒸馏的方法我个人感觉不算太巧妙，不过确实也是一种可行的思路。

梁宇辰

December 11th, 2023

我觉得主要诟病的地方是生成大量ODE的GT本身就很耗时，consistency是在线进行单步求解的并不需要生成大量ODE的GT

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23264#respond-post-9881)

defang 发表于
December 11th, 2023

Section 4.1 Training部分写了训练时间，AMED比consistency models的训练快了几个数量级。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23267#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

没算生成ODE的时间啊

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23269#respond-post-9881)

defang 发表于
December 11th, 2023

你似乎没有理解这篇论文的方法，AMED不需要预先生成ODE

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23272#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

见论文Alg1 Generate teacher trajectory

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23273#respond-post-9881)

defang 发表于
December 11th, 2023

1\. 我们计算是总时间，包括你所谓的生成轨迹时间.
2\. teacher trajectory是在线生成的，跟consistency models随机取时间点在期望意义下没有区别。总时间主要由iteration和参数量决定。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23275#respond-post-9881)

梁宇辰 发表于
December 11th, 2023

cifar10单卡生成20k张图就得十多分钟，再加训练时间5-20min这好怪哦

梁宇辰 发表于
December 11th, 2023

AMED的训练不需要在线生成，如果选择在线生成反而比较不合理

defang 发表于
December 11th, 2023

1\. 写了A100，不需要5分钟
2\. 哪种都无所谓，关键的是计算量很小。这跟consistency models完全不是一个数量级，也不是一类方法。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23278#respond-post-9881)

梁宇辰 发表于
December 12th, 2023

我在V100上用EDM的源码和环境20步的求解生成20k需要20多分钟，A100的速度一般是2.2倍。所以我看到他报告的时间，就默认他刨去ODE求解了。如果真的包含了，就快得难以置信了。

梁宇辰 发表于
December 12th, 2023

谢谢您的解答，我还有个疑问是不同的N是一次训练的solver，还是多个分别训练的solve呢

zhyzhou 发表于
December 12th, 2023

1\. EDM默认用Heun solver求解，一步是2NFE。按照EDM源码，num\_steps=20时，NFE=39，花20分钟是正常的。AMED中teacher NFE最高为20。十分钟的gap跟consistency models的训练开销相比可以忽略不计。
2\. 预测$s\_n$也要求知道$t\_n$，$t\_{n+1}$，所以不同的$N$也是需要训练不同的$g\_\\phi$。此外可以补充的是，$g\_\\phi$仅有18k参数，储存和推理成本都非常小。由于不同轨迹几何结构类似，还可以让所有轨迹共享权重（time-wise，网络输入只有$t$），进而只需存下$g\_\\phi$得到的schedule进行采样即可。

梁宇辰 发表于
December 11th, 2023

公平比较得让CM只针对一组特定的节点训练，同时冻结DDPM主干使用训练参数量相当的微调技术，再使用一种最先进solve求解。这么比AMDE这个精度不见得有优势。。蒸馏还没有中值定理不存在这种理论上的偏差

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23271#respond-post-9881)

梁宇辰 发表于
December 12th, 2023

哈哈，如此轻量让人有牺牲一些训练成本换取精度的冲动

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23281#respond-post-9881)

报告大王

December 17th, 2023

Bespoke Solvers for Generative Flow Models 也是类似的思想，但参数量更少，期待苏神解析。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23308#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
December 19th, 2023

感谢推荐，有空读读。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23320#respond-post-9881)

朱彦霖

January 4th, 2024

期待苏老师讲解一下一致性模型

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=23441#respond-post-9881)

zzz528491

September 6th, 2024

请问几种扩散ODE-Solver示意图中深色的实线和虚线分别是什么意思？

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25156#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
September 6th, 2024

实线是理想轨迹，虚线是初始点有所偏离后形成的轨迹。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25165#respond-post-9881)

zzz528491 发表于
September 7th, 2024

请问这种偏移是怎么形成的？

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25170#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
September 9th, 2024

大家都是从$\\boldsymbol{x}\_T$出发，绝对精确地求解方程得到一条准确的轨迹（实线）；

不精确的求解方法会得到不精确的$\\boldsymbol{x}\_{T-1}$，然后从$\\boldsymbol{x}\_{T-1}$出发，绝对精确地求解方程则得到一条稍微不精确的轨迹（虚线1）；

从不精确的$\\boldsymbol{x}\_{T-1}$出发，不精确的求解方法会得到不精确的$\\boldsymbol{x}\_{T-2}$，然后从$\\boldsymbol{x}\_{T-2}$出发，绝对精确地求解方程则得到一条更加不精确的轨迹（虚线2）；

依此类推。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25185#respond-post-9881)

zzz528491

September 7th, 2024

您好，我不太理解原文中使用不同的sn形成baseline trajectory和searched trajectory有什么作用，这个表示的意义是什么

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25171#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
September 9th, 2024

不就是想证明精细地搜索$s\_n$能取得更好的结果吗

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25186#respond-post-9881)

wwwwwwwzk

September 10th, 2024

想问一下原文里teacher trajectory那里用M个插值点是怎么进行生成的，不是只需要一个插值点就好了吗，用M个插值点要怎么进行迭代，是用M个插值点都试一下然后选最好的吗

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25207#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
September 12th, 2024

这个我记得好像是用来构建高阶采样器的。

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25214#respond-post-9881)

zzz528491

September 24th, 2024

请问为什么AMED-Solver每一步的NFE是2，好像每次只对v计算一次，从公式来看应该怎么理解呢？

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25302#respond-post-9881)

[苏剑林](https://kexue.fm) 发表于
September 28th, 2024

首先$\\boldsymbol{x}\_{t\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{s\_n}, s\_n)(t\_{n+1}-t\_n)$，这需要一步$\\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{s\_n}, s\_n)$，但别忘了$\\boldsymbol{x}\_{s\_n}$是不知道的，还需要用欧拉法估计一下，即$\\boldsymbol{x}\_{s\_n}\\approx \\boldsymbol{x}\_{t\_{n+1}} - \\boldsymbol{v}\_{\\boldsymbol{\\theta}}(\\boldsymbol{x}\_{t\_{n+1}}, s\_n)(t\_{n+1}-s\_n)$

[回复评论](https://kexue.fm/archives/9881/comment-page-1?replyTo=25324#respond-post-9881)

[取消回复](https://kexue.fm/archives/9881#respond-post-9881)

你的大名

电子邮箱

个人网站（选填）

1\. 可以使用LaTeX代码，点击“预览效果”可查看效果；2. 可以通过点击评论楼层编号来引用该楼层；3. 网站可能会有点卡，如非确认评论失败，请 **不要重复点击提交**。

### 内容速览

[欧拉方法](https://kexue.fm/archives/9881#%E6%AC%A7%E6%8B%89%E6%96%B9%E6%B3%95)
[高阶方法](https://kexue.fm/archives/9881#%E9%AB%98%E9%98%B6%E6%96%B9%E6%B3%95)
[中值定理](https://kexue.fm/archives/9881#%E4%B8%AD%E5%80%BC%E5%AE%9A%E7%90%86)
[实验结果](https://kexue.fm/archives/9881#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C)
[假设分析](https://kexue.fm/archives/9881#%E5%81%87%E8%AE%BE%E5%88%86%E6%9E%90)
[文章小结](https://kexue.fm/archives/9881#%E6%96%87%E7%AB%A0%E5%B0%8F%E7%BB%93)

### 智能搜索

支持整句搜索！网站自动使用 [结巴分词](https://github.com/fxsjy/jieba) 进行分词，并结合ngrams排序算法给出合理的搜索结果。

### 热门标签

[生成模型](https://kexue.fm/tag/%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/) [attention](https://kexue.fm/tag/attention/) [优化](https://kexue.fm/tag/%E4%BC%98%E5%8C%96/) [语言模型](https://kexue.fm/tag/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/) [模型](https://kexue.fm/tag/%E6%A8%A1%E5%9E%8B/) [网站](https://kexue.fm/tag/%E7%BD%91%E7%AB%99/) [概率](https://kexue.fm/tag/%E6%A6%82%E7%8E%87/) [梯度](https://kexue.fm/tag/%E6%A2%AF%E5%BA%A6/) [转载](https://kexue.fm/tag/%E8%BD%AC%E8%BD%BD/) [微分方程](https://kexue.fm/tag/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/) [矩阵](https://kexue.fm/tag/%E7%9F%A9%E9%98%B5/) [天象](https://kexue.fm/tag/%E5%A4%A9%E8%B1%A1/) [分析](https://kexue.fm/tag/%E5%88%86%E6%9E%90/) [深度学习](https://kexue.fm/tag/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/) [积分](https://kexue.fm/tag/%E7%A7%AF%E5%88%86/) [python](https://kexue.fm/tag/python/) [优化器](https://kexue.fm/tag/%E4%BC%98%E5%8C%96%E5%99%A8/) [力学](https://kexue.fm/tag/%E5%8A%9B%E5%AD%A6/) [无监督](https://kexue.fm/tag/%E6%97%A0%E7%9B%91%E7%9D%A3/) [扩散](https://kexue.fm/tag/%E6%89%A9%E6%95%A3/) [几何](https://kexue.fm/tag/%E5%87%A0%E4%BD%95/) [节日](https://kexue.fm/tag/%E8%8A%82%E6%97%A5/) [生活](https://kexue.fm/tag/%E7%94%9F%E6%B4%BB/) [文本生成](https://kexue.fm/tag/%E6%96%87%E6%9C%AC%E7%94%9F%E6%88%90/) [数论](https://kexue.fm/tag/%E6%95%B0%E8%AE%BA/)

### 随机文章

- [短文本匹配Baseline：脱敏数据使用预训练模型的尝试](https://kexue.fm/archives/8213)
- [VQ的又一技巧：给编码表加一个线性变换](https://kexue.fm/archives/10519)
- [Python的多进程编程技巧](https://kexue.fm/archives/4231)
- [基于Conditional Layer Normalization的条件文本生成](https://kexue.fm/archives/7124)
- [OCR技术浅探：6. 光学识别](https://kexue.fm/archives/3831)
- [【备忘】访问Google的几个方式](https://kexue.fm/archives/2643)
- [从谱范数梯度到新式权重衰减的思考](https://kexue.fm/archives/10648)
- [GPLinker：基于GlobalPointer的事件联合抽取](https://kexue.fm/archives/8926)
- [【NASA每日一图】Messier 88](https://kexue.fm/archives/384)
- [把地球放到“宇宙中心”...](https://kexue.fm/archives/477)

### 最近评论

- [盏一](https://kexue.fm/archives/8397/comment-page-3#comment-27910): 哦哦哦 你是说 $\\exp nB$ 是正交矩阵! 并不是说 B.
- [盏一](https://kexue.fm/archives/8397/comment-page-3#comment-27909): 呃, 是我脑子乱了... 忘了 $\\exp(0) = I$. 所以只要 $\\Vert B^T+...
- [盏一](https://kexue.fm/archives/8397/comment-page-3#comment-27908): 呃, 是我脑子乱了... 忘了 $\\exp(0) = I$. 所以只要 $\\Vert B^T+...
- [盏一](https://kexue.fm/archives/8397/comment-page-3#comment-27907): 苏神, 请教一下\> 并且还可以证明它一定是正交矩阵是怎么证明的. 我本来以为隐式利用了 $\\V...
- [sk](https://kexue.fm/archives/8265/comment-page-8#comment-27906): 请问公式14是怎么得出来的？
- [tll1945tll1937](https://kexue.fm/archives/10266/comment-page-1#comment-27901): 真心实意的向大家请教问题：看了文章“对齐全量微调！这是我看过最精彩的LoRA改进（二）”，我实...
- [oYo\_logan](https://kexue.fm/archives/10757/comment-page-1#comment-27897): \[comment=27017\]苏剑林\[/comment\]苏神，想请教一下，我理解在一个batc...
- [z123](https://kexue.fm/archives/10592/comment-page-1#comment-27896): 在参数矩阵较多的CNN小模型上，Muon会明显慢于Adam，这方面有什么优化提速的方案吗？
- [dry](https://kexue.fm/archives/10958/comment-page-2#comment-27895): 苏神好，一直有个疑问，ReFlow构建的ODE是$dx\_t/dt=x\_1-x\_0$，为什么这并...
- [tyj](https://kexue.fm/archives/10958/comment-page-2#comment-27894): 感觉和之前的一篇文章很像，应该算是concurrent work： https://arxiv...

### 友情链接

- [Cool Papers](https://papers.cool)
- [数学研发](https://bbs.emath.ac.cn)
- [Seatop](http://www.seatop.com.cn/)
- [Xiaoxia](https://xiaoxia.org/)
- [积分表-网络版](https://kexue.fm/sci/integral/index.html)
- [丝路博傲](http://blog.dvxj.com/)
- [ph4ntasy 饭特稀](http://www.ph4ntasy.com/)
- [数学之家](http://www.2math.cn/)
- [有趣天文奇观](http://interesting-sky.china-vo.org/)
- [TwistedW](http://www.twistedwg.com/)
- [godweiyang](https://godweiyang.com/)
- [AI柠檬](https://blog.ailemon.net/)
- [王登科-DK博客](https://greatdk.com)
- [ESON](https://blog.eson.org/)
- [枫之羽](https://fzhiy.net/)
- [Mathor's blog](https://wmathor.com/)
- [coding-zuo](https://coding-zuo.github.io/)
- [博科园](https://www.bokeyuan.net/)
- [孔皮皮的博客](https://www.kppkkp.top/)
- [运鹏的博客](https://yunpengtai.top/)
- [jiming.site](https://jiming.site/)
- [OmegaXYZ](https://www.omegaxyz.com/)
- [Blog by Eacls](https://www.eacls.top/)
- [EAI猩球](https://www.robotech.ink/)
- [文举的博客](https://liwenju0.com/)
- [用代码打点酱油](https://bruceyuan.com/)
- [申请链接](https://kexue.fm/links.html)

本站采用创作共用版权协议，要求署名、非商业用途和保持一致。转载本站内容必须也遵循“ [署名-非商业用途-保持一致](http://creativecommons.org/licenses/by-nc-nd/2.5/cn/)”的创作共用协议。
© 2009-2025 Scientific Spaces. All rights reserved. Theme by [laogui](http://www.laogui.com). Powered by [Typecho](http://typecho.org). 备案号: [粤ICP备09093259号-1/2](https://beian.miit.gov.cn/)。