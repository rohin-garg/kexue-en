
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    packages: {'[+]': ['ams']},
    tags: 'ams'
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<article>
    <nav style="margin-bottom: 1.5em;">
    <a href="../index.html" style="display: inline-flex; align-items: center; color: #555; text-decoration: none; font-size: 0.95em;">
        <span style="margin-right: 0.3em;">&larr;</span> Back to Index
    </a>
</nav>

    <h1><a href="https://kexue.fm/archives/4368">【Unbelievable Word2Vec】 4. A Different Kind of "Similarity"</a></h1>
    <p>By 苏剑林 | May 1, 2017</p>

    <h2>Definition of Similarity</h2>
    <p>
        When we obtain word vectors using Word2Vec, we generally use cosine similarity to compare the degree of similarity between two words, defined as:
        $$\cos (\boldsymbol{x}, \boldsymbol{y}) = \frac{\boldsymbol{x}\cdot\boldsymbol{y}}{\|\boldsymbol{x}\|\times\|\boldsymbol{y}\|}$$
        With this concept of similarity, we can compare the similarity between any two words or find the words most similar to a given word. In gensim's Word2Vec, this is implemented by the <code>most_similar</code> function.
    </p>
    <p>
        Wait a minute! We quickly provided the mathematical formula for calculating similarity, but we haven't even "defined" what similarity is! How can we arrive at a formula to evaluate similarity without even defining it?
    </p>
    <p>
        It is important to note that this is not an issue that can be casually ignored. Often, we don't know exactly what we are doing before we start doing it. As mentioned in the previous article regarding keyword extraction, I believe many people have never considered what a keyword actually is—is it just a word that is "key"? If we think of keywords as words used to estimate what an article is roughly about, we get a natural definition for keywords:
        $$keywords = \mathop{\text{argmax}}_{w\in s}p(s|w)$$
        From there, we can model it using various methods.
    </p>
    <p>
        Returning to the theme of this article, how do we define similarity? The answer is: it depends on the similarity required by the specific scenario.
    </p>
    <p>
        So, what kind of similarity does cosine similarity provide? In fact, Word2Vec essentially uses the average distribution of context to describe the current word (since Word2Vec does not consider word order). Since the cosine value has nothing to do with the length (norm) of the vector, it describes "relative consistency." Thus, high cosine similarity essentially means that these two words are often paired with the same set of words, or more crudely, that the two words are interchangeable within the same sentence. For example, the words most similar to "Guangzhou" are "Dongguan" and "Shenzhen." This is because, in many scenarios, directly replacing "Guangzhou" in a sentence with "Dongguan" or "Shenzhen" still results in a reasonable sentence (reasonable in terms of sentence structure, though not necessarily factual; for instance, "Guangzhou is the capital of Guangdong" becomes "Dongguan is the capital of Guangdong"—the sentence is structurally sound, but the fact is incorrect).
    </p>
    <blockquote>
        &gt;&gt;&gt; s = u'广州' (Guangzhou)<br>
        &gt;&gt;&gt; pd.Series(model.most_similar(s))<br>
        0 (东莞 [Dongguan], 0.840889930725)<br>
        1 (深圳 [Shenzhen], 0.799216389656)<br>
        2 (佛山 [Foshan], 0.786817014217)<br>
        3 (惠州 [Huizhou], 0.779960155487)<br>
        4 (珠海 [Zhuhai], 0.735232532024)<br>
        5 (厦门 [Xiamen], 0.725090026855)<br>
        6 (武汉 [Wuhan], 0.724122405052)<br>
        7 (汕头 [Shantou], 0.719602525234)<br>
        8 (增城 [Zengcheng], 0.713532149792)<br>
        9 (上海 [Shanghai], 0.710560560226)
    </blockquote>

    <h2>Relevance: Another Kind of Similarity</h2>
    <p>
        As previously mentioned, the definition of similarity depends on the scenario, and cosine similarity is just one of them. Sometimes we might feel that "Dongguan" and "Guangzhou" have no connection at all. For an "old resident of Guangzhou," words like "Baiyun Mountain," "Baiyun Airport," and "Canton Tower" are the ones most similar to "Guangzhou." This scenario is also very common, such as in tourism recommendations. When someone comes to Guangzhou for travel, it is natural to hope that after inputting "Guangzhou," words related to Guangzhou like "Baiyun Mountain," "Baiyun Airport," and "Canton Tower" are automatically output, rather than "Dongguan" or "Shenzhen."
    </p>
    <p>
        This "similarity" is more accurately described as "relevance." How should we describe it? The answer is Mutual Information, defined as:
        $$\log \frac{p(x,y)}{p(x)p(y)}=\log p(y|x) - \log p(y)$$
        The larger the mutual information, the more frequently the words $x$ and $y$ appear together.
    </p>
    <p>
        In this way, given word $x$, we can find words that frequently appear alongside word $x$. This can be accomplished entirely by the Skip-Gram + Huffman Softmax model in Word2Vec. The code is as follows:
    </p>
<pre><code>import numpy as np
import gensim
model = gensim.models.word2vec.Word2Vec.load('word2vec_wx')

def predict_proba(oword, iword):
    iword_vec = model[iword]
    oword = model.wv.vocab[oword]
    oword_l = model.syn1[oword.point].T
    dot = np.dot(iword_vec, oword_l)
    lprob = -sum(np.logaddexp(0, -dot) + oword.code*dot)
    return lprob

from collections import Counter
def relative_words(word):
    r = {i:predict_proba(i, word)-np.log(j.count) for i,j in model.wv.vocab.iteritems()}
    return Counter(r).most_common()
</code></pre>
    <p>At this point, the relevant words for "Guangzhou" are:</p>
    <blockquote>
        &gt;&gt;&gt; s = u'广州' (Guangzhou)<br>
        &gt;&gt;&gt; w = relative_words(s)<br>
        &gt;&gt;&gt; pd.Series(w)<br>
        0 (福中路 [Fuzhong Road], -17.390365773)<br>
        1 (OHG, -17.4582544641)<br>
        2 (林寨镇 [Linzhai Town], -17.6119545612)<br>
        3 (坪山街道 [Pingshan Subdistrict], -17.6462214199)<br>
        4 (东圃镇 [Dongpu Town], -17.6648893759)<br>
        5 (西翼 [West Wing], -17.6796614955)<br>
        6 (北京西 [Beijing West], -17.6898282385)<br>
        7 (⇋, -17.6950761384)<br>
        8 (K1019, -17.7259853233)<br>
        9 (景泰街道 [Jingtai Subdistrict], -17.7292421556)<br>
        10 (PSW3, -17.7296432222)<br>
        11 (广州铁路职业技术学院 [Guangzhou Railway Polytechnic], -17.732288911)<br>
        12 (13A06, -17.7382891287)<br>
        13 (5872, -17.7404719442)<br>
        14 (13816217517, -17.7650583156)<br>
        15 (未遂案 [Attempted Case], -17.7713452536)<br>
        16 (增城市 [Zengcheng City], -17.7713832873)<br>
        17 (第十甫路 [Dixiafu Road], -17.7727940473)<br>
        18 (广州白云机场 [Guangzhou Baiyun Airport], -17.7897457043)<br>
        19 (Faust, -17.7956389314)<br>
        20 (国家档案馆 [National Archives], -17.7971039916)<br>
        21 (w0766fc, -17.8051687721)<br>
        22 (K1020, -17.8106548248)<br>
        23 (陈宝琛 [Chen Baochen], -17.8427718407)<br>
        24 (jinriGD, -17.8647825023)<br>
        25 (3602114109100031646, -17.8729896156)
    </blockquote>
    <p>
        It can be seen that the results obtained are basically all closely related to Guangzhou. Of course, sometimes we like to emphasize high-frequency words slightly; therefore, we can consider modifying the mutual information formula to:
        $$\log \frac{p(x,y)}{p(x)p^{\alpha}(y)}=\log p(y|x) - \alpha\log p(y)$$
        Here, $\alpha$ is a constant slightly less than 1. If we take $\alpha=0.9$, then:
    </p>
<pre><code>from collections import Counter
def relative_words(word):
    r = {i:predict_proba(i, word)-0.9*np.log(j.count) for i,j in model.wv.vocab.iteritems()}
    return Counter(r).most_common()
</code></pre>
    <p>The results rearranged are as follows:</p>
    <blockquote>
        &gt;&gt;&gt; s = u'广州' (Guangzhou)<br>
        &gt;&gt;&gt; w = relative_words(s)<br>
        &gt;&gt;&gt; pd.Series(w)<br>
        0 (福中路 [Fuzhong Road], -16.8342976099)<br>
        1 (北京西 [Beijing West], -16.9316053191)<br>
        2 (OHG, -16.9532688634)<br>
        3 (西翼 [West Wing], -17.0521852934)<br>
        4 (增城市 [Zengcheng City], -17.0523156839)<br>
        5 (广州白云机场 [Guangzhou Baiyun Airport], -17.0557270208)<br>
        6 (林寨镇 [Linzhai Town], -17.0867272184)<br>
        7 (⇋, -17.1061883426)<br>
        8 (坪山街道 [Pingshan Subdistrict], -17.1485480457)<br>
        9 (5872, -17.1627067119)<br>
        10 (东圃镇 [Dongpu Town], -17.192150594)<br>
        11 (PSW3, -17.2013228493)<br>
        12 (Faust, -17.2178736991)<br>
        13 (红粉 [Hongfen], -17.2191157626)<br>
        14 (国家档案馆 [National Archives], -17.2218467278)<br>
        15 (未遂案 [Attempted Case], -17.2220391092)<br>
        16 (景泰街道 [Jingtai Subdistrict], -17.2336594498)<br>
        17 (光孝寺 [Guangxiao Temple], -17.2781121397)<br>
        18 (国际货运代理 [International Freight Forwarding], -17.2810157155)<br>
        19 (第十甫路 [Dixiafu Road], -17.2837591345)<br>
        20 (广州铁路职业技术学院 [Guangzhou Railway Polytechnic], -17.2953441257)<br>
        21 (芳村 [Fangcun], -17.301106775)<br>
        22 (检测院 [Testing Institute], -17.3041253252)<br>
        23 (K1019, -17.3085465963)<br>
        24 (陈宝琛 [Chen Baochen], -17.3134413583)<br>
        25 (林和西 [Linhexi], -17.3150577006)
    </blockquote>
    <p>Relatively speaking, the latter result is more readable. Other results are shown below:</p>
    <blockquote>
        &gt;&gt;&gt; s = u'飞机' (Airplane)<br>
        &gt;&gt;&gt; w = relative_words(s)<br>
        &gt;&gt;&gt; pd.Series(w)<br>
        0 (澳门国际机场 [Macau International Airport], -16.5502216186)<br>
        1 (HawkT1, -16.6055740672)<br>
        2 (架飞机 [Numerical for airplanes], -16.6105400944)<br>
        3 (地勤人员 [Ground crew], -16.6764712234)<br>
        4 (美陆军 [US Army], -16.6781627384)<br>
        5 (SU200, -16.6842796275)<br>
        6 (起降 [Takeoff and landing], -16.6910345896)<br>
        7 (上海浦东国际机场 [Shanghai Pudong International Airport], -16.7040362134)<br>
        8 (备降 [Diverting/Alternate landing], -16.7232609719)<br>
        9 (第一架 [The first plane], -16.7304077856)<br>
        <br>
        &gt;&gt;&gt; pd.Series(model.most_similar(s))<br>
        0 (起飞 [Take off], 0.771412968636)<br>
        1 (客机 [Passenger plane], 0.758365988731)<br>
        2 (直升机 [Helicopter], 0.755871891975)<br>
        3 (一架 [One plane], 0.749522089958)<br>
        4 (起降 [Takeoff and landing], 0.726713418961)<br>
        5 (降落 [Landing], 0.723304390907)<br>
        6 (架飞机 [Airplanes], 0.722024559975)<br>
        7 (飞行 [Flight/Flying], 0.700125515461)<br>
        8 (波音 [Boeing], 0.697083711624)<br>
        9 (喷气式飞机 [Jet plane], 0.696866035461)<br>
        <br>
        &gt;&gt;&gt; s = u'自行车' (Bicycle)<br>
        &gt;&gt;&gt; w = relative_words(s)<br>
        &gt;&gt;&gt; pd.Series(w)<br>
        0 (骑 [Ride], -16.4410312554)<br>
        1 (放风筝 [Fly a kite], -16.6607225423)<br>
        2 (助力车 [Moped], -16.8390451582)<br>
        3 (自行车 [Bicycle], -16.900188791)<br>
        4 (三轮车 [Tricycle], -17.1053629907)<br>
        5 (租赁点 [Rental point], -17.1599389605)<br>
        6 (电动车 [Electric vehicle], -17.2038996636)<br>
        7 (助动车 [Power-assisted vehicle], -17.2523149342)<br>
        8 (多辆 [Multiple vehicles], -17.2629832083)<br>
        9 (CRV, -17.2856425014)<br>
        <br>
        &gt;&gt;&gt; pd.Series(model.most_similar(s))<br>
        0 (摩托车 [Motorcycle], 0.737690329552)<br>
        1 (骑 [Ride], 0.721182465553)<br>
        2 (滑板车 [Scooter], 0.7102201581)<br>
        3 (电动车 [Electric bike], 0.700758457184)<br>
        4 (山地车 [Mountain bike], 0.687280654907)<br>
        5 (骑行 [Cycling], 0.666575074196)<br>
        6 (单车 [Bike], 0.651858925819)<br>
        7 (骑单车 [Cycling], 0.650207400322)<br>
        8 (助力车 [Moped], 0.635745406151)<br>
        9 (三轮车 [Tricycle], 0.630989730358)
    </blockquote>
    <p>You can try it yourself. It should be noted: unfortunately, while Huffman Softmax accelerates computation during the training phase, during the prediction phase when it is necessary to traverse the entire dictionary, it is actually slower than the original Softmax. Therefore, this is not a high-efficiency solution.</p>

    <h2>What Have We Actually Done?</h2>
    <p>
        According to the previous two parts, we can see that there are generally two scenarios for "similarity": 1. Often paired with the same set of words; 2. Often appearing together. Both scenarios can be considered as similarity between words, applicable to different needs.
    </p>
    <p>
        For example, when performing word sense disambiguation for polysemous words—such as whether "star" refers to a "celestial body" or a "celebrity"—we can utilize mutual information. We can find a corpus where "star" means "celestial body" beforehand and identify words with high mutual information with "star," such as "sun," "planet," or "earth." Similarly, we can find a corpus where "star" means "celebrity" and find corresponding words like "entertainment" or "movie." In a new context, we can then infer which meaning it is based on the surrounding context.
    </p>
    <p>In short, you must define your needs clearly and then consider the corresponding method.</p>
</article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/4368" style="color: #005fcc;">https://kexue.fm/archives/4368</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
