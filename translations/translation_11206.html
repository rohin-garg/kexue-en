
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    tags: 'ams'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<article>
    <h1><a href="https://kexue.fm/archives/11206">Building a Portable Side Router with Raspberry Pi Zero 2W</a></h1>

    <p>By 苏剑林 | August 02, 2025</p>

    <p>A while ago, I got a very mini development board, the Raspberry Pi Zero 2W (hereafter referred to as "<strong>Pi</strong>"), and paired it with a USB Key adapter board. I've spent the last few days tinkering with it to implement a portable side router. This article records the key technical points for reference by readers with similar needs.</p>

    <p><img src="https://kexue.fm/usr/uploads/2025/02/1004663719.jpg" alt="Raspberry Pi Zero 2W" /></p>

    <h2 id="背景描述">Background <a href="https://kexue.fm/kexue.fm#%E8%83%8C%E6%99%AF%E6%8F%8F%E8%BF%B0">#</a></h2>

    <p>Students who have tinkered with proxies should be familiar with the concept of a "side router" (bypass router), which is mainly used here as a transparent proxy. Nowadays, the relevant technology is quite mature, so building a transparent proxy is not particularly difficult if you have a small host machine. The main focus of this article, however, is on it being "portable," which requires the small host to meet the following characteristics:</p>

    <blockquote>
        <p>1. Compact (otherwise, it's not suitable for carrying around);<br />
        2. Equipped with Wi-Fi connectivity;<br />
        3. Capable of switching networks at any time.</p>
    </blockquote>

    <p>The third point is the most troublesome. Suppose I bring my laptop and the small host to a new environment and learn the local Wi-Fi credentials; how can I get the small host to connect to the new Wi-Fi? The crux is how the laptop connects to the host when the host isn't yet on the network. If there were an Ethernet port, connecting via a network cable would naturally work, but hosts with Ethernet ports are usually not small, and carrying a network cable is cumbersome (MacBooks also require an adapter).</p>

    <p>The Raspberry Pi Zero 2W + USB Key perfectly fulfills this requirement! It can operate as a host while simultaneously simulating a network card. When connected to a computer via the USB port, it can both power the Zero 2W and establish a direct communication channel from the Zero 2W to the computer, allowing us to connect to the Zero 2W without needing Wi-Fi.</p>

    <h2 id="烧录镜像">Flashing the Image <a href="https://kexue.fm/kexue.fm#%E7%83%A7%E5%BD%95%E9%95%9C%E5%83%8F">#</a></h2>

    <p>In fact, this USB direct connection solution for the Pi Zero has been around for a long time. For example, the tutorial <a href="https://shumeipai.nxez.com/2018/02/20/raspberry-pi-zero-usb-ethernet-gadget-tutorial-macos.html">"Raspberry Pi Zero USB/Ethernet Connection Configuration Tutorial (macOS platform)"</a> dates back to 2018, but the configuration methods therein are outdated. Here, I am mainly updating the latest solution that works with the help of <a href="https://www.kimi.com/">K2</a>.</p>

    <p>First, prepare an SD card and flash the latest Raspberry Pi OS image onto it. With the official Raspberry Pi Imager, flashing the image has become simpler. During the flashing process, take note of a few details: first, you must configure the Wi-Fi credentials (these can be changed later, but the initial configuration needs it), and you must enable SSH. Adjust other settings as needed:</p>

    <p><img src="https://kexue.fm/usr/uploads/2025/02/1000854407.png" alt="Fill Wi-Fi info" /></p>
    <p><img src="https://kexue.fm/usr/uploads/2025/02/3356064039.png" alt="Enable SSH" /></p>

    <p>It is recommended to set a hostname and remember it, so that you can later access the Pi directly via the hostname within the local network without having to remember the IP address. After the setup is complete, you can flash the image. Once finished, keep the SD card in the card reader and plug it into your computer (my computer is a MacBook Pro running macOS 15.3.1, hereafter referred to as "<strong>Mac</strong>"). Find the <code>config.txt</code> file in the root directory of the SD card and add the following line at the end (the current end is <code>[all]</code>):</p>

    <pre><code>dtoverlay=dwc2</code></pre>

    <p>This completes the image flashing step.</p>

    <h2 id="网卡配置">Network Interface Configuration <a href="https://kexue.fm/kexue.fm#%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE">#</a></h2>

    <p>Now we can insert the SD card into the Pi and then plug the Pi into the Mac via the USB port. The Pi will then power up and boot. Once the boot is complete, since we previously configured the Wi-Fi, the Pi should have successfully connected to the network. At this point, connect the Mac to the same network, and we can SSH into the Pi using <code>ssh me@pi.local</code>. Alternatively, you can find its IP address in the router settings and SSH via the IP.</p>

    <p>Next, we execute the following on the Pi:</p>

    <pre><code>sudo modprobe g_ether
sudo ip link set usb0 up
sudo ip addr add 169.254.7.11/16 dev usb0</code></pre>

    <p>After execution, check with <code>ifconfig</code>; you will find a new network interface named <code>usb0</code> with the IP set to <code>169.254.7.11</code>. This is a reserved internal network IP; you can set it yourself, but you can also just copy this if there are no special considerations.</p>

    <p>After a short wait, switch to the Mac's "Settings" - "Network." Under normal circumstances, an <code>RNDIS/Ethernet Gadget</code> service will appear and automatically connect. Clicking "Details," you will see an IP assigned via DHCP. Change it to manual mode, with the IP <code>169.254.7.1</code> and the Router field left blank. In principle, this IP can also be customized, but you can just copy it if no specific requirements exist.</p>

    <p>Switch back to the Pi and run <code>ping 169.254.7.1</code>. If it pings through, it indicates that the Pi and Mac have formed a small local area network via the USB port, where the Mac's IP is <code>169.254.7.1</code> and the Pi's IP is <code>169.254.7.11</code>. On the Mac, you can also connect to the Pi via <code>ssh me@169.254.7.11</code>.</p>

    <h2 id="启动服务">Starting the Service <a href="https://kexue.fm/kexue.fm#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">#</a></h2>

    <p>However, the current network configuration is temporary and will disappear upon restart. We need to configure it as a service that starts automatically at boot so that in the future, even without a network, we can still connect to the Pi via the USB port and <code>ssh me@169.254.7.11</code>. This is our ultimate goal.</p>

    <p>On the Pi, create <code>/usr/local/bin/usb0.sh</code>:</p>

    <pre><code>#!/bin/bash
sudo modprobe g_ether
sudo ip link set usb0 up
sudo ip addr add 169.254.7.11/16 dev usb0
nohup ping -c 100 169.254.7.1 &gt; /var/log/usb0_ping.log 2&gt;&amp;1 &amp;
exit 0</code></pre>

    <p>Then run <code>sudo chmod +x /usr/local/bin/usb0.sh</code>, and create <code>/etc/systemd/system/usb0.service</code>, writing:</p>

    <pre><code>[Service]
Type=oneshot
ExecStart=/usr/local/bin/usb0.sh
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target</code></pre>

    <p>Finally, execute:</p>

    <pre><code>sudo systemctl daemon-reload
sudo systemctl enable usb0.service</code></pre>

    <p>That's it. In the future, just plug the Pi into the Mac, wait for it to finish booting, and you can connect via <code>ssh me@169.254.7.11</code>. If needed, you can connect to or switch Wi-Fi using <code>sudo raspi-config</code>.</p>

    <h2 id="文章小结">Summary <a href="https://kexue.fm/kexue.fm#%E6%96%87%E7%AB%A0%E5%B0%8F%E7%BB%93">#</a></h2>

    <p>As for the remaining steps of setting up the side router/transparent proxy, please tinker with them yourself. This article mainly helps you get the "portable" part running; the rest is up to your own exploration.</p>

    <p><em><strong>For more detailed reprinting matters, please refer to:</strong></em> <a href="https://kexue.fm/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8">"Scientific Spaces FAQ"</a></p>

    <p><strong>If you have any doubts or suggestions, feel free to continue the discussion in the comments section below.</strong></p>

    <p><strong>If you find this article helpful, feel free to <a href="https://kexue.fm/kexue.fm#share">share</a> or <a href="https://kexue.fm/kexue.fm#pay">donate</a> to this article. Donations are not intended for profit, but rather to let me know how much genuine attention Scientific Spaces has received from readers. Of course, if you choose to ignore it, it will not affect your reading. Welcome and thank you again!</strong></p>

    <p>Su Jianlin. (Aug. 02, 2025). "Building a Portable Side Router with Raspberry Pi Zero 2W" [Blog post]. Retrieved from <a href="https://kexue.fm/archives/11206">https://kexue.fm/archives/11206</a></p>

    </article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/11206" style="color: #005fcc;">https://kexue.fm/archives/11206</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
