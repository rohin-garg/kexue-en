
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    tags: 'ams',
    packages: {'[+]': ['ams']}
  },
  options: {
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<article>
    <h1><a href="https://kexue.fm/archives/3644">OpenWrt Automatically Scans for WiFi and Connects as a Repeater</a></h1>
    <p>By 苏剑林 | March 06, 2016</p>

    <p>Recently, I acquired an extremely mini router—built from a 25 x 25mm VoCore development board. With its casing, it measures only 37.4 x 34 x 25.9mm, which is just slightly larger than a typical portable WiFi dongle. (<a href="https://item.taobao.com/item.htm?id=45865192290">Link</a>)</p>

    <p>
        <a href="https://kexue.fm/usr/uploads/2016/03/3841953.jpg" title="Click to view original image">
            <img src="https://kexue.fm/usr/uploads/2016/03/3841953.jpg" alt="vocore router" />
        </a>
    </p>
    <p>VoCore Router</p>

    <p>Despite its small size, its specifications are quite decent:</p>

    <blockquote>
        <p>CPU Processor: Ralink RT5350 360MHz MIPS 24KEc<br />
        Memory: 32MB 133MHz SDRAM<br />
        Flash: 16MB<br />
        Expansion Interfaces: SPI, I2C, I2S<br />
        WiFi Wireless: 802.11n<br />
        Ethernet Network: 10/100MHz x 2<br />
        GPIO Expansion: 28 (Reused)<br />
        UART Interfaces: UART Lite / UART Full<br />
        USB Interface: USB 2.0, up to 480M<br />
        Power Supply: 3.3V ~ 6V</p>
    </blockquote>

    <p>Simply put, it allows us to install OpenWrt, which opens up a lot of possibilities. Because it is so small and portable, it is perfect for use as a travel router. Let's get to work.</p>

    <p><strong>As everyone knows, phones or laptops have a feature where if we have connected to several WiFi networks in different places, the device remembers that information. When we return to one of those locations, it automatically connects to the respective WiFi without manual intervention (except for those requiring web authentication). So, can OpenWrt achieve this? In other words, can OpenWrt automatically scan for WiFi, connect to it, and then broadcast its own hotspot for a phone or laptop to use?</strong></p>

    <p>One might wonder: if the router can scan the WiFi, then the phone/laptop surely can too, so why bother relaying it? Why not just connect the phone directly? For normal WiFi, that's true, but for networks like our campus WiFi or CMCC, they require authentication and often enforce a "one account, one device" rule. In such cases, a common solution is to use one computer to connect to the WiFi and then use something like a portable USB WiFi dongle to share it. While simple, it's quite ordinary, and I don't always carry a laptop with me. Therefore, that method is not for me.</p>

    <p>Enough talk, time to work. My mini router is flashed with OpenWrt 15.05. First, here is the complete process for repeating a standard WiFi (a "standard" WiFi refers to one where you simply enter a password to get online). Directly SSH into the router and enter:</p>

<pre><code class="language-bash">
</code></pre>

    <p>These steps are configured during the first run. Once configured, if you want to change the WiFi being repeated, you only need to modify the repeater section; everything else remains unchanged. Next, let's complete our goal step-by-step. The first step is scanning the WiFi list. In OpenWrt, we use:</p>

<pre><code class="language-bash">
</code></pre>

    <p>This will return a very detailed list of nearby available WiFi networks, including SSID, signal strength, etc. To ensure the stability of the relay, we also need to determine the signal strength of the relay source. For this process, the basic tool used is regex.</p>

    <p>Next is implementing automatic authentication. Here, I am only doing the automatic authentication for the SCNU (South China Normal University) campus WiFi. By analyzing its process, I found that it simply POSTs the username and password, so it's quite simple. But what tool should be used to POST? Naturally, I thought of Python's <code>requests</code>, but installing Python and then installing <code>requests</code> is a bit of a hassle. Later, I realized that <code>wget</code> also supports posting data (amazing!). We can just use <code>wget</code> to finish it. However, the built-in <code>wget</code> does not support HTTPS, so you need to use:</p>

<pre><code class="language-bash">
</code></pre>

    <p>to install the full version of <code>wget</code>. With that, we can write a shell script:</p>

<pre><code class="language-bash">
</code></pre>

    <p>The process implemented by this script is: <strong>Scan the WiFi list to see if "BoJone" is in the list and check its signal strength. If it's good enough, connect to it automatically. If not, check if "SCNUNET" is available and check its signal strength. If it's good enough, connect to it automatically and complete the authentication. The authentication process is pre-analyzed and written into the <code>POST_SCNUNET</code> function (this function first uses <code>wget</code> to download this website to check if the network is normal; if it is, no authentication is needed; otherwise, it will automatically redirect to the authentication page). If neither is available, it won't repeat any wireless signal and will instead wait for a wired connection.</strong></p>

    <p>Other campus WiFi or authenticated WiFi networks are likely similar; this serves only as a reference example.</p>

    <p>Finally, I feel that for implementing simple functions, using pure shell scripts is quite refreshing, especially in low-end environments like routers. Naturally, if you can use shell, use shell. With a foundation in Python programming, implementing this was not very difficult.</p>
</article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/3644" style="color: #005fcc;">https://kexue.fm/archives/3644</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
