
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    packages: {'[+]': ['ams']},
    tags: 'ams'
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>

<article>
    <h1><a href="https://kexue.fm/archives/3651">Sharing Campus Resources through SSH Dynamic Port Forwarding (including practical tips)</a></h1>

    <p>By 苏剑林 | March 07, 2016</p>

    <p>By 苏剑林 | March 07, 2016</p>

    <p>As is widely known, the two most valuable resources of a campus network are: first, IPv6, which is the most ideal way to access websites like Google (though not all universities have IPv6); and second, paper databases. Generally, universities purchase download rights for various databases (CNKI, Wanfang, etc.) for campus users. While there are many ways for off-campus users to access Google, such as VPNs, accessing resources like CNKI is particularly precious. Usually, off-campus users have to ask someone on campus to download papers for them, or they have to pay for them (and it's expensive!).</p>

    <p>As the webmaster is still a student, I enjoy both IPv6 and paper database resources at school, which is indeed very convenient. Since I started using an OpenWrt router, I have been thinking about how to share these campus network resources. I previously considered setting up a PPTP VPN, but I felt it was slightly complicated (granted, compared to other VPNs, PPTP is very simple, but I still didn't like it much). Furthermore, I hadn't solved the issue of intranet penetration at that time. Recently, by using SSH reverse proxy to achieve intranet penetration, I realized that through SSH dynamic port forwarding, I could actually set up a proxy and achieve remote access to internal (campus network) resources. Moreover, almost no configuration is required on the router itself. I must say, SSH is truly an extremely powerful tool.</p>

    <h3>Adding a Regular Account</h3>

    <p>Since the goal is sharing, there is no reason to share the root account. Therefore, the first step is to add a proxy account on OpenWrt. For security and privacy, this account should be prohibited from actually logging into the server to perform operations; it should only be allowed for port forwarding.</p>

    <p>First, install useradd using the following commands:</p>
<pre><code>opkg update
opkg install shadow-useradd</code></pre>

    <p>Once installed, add the guest account using the following command:</p>
<pre><code>useradd guest</code></pre>

    <p>Then, edit <code>/etc/passwd</code>. The last line should look something like this:</p>
    <blockquote>guest:x:1000:1000::/home/guest:</blockquote>
    <p>Complete it as follows:</p>
    <blockquote>guest:x:1000:1000::/home/guest:/bin/false</blockquote>

    <p>Then add a line to <code>/etc/shells</code>:</p>
    <blockquote>/bin/false</blockquote>

    <p>With this, the proxy account setup is complete. You can then change the password via <code>passwd guest</code>. This account must be operated using the <code>ssh -N</code> mode—that is, it does not execute any remote commands. If you attempt to log in normally via SSH, it will fail.</p>

    <h3>Dynamic Port Forwarding</h3>

    <p>Dynamic port forwarding basically means that after connecting to the router via SSH locally, you can establish a SOCKS proxy locally. Although this proxy is local, it sends local requests to the router; the router fetches and returns the results, which are then passed back to the local machine. This proxy allows us to achieve our objective.</p>

    <p>In Linux or Mac OS, you can establish a local SOCKS proxy for dynamic port forwarding with just one line of code:</p>
<pre><code>ssh -ND 7070 guset@1.1.1.1 -p 22222 -v</code></pre>

    <p>As mentioned before, <code>-N</code> is mandatory. The <code>D</code> parameter is used to specify the port to listen on. The final <code>-v</code> flag turns on debug mode, which prints out the data stream. If you don't add the <code>v</code> parameter, there will be no output at all. (Some people feel uneasy if they don't see any output. ^_^)</p>

    <p>After establishing the SOCKS proxy, simply set the corresponding proxy in your browser. Be sure to use a SOCKS5 proxy—do not mistakenly select HTTP. SOCKS4 can also work, but SOCKS4 does not support IPv6; if you use SOCKS4, IPv6 resources will be inaccessible. If you use Google Chrome, you can use plugins such as SwitchyOmega, SwitchySharp, or "Smart Proxy" to easily switch proxies. For other browsers, please find your own solutions. As far as I know, all current mainstream browsers allow for easy SOCKS proxy setup. After confirming the proxy is set successfully, you can check if you can open baidu.com and type "IP" in the search box to see if your IP has changed to the remote router's IP.</p>

    <p>In Windows, the second step is the same, but the first step differs. Since Windows does not have a built-in SSH client, you need to download and install one. While many people think of PuTTY when it comes to SSH tools for Windows, there is actually a better command-line version called Plink. Plink's usage and parameters are similar to SSH under Unix, and it is even more convenient in some ways (it can specify a login password for automatic login, whereas SSH cannot unless you install sshpass). In <code>plink.exe</code>, simply execute the following command:</p>
<pre><code>plink -N -D 7070 guset@1.1.1.1 -P 22222 -pw 123456 -v</code></pre>

    <p>The final <code>pw</code> parameter is used to specify the password, assumed here to be 123456. Note that the <code>P</code> to specify the port here is uppercase.</p>

    <p>Why not use PuTTY? Many online tutorials suggest using PuTTY to establish a proxy, but I did not find an option in PuTTY corresponding to the <code>-N</code> mode. Therefore, PuTTY is ineffective in this situation. In fact, many SSH proxies found online disable remote command execution rights using similar methods, leaving Plink as the remaining option.</p>

    <h3>sshuttle</h3>

    <p>Finally, another solution for those with an SSH account is <a href="https://github.com/sshuttle/sshuttle">sshuttle</a>. This is a VPN program built on SSH that directly implements VPN functionality without requiring manual proxy settings. However, it is based on Python and can only be used on Linux or Mac OS. Interested friends can explore this on their own.</p>

    <h3>Sharing the Campus Network</h3>

    <p>Up to this point, if your browser uses the established proxy, you should be able to normally access Google, Wanfang, and CNKI (if it still doesn't work, try selecting "IP login" at the login page), and you can download papers from the databases for free.</p>

    <p>This is truly the most powerful server for scientific web surfing!</p>

    <p>SSH is invincible!</p>

    <p>For more content, please visit: <a href="http://bbs.spaces.ac.cn/topic/show/15">http://bbs.spaces.ac.cn/topic/show/15</a></p>

    </article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/3651" style="color: #005fcc;">https://kexue.fm/archives/3651</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
