
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    tags: 'ams',
    packages: {'[+]': ['ams']}
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<h1><a href="https://kexue.fm/archives/3290">Seeking a Smooth Maximum Function</a></h1>

<p>By 苏剑林 | May 02, 2015</p>

<p>In optimization problems, the most direct method to find the maximum or minimum of a function is to take the derivative and then compare the magnitudes of the various extreme values. However, the functions we want to optimize are not always differentiable—for example, functions containing the maximum function $\max(x, y)$. In such cases, we must resort to other approaches. One very clever idea is to approximate these non-differentiable functions with a differentiable one, allowing us to find an approximate optimal value using standard extremum methods. The task of this article is to explore a simple and useful function that can serve as an approximation for the maximum function while possessing derivatives of multiple orders. Below is the derivation process provided by the author.</p>

<p>In mathematical analysis, I have already learned a formula regarding the maximum function; namely, when $x \geq 0$ and $y \geq 0$, we have:
$$\max(x,y)=\frac{1}{2}\left(|x+y|+|x-y|\right)\tag{1}$$
Therefore, to seek a smooth maximum function, we can first consider finding a function that can approximately represent the absolute value $|x|$. This allows us to reduce the problem from two dimensions to one. So, which function can we use?</p>

<p>It is quite difficult to discover which function to use simply by direct observation, so let us break the problem down into simpler steps. We take the derivative of $f(x)=|x|$; except for the point $x=0$, it can be differentiated smoothly everywhere:
$$f'(x) = \left\{\begin{aligned}1,&\,x > 0\\
-1,&\, x < 0\end{aligned}\right.\tag{2}$$
This is a simple piecewise function. In physics, such functions are very common. The one most closely related to it should be the unit step function $\theta(x)$:
$$\theta(x) = \left\{\begin{aligned}1,&\,x > 0\\
0,&\, x < 0\end{aligned}\right.\tag{3}$$
Then:
$$f'(x)=2\theta(x)-1\tag{4}$$
Next, we only need to seek an approximation for $\theta(x)$. Physicists have already provided existing functions for us; a relatively simple form is [<a href="http://zh.wikipedia.org/wiki/%E5%8D%95%E4%BD%8D%E9%98%B6%E8%B7%83%E5%87%BD%E6%95%B0">Source: Wikipedia</a>]:
$$\theta(x)=\lim_{k\to +\infty} \frac{1}{1+e^{-k x}}\tag{5}$$
Thus, we can take $\frac{1}{1+e^{-k x}}$ as the approximation function. Substituting this into equation $(4)$, we obtain $\frac{2e^{k x}}{1+e^{k x}}-1$. Integrating this yields:
\begin{align}
f(x)&=\frac{2}{k}\ln(1+e^{kx})-x\\
&=\frac{1}{k}\left[\ln(1+e^{kx})+\ln(1+e^{-kx})\right]\\
&=\frac{1}{k}\ln(2+e^{kx}+e^{-kx})\tag{6}
\end{align}
It is not difficult to see that in the logarithmic part of equation $(6)$, when $k$ is sufficiently large, the influence of the constant $2$ is negligible. After removing it, we have a relatively simple absolute value function:
$$|x|=\lim_{k\to +\infty} \frac{1}{k}\ln(e^{kx}+e^{-kx})\tag{7}$$
Combining equation $(7)$ with equation $(1)$, we get:
$$\max(x,y)=\lim_{k\to +\infty} \frac{1}{2k}\left\{\ln[e^{k(x+y)}+e^{-k(x+y)}]+\ln[e^{k(x-y)}+e^{-k(x-y)}]\right\}\tag{8}$$
Equation $(8)$ can be further simplified to:
$$\max(x,y)=\lim_{k\to +\infty} \frac{1}{2k}\ln(e^{2kx}+e^{-2kx}+e^{2ky}+e^{-2ky})\tag{9}$$
Furthermore, since equation $(1)$ holds when $x\geq 0$ and $y\geq 0$, the $e^{-2kx}$ and $e^{-2ky}$ terms in equation $(9)$ become unimportant. We remove them as well, obtaining:
$$\max(x,y)=\lim_{k\to +\infty} \frac{1}{2k}\ln(e^{2kx}+e^{2ky})\tag{10}$$
Or written as:
$$\max(x,y)=\lim_{k\to +\infty} \frac{1}{k}\ln(e^{kx}+e^{ky})\tag{11}$$
Equation $(11)$ is precisely the ideal maximum function we hoped to obtain. Although our derivation was based on $x\geq 0, y\geq 0$, it is easy to find that the formula remains valid even when negative numbers appear among $x$ and $y$! It can even be generalized to a maximum function for multiple variables:
$$\max(x,y,z,\dots)=\lim_{k\to +\infty} \frac{1}{k}\ln(e^{kx}+e^{ky}+e^{kz}+\dots)\tag{12}$$

<p>For more exhibitions regarding equation $(11)$, please read Matrix67's "How to Construct a Smooth Maximum Function": <a href="http://www.matrix67.com/blog/archives/2830">http://www.matrix67.com/blog/archives/2830</a></p>

<p>Observing the structure of equation $(11)$, we can see that it essentially does this: find a function that is monotonically increasing across the entire real number domain, with a growth rate faster than linear growth, then take the sum and finally take the inverse function. Thus, it is not difficult to construct similar functions: if we choose $y=x^{2k+1}$, we get:
$$\max(x,y)=\lim_{k\to+\infty} \sqrt[2k+1]{x^{2k+1}+y^{2k+1}}\tag{13}$$
Of course, the accuracy (or rather, the convergence speed) of $(13)$ is nowhere near as good as $(11)$. Improving the accuracy is not difficult; for example:
$$\max(x,y)=\lim_{k\to +\infty} \frac{1}{k}\ln\ln\left(e^{e^{kx}}+e^{e^{ky}}\right)\tag{14}$$
Considering both accuracy and simplicity, equation $(11)$ is likely the optimal choice.</p>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/3290" style="color: #005fcc;">https://kexue.fm/archives/3290</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
