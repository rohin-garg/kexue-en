
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      tags: 'ams',
      packages: {'[+]': ['ams']}
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<article>
    <nav style="margin-bottom: 1.5em;">
    <a href="../index.html" style="display: inline-flex; align-items: center; color: #555; text-decoration: none; font-size: 0.95em;">
        <span style="margin-right: 0.3em;">&larr;</span> Back to Index
    </a>
</nav>

    <h1><a href="https://kexue.fm/archives/3936">Entering Sun Yat-sen University South Campus, Tinkering with the Campus Network</a></h1>
    <p>By 苏剑林 | September 05, 2016</p>

    <p>Starting my journey as a graduate student, I hope that one day I can reach the realm of the "Sweeper Monk" (a hidden master).</p>

    <p>After entering Sun Yat-sen University (SYSU), several frustrating things happened. First, the most annoying thing is that the school starts extremely early; opening on August 26. It feels like at least a week earlier than most other schools. Is there any point in starting so early? Next, I feel that SYSU's management system is quite chaotic, far worse than my undergraduate institution, South China Normal University. Well, I won't complain further about these trifles. Next, I had to set up the campus network, which was where the "struggle" began.</p>

    <p>We are at the South Campus, and the campus network is authenticated via the Ruijie (StarView) client. I use a MacBook, and fortunately, SYSU humanely provides a Mac version of the Ruijie client, which is only about 1MB in size; quite good. However, as everyone knows, MacBooks do not have a built-in Ethernet port. Every time I want to go online, I have to plug in a USB network adapter and connect it to a network cable, which is extremely frustrating. So, I thought of a way to dial in through a router. I’m not exactly inexperienced; I’ve done some research on the OpenWrt system. Back when I was an undergraduate, we also used Ruijie, and I could use MentoHUST as a replacement for dialing, which was very simple. So I repeated that process here, but found that authentication failed every time. Following various methods suggested online did not solve the problem.</p>

    <p>Upon research, I discovered that under Windows, the network here only works with the official Ruijie version 4.90 provided by the school. Versions higher or lower downloaded from elsewhere cannot pass authentication. I suspect this mechanism makes it difficult for MentoHUST to pass authentication. Furthermore, the popular version of MentoHUST is based on the V2 protocol, while version 4.90 is based on V4. Later, I downloaded the <a href="https://github.com/hyrathb/mentohust">V4 version</a> and performed cross-compilation, but tests showed it still didn't work. When I was near despair, I discovered <a href="https://github.com/updateing/mentohust-proxy">mentohust-proxy</a>, an improved version of MentoHUST, which gave me hope. (How did I find it? I searched directly on GitHub because I was truly out of options.)</p>

    <p>The principle is very simple: if MentoHUST cannot complete authentication directly, it uses a proxy mode. The authentication is performed by a computer, and MentoHUST is only responsible for sending heartbeat packets to maintain the connection. This is a compromise solution, but it should be a very universal one because its success essentially depends solely on the Ruijie client on your own computer. Seeing this solution, I knew there was a chance. I quickly brushed up on my knowledge of cross-compilation, finally compiled it successfully, and successfully completed authentication on the router.</p>

    <h3>Cross-Compilation</h3>
    <p>My environment is CentOS 7. First, install the environment dependencies. In fact, these dependencies were found online, and I'm not sure if they are complete. If it doesn't work, feel free to leave a comment. You can search for "OpenWrt compilation" to find many related links.</p>

<pre><code class="language-bash"></code></pre>

    <p>Download the SDK package to the ~ directory. My router uses the common MT7620n solution, so I downloaded the mt7620 one:</p>

<pre><code class="language-bash"></code></pre>

    <p>Download libpcap. Here, I compile the dependency library libpcap directly into it to avoid having to install it separately.</p>

<pre><code class="language-bash"></code></pre>

    <p>Download mentohust-proxy.</p>

<pre><code class="language-bash"></code></pre>

    <p>Configure environment variables (here /home/job is my ~ directory):</p>

<pre><code class="language-bash"></code></pre>

    <p>The rest of the process is similar to standard compilation, just adding the <code>host=mipsel-openwrt-linux-uclibc</code> parameter. First, compile libpcap:</p>

<pre><code class="language-bash"></code></pre>

    <p>Then compile mentohust-proxy:</p>

<pre><code class="language-bash"></code></pre>

    <p>The file named <code>mentohust</code> in the <code>src</code> directory is the final compiled executable.</p>

    <h3>Completing Authentication</h3>
    <p>Download the mentohust file and upload it to the router. You can first try if MentoHUST can complete authentication directly; if not, use the proxy authentication. Incidentally, this upgraded version of MentoHUST is more user-friendly. Below is its help file.</p>

    <blockquote>
        >>> mentohust -h<br>
        Welcome to MentoHUST Version: 0.3.1<br>
        Copyright (C) 2009-2010 HustMoon Studio<br>
        People come to Huazhong University of Science and Technology, there is sweetness and spice...<br>
        802.1x proxy and other new features by Hamster Tian 2015-2016.<br>
        Bug report to http://code.google.com/p/mentohust/issues/list<br><br>
        Usage: ./mentohust [-options][parameters] or [-options] [parameters] or [--long-options] [parameters]<br>
        Options: --help -h Display this help information<br>
        --kill -k -k(Exit program) Others(Restart program)<br>
        --write -w Save parameters to configuration file<br>
        --username -u Username<br>
        --password -p Password<br>
        --nic -n Network card name<br>
        --ip -i IP [default local IP]<br>
        --mask -m Subnet mask [default local mask]<br>
        --gateway -g Gateway [default 0.0.0.0]<br>
        --dns -s DNS [default 0.0.0.0]<br>
        --ping-host -o Ping host [default 0.0.0.0, means function disabled]<br>
        --auth-timeout -t Authentication timeout (seconds) [default 8]<br>
        --heartbeat -e Heartbeat interval (seconds) [default 30]<br>
        --wait-after-fail -r Wait after failure (seconds) [default 15]<br>
        --max-fail -l Max allowed failures [0 means unlimited, default 8]<br>
        --no-auto-reauth -x Auto reconnect after drop: 0(No) 1(Yes) [default 1]<br>
        --eap-bcast-addr -a Multicast address: 0(Standard) 1(Ruijie) 2(Cernet) [default 0]<br>
        --dhcp-type -d DHCP mode: 0(None) 1(Double Auth) 2(After Auth) 3(Before Auth) [default 0]<br>
        --daemonize -b Run in background: 0(No) 1(Yes, close output) 2(Yes, keep output) 3(Yes, output to file) [default 0]<br>
        --fake-supplicant-version -v Client version number [default 0.00 means compatible with xrgsu]<br>
        --template-file -f Custom data file [default none]<br>
        --dhcp-script -c DHCP script [default dhclient]<br>
        --proxy-lan-iface -z Network card name to listen for authentication packets in proxy mode (setting this enables proxy mode)<br>
        --proxy-require-success -j Number of Success packets needed before closing the LAN listener thread in proxy mode [default 1]<br>
        --decode-config -q Show contents of SuConfig.dat (e.g., -q/path/SuConfig.dat)<br>
        --max-retries Max retries before receiving success or failure result; 0 means infinite [default 0]<br><br>
        Example: ./mentohust -u username -p password -n eth0 -i 192.168.0.1 -m 255.255.255.0 -g 0.0.0.0 -s 0.0.0.0 -o 0.0.0.0 -t 8 -e 30 -r 15 -a 0 -d 1 -b 0 -v 4.10 -f default.mpf -c dhclient<br><br>
        About proxy mode: In this mode, MentoHUST will not initiate authentication itself; instead, it modifies the source MAC of authentication packets captured on the LAN and forwards them to the WAN, enabling the machine to pass authentication.<br>
        In proxy mode, username, password, and drop reconnection settings (-u, -p, -x) are ineffective and do not need to be specified. Since Start packets are self-constructed, DHCP mode and multicast address (-d, -a) are still required.<br>
        Proxy mode example: ./mentohust --proxy-lan-iface br0 --nic eth0 --eap-bcast-addr 1 --dhcp-type 2 -proxy-require-success 2<br>
        Note: Please ensure it is run with root privileges!
    </blockquote>

    <p>First, connect the campus network cable to the WAN port of the router, then connect your computer to the LAN port (WiFi connection also works). Start the command on the router:</p>

<pre><code class="language-bash">./mentohust --proxy-lan-iface br-lan --nic eth0.2 --eap-bcast-addr 1 --dhcp-type 2 --proxy-require-success 2</code></pre>

    <p>Then, use the Ruijie client on the computer to dial-in. You will notice that the router shows the dialing was successful. To keep MentoHUST running, you can use <code>screen</code> or directly use the <code>-b</code> parameter. Well, now you can enjoy your WiFi.</p>

    <h3>Next Steps</h3>
    <p>Now, there are many things you can do, such as intranet penetration, SSH proxies, resource sharing, etc.~</p>

    <p>Compiled program, available for MTK series routers: <a href="https://kexue.fm/usr/uploads/2016/11/2403108993.zip">mentohust_mtk.zip</a></p>

    <h3>Reference Links</h3>
    <p><a href="https://github.com/updateing/mentohust-proxy">https://github.com/updateing/mentohust-proxy</a></p>
    <p><a href="https://www.yjblog.net/post/123.html">https://www.yjblog.net/post/123.html</a></p>
    <p><a href="http://soundrain.net/2016/04/25/mentohust-v4%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E5%8F%8Aipv6%E7%9A%84%E9%85%8D%E7%BD%AE/">http://soundrain.net/2016/04/25/mentohust-v4版本编译及ipv6的配置/</a></p>
</article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/3936" style="color: #005fcc;">https://kexue.fm/archives/3936</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
