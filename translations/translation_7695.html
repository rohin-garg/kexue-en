
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    tags: 'ams',
    packages: {'[+]': ['ams']}
  },
  options: {
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<h1><a href="https://kexue.fm/archives/7695">The Principle of Minimum Entropy (Part 6): How Should We Choose Word Embedding Dimensions?</a></h1>

    <p>By 苏剑林 | August 20, 2020</p>


<p>With the development of NLP, word embedding models like Word2Vec and GloVe are gradually being replaced by Transformer-based models such as BERT. However, classics remain classics; word embedding models still shine in many scenarios and there is still much worth studying. In this article, we address a common point of confusion regarding word embedding models: what dimension is roughly sufficient for word vectors? First, let's give the conclusion—the estimated result provided by the author is:</p>

\begin{equation}n > 8.33\log N\label{eq:final}\end{equation} 

<p>To be even more concise, one can simply remember $n > 8\log N$, where $N$ is the vocabulary size and $n$ is the word vector dimension, with $\log$ being the natural logarithm. When $n$ exceeds this threshold, it indicates that the model has sufficient capacity to accommodate these $N$ words (of course, a larger $n$ also increases the risk of overfitting). Thus, when $N=100,000$, the resulting $n$ is approximately 96; so for a word embedding model with 100,000 words, a dimension of 96 is sufficient. If you need to accommodate 5 million words, then $n$ would be approximately 128.</p>

<h2>Background</h2>

<p>The reason I thought of this question is that yesterday I came across the paper <a href="https://arxiv.org/abs/2008.06170">"Word2vec Skip-gram Dimensionality Selection via Sequential Normalized Maximum Likelihood"</a> on arXiv. Unfortunately, I did not find the answer I was looking for in that paper. I did a quick search and found other literature studying the same problem, such as <a href="https://arxiv.org/abs/1812.04224">"On the Dimensionality of Word Embedding"</a>, but the answers were still not what I wanted.</p>

<p>Why do I say this? Obviously, the most standard answer to this question should be to determine the optimal dimension through repeated experiments; therefore, one cannot expect theoretical analysis to provide an extremely precise answer. The word vector dimensions we commonly use are generally 64, 100, 128, 256, 300, etc. The difference in performance between different dimensions is often not very significant. I only hoped to derive the magnitude of the required dimensions for a general word vector model—such as tens or hundreds—in the most concise and intuitive way possible, without overly complex analysis.</p>

<p>Since I couldn't find a satisfactory existing result, I analyzed it from the perspective of the <strong>Principle of Minimum Entropy</strong> and obtained an answer close to what I had in mind.</p>

<h2>Analysis</h2>

<p>This article analyzes word vector models based on the Skip-Gram concept. Most word vector models are essentially variations of it. As for CBOW-type models, in previous experiments, their performance has been similar to Skip-Gram (especially when the data volume is large), so the analysis results for Skip-Gram can be considered generalizable.</p>

<h3>Minimizing Entropy</h3>

<p>Our starting point is information entropy. We know that entropy is a measure of uncertainty. Language itself possesses a certain degree of uncertainty, and when we use vectors to encode words, the result of the encoding should be equal to or even less than this uncertainty to ensure that the encoding is effective and sufficiently preserves the information of the original language. Therefore, we want to eliminate uncertainty, which means we want to minimize entropy.</p>

<p>It should be noted that word vectors are based on the Skip-Gram model, so what we need to calculate is not the average word entropy, but the average entropy of the entire Skip-Gram model. Assuming the frequency of the word pair $(w_i, w_j)$ is $\tilde{p}(w_i, w_j)$, we can estimate its entropy as:</p>

\begin{equation}\tilde{H}=-\sum_{i, j} \tilde{p}(w_i, w_j)\log \tilde{p}(w_i, w_j)\end{equation} 

<p>The training objectives of different word vector models also differ; some fit the joint probability $p(w_i, w_j)$, while others fit the conditional probability $p(w_j|w_i)$. However, the difference is minor; as mentioned earlier, this article only seeks an approximate figure. Therefore, we uniformly assume the word vector model is:</p>

\begin{equation}p(w_i, w_j) = \frac{e^{ \langle \boldsymbol{u}_i, \boldsymbol{v}_j \rangle }}{Z},\quad Z = \sum_{i,j}e^{ \langle \boldsymbol{u}_i, \boldsymbol{v}_j \rangle }\end{equation} 

<p>Where $\boldsymbol{u}, \boldsymbol{v}$ represent two different sets of word vectors (center word vectors and context word vectors), $\boldsymbol{u}_i$ represents word $w_i$ and $\boldsymbol{v}_j$ represents word $w_j$. At this point, its information entropy is:</p>

\begin{equation}H=-\sum_{i, j} p(w_i, w_j)\log p(w_i, w_j)=\log Z-\frac{1}{Z}\sum_{i, j} e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle} \langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle\end{equation} 

<h3>Sampling Approximation</h3>

<p>To approximate the calculation of the above formula, we use sampling approximation for the summation, for example:</p>

\begin{equation}Z = \sum_{i, j} e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle} = N^2\times \frac{1}{N^2}\sum_{i, j} e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle}\approx N^2\mathbb{E}_{\boldsymbol{u}_i,\boldsymbol{v}_j}\left[e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle}\right]\end{equation} 

<p>Here $N$ is the vocabulary size. Similarly:</p>

\begin{equation}\sum_{i, j} e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle} \langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle\approx N^2\mathbb{E}_{\boldsymbol{u}_i,\boldsymbol{v}_j}\left[e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle} \langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle\right]\end{equation} 

<p>So we have the approximation:</p>

\begin{equation}H\approx\log N^2 + \log \mathbb{E}_{\boldsymbol{u}_i,\boldsymbol{v}_j}\left[e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle}\right]-\frac{\mathbb{E}_{\boldsymbol{u}_i,\boldsymbol{v}_j}\left[e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle} \langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle\right]}{\mathbb{E}_{\boldsymbol{u}_i,\boldsymbol{v}_j}\left[e^{\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle}\right]}\end{equation} 

<h3>Distribution Assumption</h3>

<p>Observing existing word vector models, we find that the values of each dimension can be positive or negative, and their absolute values are generally fairly uniform. Here, we might assume that the absolute value of each element is roughly 1, then the modulus length of each word vector would be approximately $\sqrt{n}$ ($n$ is the word vector dimension, which is our target for estimation; if you feel this approximation is not accurate enough, you can adjust it yourself). We further assume that all word vectors are uniformly distributed on an $n$-dimensional hypersphere with radius $\sqrt{n}$. Then $\langle \boldsymbol{u}_i, \boldsymbol{v}_j\rangle=n\cos\theta$, where $\theta$ is their included angle. Thus:</p>

\begin{equation}H\approx\log N^2 + \log \mathbb{E}_{\theta}\left[e^{n\cos\theta}\right]-\frac{\mathbb{E}_{\theta}\left[e^{n\cos\theta} n\cos\theta\right]}{\mathbb{E}_{\theta}\left[e^{n\cos\theta}\right]}\label{eq:H-theta}\end{equation} 

<p>Now $\theta$ corresponds to the angle between any two random vectors in $n$-dimensional space. In <a href="translation_7076.html">"Distribution of the angle between two random vectors in n-dimensional space"</a>, we derived its distribution as:</p>

\begin{equation}p_n(\theta) = \frac{\Gamma\left(\frac{n}{2}\right)}{\Gamma\left(\frac{n-1}{2}\right)\sqrt{\pi}}\sin^{n-2} \label{eq:jqfb}\theta\end{equation} 

<p>Since the probability density function is determined, for a given $N$ and $n$, the approximation formula \eqref{eq:H-theta} can be fully computed numerically. From $\tilde{H} > H$, we can solve for the corresponding $n$.</p>

<h3>Comparison of Results</h3>

<p>First, we numerically calculate some results for $h_n=\log \mathbb{E}_{\theta}\left[e^{n\cos\theta}\right]-\frac{\mathbb{E}_{\theta}\left[e^{n\cos\theta} n\cos\theta\right]}{\mathbb{E}_{\theta}\left[e^{n\cos\theta}\right]}$:</p>

<table border="1" style="margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center;">
<thead>
<tr>
<th style="padding:5px;">$n$</th>
<th style="padding:5px;">32</th>
<th style="padding:5px;">64</th>
<th style="padding:5px;">96</th>
<th style="padding:5px;">128</th>
<th style="padding:5px;">256</th>
<th style="padding:5px;">512</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding:5px;">$h_n$</td>
<td style="padding:5px;">-7.77471</td>
<td style="padding:5px;">-15.4734</td>
<td style="padding:5px;">-23.1726</td>
<td style="padding:5px;">-30.8718</td>
<td style="padding:5px;">-61.6692</td>
<td style="padding:5px;">-123.264</td>
</tr>
</tbody>
</table>

<p>Thus, for example, if $n=64, N=100,000$, then $H\approx \log 100000^2 - 15.4734 = 7.55245$. Readers might find it strange: when $n=128, N=100,000$, doesn't $H$ become negative? How can discrete entropy be negative? In fact, this is because in our derivation process, we combined sampling approximation with exact integration. When the spatial dimension $n$ is large enough, even sampling hundreds of thousands of points may not accurately estimate certain statistics, so the sampling approximation step introduces error. </p>

<p>However, this gives us another way to determine $n$: <strong>When $H < 0$ occurs, it indicates that $N$ samples are no longer sufficient to estimate the statistics well, which conversely means that the $n$-dimensional space is "more than enough" to accommodate $N$ samples.</strong> Therefore, we can simply determine a boundary using $H < 0$ without needing to estimate $\tilde{H}$. (Alternatively, from another perspective: $\tilde{H}$ is always greater than 0, so $H < 0$ is a sufficient condition for $H < \tilde{H}$.)</p>

<p>Finally, we see that $h_n$ is roughly linear with respect to $n$, with $h_n/n\approx -0.24$. Thus $H\approx\log N^2 -0.24n$. Setting it less than 0 allows us to solve for formula \eqref{eq:final}.</p>

<h3>Approximate Estimation</h3>

<p>Regarding the result $h_n/n\approx -0.24$, we can also obtain it theoretically. According to the definition of $h_n$, we have:</p>

\begin{equation}h_n = \log\frac{\int_0^{\pi} \sin^{n-2}\theta\, e^{n\cos\theta}d\theta}{\int_0^{\pi} \sin^{n-2}\theta d\theta} - n\frac{\int_0^{\pi} \sin^{n-2}\theta\, e^{n\cos\theta}\cos\theta d\theta}{\int_0^{\pi} \sin^{n-2}\theta\,e^{n\cos\theta} d\theta}\end{equation} 

<p>Essentially, this is an asymptotic estimation problem for several definite integrals. We mainly use the idea of Laplace's approximation. Assuming $n$ is large enough such that we can ignore the difference between $n$ and $n-2$, then:</p>

\begin{equation}\log\left[\sin^{n-2}\theta\, e^{n\cos\theta}\right]=(n-2)\log \sin\theta + n\cos\theta \approx n (\log \sin\theta + \cos\theta)\end{equation} 

<p>The maximum value of $\log\sin\theta + \cos\theta$ in $[0,\pi]$ can be calculated as occurring at $\arctan\sqrt{\frac{\sqrt{5}+1}{2}}\approx 0.904557$. Expanding to the second order at that point, we get:</p>

\begin{equation}\log \sin\theta + \cos\theta\approx 0.377428 -1.11803 (\theta - 0.904557)^2\end{equation} 

<p>Thus:</p>

\begin{equation}\begin{aligned} 
\int_0^{\pi} \sin^{n-2}\theta\, e^{n\cos\theta}d\theta\approx&\, \int_{-\infty}^{\infty} e^{n[0.377428 -1.11803 (\theta - 0.904557)^2]}d\theta\\ 
\approx&\, \frac{1.67629}{\sqrt{n}}e^{0.377428n} 
\end{aligned}\end{equation} 

<p>And note that when $n$ is large enough, the integrand is significantly non-zero only near $\theta=0.904557$ (or treating the limit of the normal distribution as an approximation of the Dirac delta function), yielding:</p>

\begin{equation}\begin{aligned} 
\frac{\int_0^{\pi} \sin^{n-2}\theta\, e^{n\cos\theta}\cos\theta d\theta}{\int_0^{\pi} \sin^{n-2}\theta\, e^{n\cos\theta} d\theta}\approx&\, \frac{\int_{-\infty}^{\infty} e^{n[0.377428 -1.11803 (\theta - 0.904557)^2]}\cos\theta d\theta}{\int_{-\infty}^{\infty} e^{n[0.377428 -1.11803 (\theta - 0.904557)^2]}d\theta} \\ 
\approx&\, \int_{-\infty}^{\infty} \delta(\theta - 0.904557) \cos\theta d\theta\\ 
=&\,\cos 0.904557 \approx 0.618034 
\end{aligned}\end{equation} 

<p>Similarly, using Laplace's approximation, we can get $\int_0^{\pi} \sin^{n-2}\theta d\theta\approx\frac{2.50663}{\sqrt{n}}$. Integrating all results, we obtain:</p>

\begin{equation}h_n \approx \log \frac{\frac{1.67629}{\sqrt{n}}e^{0.377428n}}{\frac{2.50663}{\sqrt{n}}}-0.618034n\approx -0.240606 n\end{equation} 

<p>This yields the result $h_n/n\approx -0.24$. The above derivation used numerical values; if all analytical values are preserved, the analytical solution for this coefficient is $\frac{1}{2}\log\frac{\sqrt{5}+1}{2}$.</p>

<h3>Summary</h3>

<p>In this article, we analyzed the problem of selecting word vector dimensions based on the Principle of Minimum Entropy and finally provided an approximate estimation formula. The calculations show that this estimation formula is consistent with our past "alchemy" experience in deep learning.</p>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/7695" style="color: #005fcc;">https://kexue.fm/archives/7695</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
