
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    tags: 'ams',
    packages: {'[+]': ['ams']}
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<article>
    <h1><a href="https://kexue.fm/archives/8541">Enhancing RoFormer-Sim with Open-Source Human-Annotated Data</a></h1>
    
    <p>By 苏剑林 | July 19, 2021</p>

    <p>As many of you know, from <a href="translation_7427.html">SimBERT</a> to <a href="translation_8454.html">SimBERTv2 (RoFormer-Sim)</a>, we have established a fairly decent baseline model for Chinese text similarity tasks. However, both SimBERT and RoFormer-Sim are essentially "weakly supervised" models, similar to unsupervised ones; we cannot expect a purely weakly supervised model to achieve effects that perfectly align with human cognition. Therefore, to further improve the performance of RoFormer-Sim, we attempted to use some open-source annotated data to assist in training. This article introduces our exploration process.</p>

    <p>Some readers might think: Is there anything to talk about regarding supervised training? Isn't it just direct training? While that's easy to say, it's not actually that "obvious and straightforward." There are still some "minefields," so this article can be considered a simple "mine-clearing guide."</p>

    <h2 id="前情回顾">Previous Recollection <a href="https://kexue.fm/archives/8541#前情回顾">#</a></h2>
    <p>I have found that since the release of SimBERT, the most frequent question from readers is probably:</p>
    <blockquote>
        Why is the similarity between "I like Beijing" and "I don't like Beijing" so high? Aren't their meanings opposite?
    </blockquote>
    <p>This is especially true after the release of RoFormer-Sim; similar questions appear almost every week or two. Furthermore, not only in my own "Scientific Spaces" exchange group, but also in other NLP-related groups, similar questions pop up from time to time, indicating that this doubt is widespread.</p>
    <p>So, how should we understand this?</p>
    <p>First, the cognition of "opposite meaning" is incorrect. From the perspective of similarity, there are only "similar" and "not similar" distinctions; there is no such thing as "opposite." In principle, no two sentences are absolutely unrelated, so theoretically, the similarity of any two sentences is not zero, let alone "opposite," which lacks a clear definition. Quite the contrary, the "antonyms" we usually think of are objectively very similar words from a certain perspective. For example, "like" and "hate" share many commonalities: both are verbs, both describe emotional tendencies, and their usage is similar. So how can we say these two words are "not similar at all" or even "opposite"? When we call them antonyms, we mean they are in an opposing relationship within a very small dimension. Note that it is only *one* dimension, not all. This means our cognition itself is subjective (with so many dimensions being similar and only one being dissimilar, we call them "antonyms"—isn't that subjective?).</p>
    <p>Similarly, in my understanding, from an objective perspective, "I like Beijing" and "I don't like Beijing" are very similar, so it is reasonable for the model to give a high similarity score; giving a low score would be unreasonable. Of course, I am not saying that they are similar in every scenario—they do indeed have opposing dimensions. The problem is that what unsupervised and weakly supervised learning produces are relatively objective results. If we believe "I like Beijing" and "I don't like Beijing" are not similar, it means we have subjectively picked out the dimensions we want to compare, rather than considering all objective dimensions. Since this is a subjective human act, we should not expect unsupervised or weakly supervised methods to learn it; the best way is to use annotated data for supervised learning.</p>
    <p>Therefore, to put it bluntly:</p>
    <blockquote>
        The model is not wrong; the person is. If the person insists they are not wrong, then please use supervised learning with annotated data to tell the model it is wrong.
    </blockquote>

    <h2 id="分门别类">Classification <a href="https://kexue.fm/archives/8541#分门别类">#</a></h2>
    <p>Through the discussion above, we should understand the necessity of supervised labeling. Not all problems can be solved through unsupervised or weakly supervised means. If one insists on a non-supervised solution, the cost might be far greater than labeling a few pieces of data.</p>
    <p>Regarding Chinese human-annotated data for similarity, there are currently three types collected:</p>
    <blockquote>
        <p>1. <strong>Yes/No Type</strong>: This is the most common type. The main format is "(Sentence 1, Sentence 2, Is Similar)". The ATEC, BQ, LCQMC, and PAWSX datasets collected <a href="translation_8321.html">here</a> are of this type;</p>
        <p>2. <strong>NLI Type</strong>: NLI stands for Natural Language Inference. The sample format is "(Sentence 1, Sentence 2, Entailment/Neutral/Contradiction)". This can be seen as a more granular similarity dataset. Currently, Chinese NLI datasets are mostly translated from English versions, with links at <a href="https://github.com/pluto-junzeng/CNSD">CNSD</a>;</p>
        <p>3. <strong>Scoring Type</strong>: This is the most precise similarity corpus, formatted as "(Sentence 1, Sentence 2, Similarity Level)". This degree is generally a finer-grained scale than 0/1. Currently, the Chinese dataset available is <a href="https://github.com/pluto-junzeng/CNSD">STS-B</a>, which is also translated from English.</p>
    </blockquote>
    <p>Since the first two types have larger volumes, for convenience, we directly set a threshold to convert the third type (STS-B) into the first type. Thus, we utilize two data formats: 1. Binary classification of sentence pairs; 2. Three-way classification of sentence pairs.</p>

    <h2 id="出乎意料">Unexpected <a href="https://kexue.fm/archives/8541#出乎意料">#</a></h2>
    <p>As mentioned at the beginning, even with supervised training, it is not "obvious and straightforward." This is mainly because the choice of training method was somewhat unexpected. For simplicity, let's start with binary classification training samples.</p>
    <p>Assume the sentence vectors obtained after two sentences pass through the encoder are $u$ and $v$. Since we usually use their cosine value $\cos(u,v) = \frac{\langle u, v \rangle}{\|u\|\|v\|}$ to rank similarity during the retrieval phase, a natural idea would be to design a loss function based on $\cos(u,v)$. Some easily conceived ones include:</p>

    \begin{equation}
    \begin{aligned}
    &t\cdot (\cos(u,v) - 1)^2 + (1 - t)\cdot \cos^2(u,v) \\
    &t\cdot (\cos(u,v) - 1)^2 + (1 - t)\cdot (\cos(u,v) + 1)^2 \\
    &t\cdot \max(0.9 - \cos(u,v), 0) + (1-t)\cdot \max(\cos(u,v) - 0.1, 0)
    \end{aligned}
    \end{equation}

    <p>where $t \in \{0, 1\}$ is the label for the sentence pair. These loss functions generally aim to make $\cos(u,v)$ for positive samples as large as possible and for negative samples as small as possible.</p>

    <p>However, in my experiments, these training schemes—where training and prediction are consistent—actually performed worse than a scheme that appears inconsistent, which originated from <a href="https://papers.cool/arxiv/1705.02364">InferSent</a> and was subsequently adopted by <a href="https://papers.cool/arxiv/1908.10084">Sentence-BERT</a>. Specifically, Sentence-BERT concatenates $u, v, |u-v|$ (where $|u-v|$ refers to the vector formed by taking the absolute value of each element of $u-v$) as features, followed by a fully connected layer for binary classification (or three-way classification for NLI datasets).</p>

    <p style="text-align:center;"><img src="https://kexue.fm/usr/uploads/2021/07/3226468865.png" alt="Sentence-BERT Training Phase" title="Sentence-BERT Training Phase" /><br /><em>Sentence-BERT Training Phase</em></p>

    <p style="text-align:center;"><img src="https://kexue.fm/usr/uploads/2021/07/2763557361.png" alt="Sentence-BERT Prediction Phase" title="Sentence-BERT Prediction Phase" /><br /><em>Sentence-BERT Prediction Phase</em></p>

    <p>Of course, this is just the training scheme. When using it, sentence vectors are still extracted, and cosine similarity is used for retrieval. Thus, the scheme used by InferSent and Sentence-BERT is actually an inconsistent training and prediction scheme: $\cos(u,v)$ is not directly involved during training, yet $\cos(u,v)$ can be used for retrieval during prediction with quite good performance. This is indeed unexpected.</p>

    <h2 id="闭门造车">Behind Closed Doors <a href="https://kexue.fm/archives/8541#闭门造车">#</a></h2>
    <p>I was also puzzled by this. I noticed that in the Sentence-BERT paper, they compared the final effects of different feature concatenation methods, showing that $u, v, |u-v|$ concatenation yields the best results. If only part of them is kept, the performance drops significantly, as shown in the table below.</p>

    <p style="text-align:center;"><img src="https://kexue.fm/usr/uploads/2021/07/1558247210.png" alt="Experimental results of different concatenation features" title="Experimental results of different concatenation features" /><br /><em>Experimental results of different concatenation features</em></p>

    <p>Inspired by this table, I "concocted" an explanation. First, we know that humans are very "picky," especially for similarity tasks; we usually believe that only very strict similarity counts as similarity. However, our training data is often not that precise. On one hand, the labels themselves might contain noise; on the other hand, for some sample pairs, annotators might mark them as positive because they share the same topic rather than the same semantics. That is to say, annotated data is often not as strict as we require. If we directly use the labels to learn our ranking metric, it might introduce unexpected bias.</p>

    <p>Looking back at the approach of concatenating $u, v, |u-v|$ followed by a fully connected layer, its scoring function is equivalent to:</p>

    \begin{equation}s = \langle u, w_1\rangle + \langle v, w_2\rangle + \langle |u-v|, w_3\rangle\end{equation}

    <p>where $w_1, w_2, w_3$ are the corresponding parameter vectors. For the first two terms, a large score for $\langle u, w_1\rangle + \langle v, w_2\rangle$ does not necessarily mean $u$ and $v$ are close; similarly, a small score doesn't mean they are far apart. Their role is more like a "topic classification" model used to identify if the topics of $u$ and $v$ are consistent. For the third term, we know $|u-v|=0 \Leftrightarrow u=v$, so the third term has the ability to judge the proximity of the two vectors, perhaps representing true "semantic similarity."</p>

    <p>Taken together, we can consider that the approach of concatenating $u, v, |u-v|$ followed by a fully connected layer includes both the score for judging topic consistency and the score for semantic similarity. It separates "topic" from "semantics," enhancing the model's fault tolerance to data, which allows the eventually learned vectors to reflect more pure and precise "semantics."</p>

    <h2 id="鱼与熊掌">Fish and Bear's Paw <a href="https://kexue.fm/archives/8541#鱼与熊掌">#</a></h2>
    <p>Through the Sentence-BERT scheme and open-source similarity datasets, we can learn a fairly good sentence vector model (i.e., a retrieval model). Extracting features from it and using cosine similarity as a metric yields good results. But the problem is that SimBERT and RoFormer-Sim were never meant to be pure retrieval models; they hope to "have their cake and eat it too"—having both good retrieval effects and the ability to generate similar sentences.</p>

    <p>To this end, after training a Sentence-BERT using the method above, we applied the scheme introduced in <a href="translation_8454.html">"SimBERTv2 is Here! RoFormer-Sim Model Integrating Retrieval and Generation"</a> to distill the retrieval effect of Sentence-BERT into RoFormer-Sim. This improves the retrieval performance while preserving the capability for similar sentence generation. Moreover, distillation between models of the same size often yields a slight performance boost. Thus, the retrieval performance of our distilled RoFormer-Sim is actually better than that of the directly trained Sentence-BERT.</p>

    <h2 id="效果演示">Performance Demo <a href="https://kexue.fm/archives/8541#效果演示">#</a></h2>
    <p>We provide the RoFormer-Sim weights trained with annotated data below (weights with the "-ft" suffix):</p>
    <blockquote>
        <strong><a href="https://github.com/ZhuiyiTechnology/roformer-sim">https://github.com/ZhuiyiTechnology/roformer-sim</a></strong>
    </blockquote>
    <p>Below are the test results (on test sets) for several tasks from <a href="translation_8321.html">"Which Unsupervised Semantic Similarity Method is Stronger? A Comprehensive Comparison"</a>:</p>

    \[
    \begin{array}{c|ccccc}
    \hline
    & \text{ATEC} & \text{BQ} & \text{LCQMC} & \text{PAWSX} & \text{STS-B} \\
    \hline
    \text{RoFormer-Sim} & 39.27 & 48.31 & 72.30 & 6.70 & 71.75 \\
    \text{RoFormer-Sim-FT} & 51.71 & 73.48 & 79.56 & 62.84 & 78.28 \\
    \hline
    \text{RoFormer-Sim-small} & 37.08 & 46.83 & 71.27 & 5.8 & 71.29 \\
    \text{RoFormer-Sim-FT-small} & 51.21 & 73.09 & 78.88 & 56.41 & 76.33 \\
    \hline
    \end{array}
    \]

    <p>As can be seen, there is a significant improvement, and the "small" version also delivers an impressive performance. Of course, since this is supervised training, improvement is inevitable; the comparison in this table isn't the main point. For users, having an available model is what matters, regardless of how it was created. Readers might be more concerned about whether this new model solves previous "pain points." For example, can it differentiate between "I like Beijing" and "I don't like Beijing"? Let's look at some examples (base version; the small version results are almost identical):</p>

    <blockquote>
        &gt;&gt;&gt; similarity(u'今天天气不错', u'今天天气很好')<br />
        0.9769838<br /><br />
        &gt;&gt;&gt; similarity(u'今天天气不错', u'今天天气不好')<br />
        0.62359834<br /><br />
        &gt;&gt;&gt; similarity(u'我喜欢北京', u'我很喜欢北京')<br />
        0.9921096<br /><br />
        &gt;&gt;&gt; similarity(u'我喜欢北京', u'我不喜欢北京')<br />
        0.5291042<br /><br />
        &gt;&gt;&gt; similarity(u'电影不错', u'电影很好')<br />
        0.96764225<br /><br />
        &gt;&gt;&gt; similarity(u'电影不错', u'电影不好')<br />
        0.6312722<br /><br />
        &gt;&gt;&gt; similarity(u'红色的苹果', u'绿色的苹果')<br />
        0.6974633<br /><br />
        &gt;&gt;&gt; similarity(u'给我推荐一款红色的车', u'给我推荐一款黑色的车')<br />
        0.7191832<br /><br />
        &gt;&gt;&gt; similarity(u'给我推荐一款红色的车', u'推荐一辆红车')<br />
        0.9866457<br /><br />
        &gt;&gt;&gt; similarity(u'给我推荐一款红色的车', u'麻烦来一辆红车')<br />
        0.9460306
    </blockquote>

    <p>From the examples, we can see that after supervised training, the model indeed reflects similarity scores that align more with common human cognition. For instance, the similarity drops significantly after adding the word "not" (不). Through comparison, we found that this effect is primarily brought about by the NLI dataset. Also, it becomes more sensitive to colors like "red" and "black," as shown in the last three examples, indicating that its retrieval ranking results align better with intent recognition scenarios.</p>

    <h2 id="本文小结">Summary <a href="https://kexue.fm/archives/8541#本文小结">#</a></h2>
    <p>This article introduced the process of enhancing RoFormer-Sim using annotated data and open-sourced the corresponding trained models, providing a better baseline for Chinese text similarity models.</p>
</article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/8541" style="color: #005fcc;">https://kexue.fm/archives/8541</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
