
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    tags: 'ams',
    packages: {'[+]': ['base', 'ams', 'extpfeil']}
  },
  options: {
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<nav style="margin-bottom: 1.5em;">
    <a href="../index.html" style="display: inline-flex; align-items: center; color: #555; text-decoration: none; font-size: 0.95em;">
        <span style="margin-right: 0.3em;">&larr;</span> Back to Index
    </a>
</nav>

<h1><a href="https://kexue.fm/archives/10474">Making MathJax Math Formulas Automatically Scale with Window Size</a></h1>

<p>By 苏剑林 | October 15, 2024</p>

<p>With the emergence and popularity of MathJax, displaying mathematical formulas on web pages has gradually become the standard solution. However, MathJax (including its competitor KaTeX) is only responsible for converting web LaTeX code into mathematical formulas; it still lacks a robust method for adaptive resolution. Like some of the mathematical articles on this site, because they were composed on a PC, the browsing effect is acceptable on the PC side, but it can become somewhat unsightly when viewed on a mobile phone.</p>

<p>After some testing, I have developed a solution that allows MathJax mathematical formulas to automatically scale with the window size, just like images, thereby ensuring the best possible display effect on mobile devices. I would like to share this with you all.</p>

<h2>Background Idea</h2>

<p>The origin of this problem is that even when composing on a PC, there are times when the length of a single-line formula exceeds the width of the webpage, but it is not convenient to break the line. In such cases, one solution is to manually adjust the font size of the formula using HTML code, for example:</p>

<pre><code>&lt;div style="font-size: 90%"&gt; 
 \begin{equation}A very long mathematical formula\end{equation}
&lt;/div&gt;</code></pre>

<p>This adjusts the size of the mathematical formula to 90% of the original. While this solves most problems, manual adjustment is ultimately a bit troublesome. The figure of 90% needs to be manually debugged several times to obtain the optimal value, and it can only adapt to a single width. A few days ago, I suddenly realized a question: Why can't mathematical formulas be set with a <code>max-width</code> to automatically scale in size like images? For example, the following image code:</p>

<pre><code>&lt;img src="example.png" style="max-width: 100%; width: 400px;" /&gt;</code></pre>

<p>The effect achieved is that the image size stays as close to 400px as possible without exceeding the parent element. After some testing, I found that MathJax mathematical formulas are text blocks and there is no ready-made method to achieve the <code>max-width</code> scaling characteristic of images. However, we can use JavaScript to calculate the ratio by which a formula exceeds the width of its parent element and then automatically set the <code>font-size</code> for the mathematical formula to achieve the same effect.</p>

<h2>Code Reference</h2>

<p>First, here is the final reference solution. Replace the original MathJax configuration code with the following:</p>

<pre><code> MathJax.Hub.Config({
 tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
 TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}, extensions: ["AMSmath.js", "AMSsymbols.js", "extpfeil.js"]},
 "HTML-CSS": {noReflows: false, availableFonts: ["tex"], styles: {".MathJax_Display": {margin: "1em 0em 0.7em;", display: "inline-block!important;"}}},
 "CommonHTML": {noReflows: false, availableFonts: ["tex"], styles: {".MJXc-display": {margin: "1em 0em 0.7em;", display: "inline-block!important;"}}},
 "SVG": {noReflows: false, availableFonts: ["tex"], styles: {".MathJax_SVG_Display": {margin: "1em 0em 0.7em;", display: "inline-block!important;"}}}
 });
 MathJax.Hub.Queue(function() {
 document.querySelectorAll('span[id^="MathJax-Element"]').forEach(function(e) {
 parentWidth = e.parentNode.offsetWidth;
 if (e.parentNode.className.endsWith('isplay')) {
 parentWidth = e.parentNode.parentNode.offsetWidth;
 }
 if (e.offsetWidth > parentWidth) {
 e.style.fontSize = parentWidth * 100 / e.offsetWidth + '%';
 }
 });
 });</code></pre>

<p>Compared to the configuration code mentioned in <a href="translation_10320.html">"Making MathJax Better Compatible with Google Translate and Lazy Loading"</a>, there are two key changes. First, the configuration item <code>{linebreaks: {automatic: true, width: "95% container"}</code> has been removed. The purpose of this configuration was to enable automatic line breaking, originally intended to improve adaptability to resolution. However, in practice, it is not very useful; many well-written mathematical formulas actually look worse if they are broken automatically. Therefore, removing automatic line breaks ensures the consistency of mathematical formulas across different widths.</p>

<p>The next key modification is the <code>MathJax.Hub.Queue</code> section. This is a function executed after formula rendering is complete. It first finds all <code>span</code> elements with an ID starting with "MathJax-Element," which are all the mathematical formulas. Then, it obtains its width through <code>e.offsetWidth</code> and the width of its parent element via <code>e.parentNode.offsetWidth</code> or <code>e.parentNode.parentNode.offsetWidth</code>. Based on this result, it calculates and sets the percentage by which the <code>font-size</code> should be reduced.</p>

<p>When should <code>e.parentNode.offsetWidth</code> or <code>e.parentNode.parentNode.offsetWidth</code> be used? Mathematical formulas are divided into "inline formulas" and "display formulas." Inline formulas use the former directly, while display formulas use the latter. In the code, display formulas are nested within an extra layer of <code>div</code>, so the grandparent node is the parent element. Since the class of this <code>div</code> ends with "Display" or "display," the criterion <code>e.parentNode.className.endsWith('isplay')</code> was added.</p>

<p>The above explains all the principles of the reference code.</p>

<h2>Summary</h2>

<p>This article shares a solution for making MathJax formulas automatically scale according to the window size, which can be as compatible as possible with the narrow-screen browsing requirements of mobile devices. After adjustment, even on a small screen, mathematical formulas will appear the same as they do on a PC—though they might be a bit straining for the eyes, it is a useful emergency measure.</p>

<p><em>Modified narrow-screen display effect</em></p>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/10474" style="color: #005fcc;">https://kexue.fm/archives/10474</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
