
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    tags: 'ams',
    packages: {'[+]': ['base', 'ams', 'noerrors', 'noundefined']}
  },
  loader: {load: ['[tex]/ams']}
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<h1><a href="https://kexue.fm/archives/8998">RoFormerV2: Exploration of the Limits of Natural Language Understanding</a></h1>

<p>By 苏剑林 | March 21, 2022</p>

<p>About a year ago, we proposed <a href="translation_8265.html">Rotary Position Embedding (RoPE)</a> and released the corresponding pre-trained model <a href="https://github.com/ZhuiyiTechnology/roformer">RoFormer</a>. Over time, RoFormer has fortunately received increasing attention and recognition. For example, EleutherAI's newly released <a href="https://github.com/kingoflolz/mesh-transformer-jax/#gpt-j-6b">6 billion</a> and <a href="https://blog.eleuther.ai/announcing-20b/">20 billion</a> parameter GPT models utilize RoPE position embeddings. Furthermore, Google's newly proposed <a href="translation_8934.html">FLASH</a> model paper explicitly points out that RoPE has a significant positive effect on Transformer performance.</p>

<p>At the same time, we have been continuously trying to further strengthen the RoFormer model, attempting to take RoFormer's performance "to the next level." After nearly half a year of effort, we believe we have achieved quite good results, which we are now officially releasing as "RoFormerV2":</p>

<blockquote>
    <strong>Github: <a href="https://github.com/ZhuiyiTechnology/roformer-v2">https://github.com/ZhuiyiTechnology/roformer-v2</a></strong>
</blockquote>

<h2>Exploration of the Limits</h2>

<p>Since the rise of pre-trained models, many researchers have been quite interested in one question: Where is the limit of pre-trained models? Of course, the word "limit" has many meanings. A series of works represented by GPT-3 aims to explore the limits of parameter and data volume, while Microsoft's recently proposed <a href="translation_8978.html">DeepNet</a> explores the limit of depth. For us, we are more interested in the performance limit under the same parameter count, attempting to "squeeze" the performance of pre-trained models to the fullest; RoFormerV2 is a product of this philosophy.</p>

<p>In simple terms, RoFormerV2 first makes appropriate simplifications to the model structure on the basis of RoFormer, thereby obtaining a certain speed increase. In terms of training, in addition to performing regular unsupervised MLM pre-training, we also collected more than 20GB of labeled data to perform supervised multi-task pre-training. Under supervised training, the model's performance improved significantly, basically achieving the optimal solution for speed and effectiveness at the same parameter scale.</p>

<p>Notably, the 300-million-parameter RoFormer Large exceeded several models with 1 billion+ parameters on the <a href="https://www.cluebenchmarks.com/rank.html">CLUE Leaderboard</a>, reaching 5th place. It is also the model with the fewest parameters among the top 5 on the leaderboard:</p>

<p><img src="https://kexue.fm/usr/uploads/2022/03/3295325881.png" alt="RoFormerV2 large performance on CLUE" /></p>

<h2>Model Introduction</h2>

<p>Compared to RoFormer, the main changes in RoFormerV2 are the simplified model structure, increased training data, and the addition of supervised training. These changes allow RoFormerV2 to ultimately achieve a "win-win" in terms of speed and performance.</p>

<h3>Structural Simplification</h3>

<p>In terms of structure, RoFormerV2 primarily removes all Bias terms from the model, replaces Layer Norm with a simpler RMS Norm, and removes the gamma parameter of the RMS Norm. The inspiration for these changes mainly comes from Google's <a href="https://papers.cool/arxiv/1910.10683">T5</a> model.</p>

<p>Everyone's subconscious might think that the computation of Bias terms and the beta and gamma parameters of Layer Norm is very small, or at least negligible for speed. But the facts exceeded our expectations: by removing these seemingly "trivial" parameters, the training speed of RoFormerV2 achieved a significant improvement!</p>

<p>Some reference data are as follows (since RoFormer and RoBERTa have similar speeds, they are not listed separately; the Base version was tested on a 3090, and the Large version was tested on an A100):</p>

\[\begin{array}{c|cc|cc}
\hline
& \text{Sequence Length} & \text{Training Speed} & \text{Sequence Length} & \text{Training Speed} \\
\hline
\text{RoBERTa base} & 128 & 1.0\text{x} & 512 & 1.0\text{x} \\
\text{RoFormerV2 base} & 128 & 1.3\text{x} & 512 & 1.2\text{x}\\
\hline
\text{RoBERTa large} & 128 & 1.0\text{x} & 512 & 1.0\text{x} \\
\text{RoFormerV2 large} & 128 & 1.3\text{x} & 512 & 1.2\text{x} \\
\hline
\end{array}\]

<h3>Unsupervised Training</h3>

<p>Like RoFormer, RoFormerV2 is first pre-trained using the MLM task. The main differences are two-fold:</p>

<blockquote>
    1. RoFormer was trained on top of RoBERTa weights, whereas RoFormerV2 is trained from scratch;<br>
    2. RoFormer's unsupervised training used only 30+ GB of data, while RoFormerV2 used 280 GB of data.
</blockquote>

<p>Training from scratch is more difficult than continuing training on existing weights, mainly reflected in the fact that the Post Norm structure is harder to converge. To this end, we proposed a new training technique: designing the residual as:</p>

\begin{equation}\boldsymbol{x}_{t+1} = \text{Norm}(\boldsymbol{x}_t + \alpha F(\boldsymbol{x}_t)) \end{equation}

<p>where $\alpha$ is initialized to 0 and increases linearly and slowly to 1. Related discussions can also be found in <a href="translation_8620.html">"A Brief Discussion on the Initialization, Parameterization, and Normalization of Transformers"</a>. This scheme is similar to ReZero, the difference being that in ReZero, $\alpha$ is a trainable parameter and the $\text{Norm}$ operation is removed. Experiments show that our modification yields better final results than ReZero and was almost the optimal solution before DeepNet.</p>

<h3>Multi-task Training</h3>

<p>As mentioned earlier, the structure of RoFormerV2 was simplified to gain speed, but because there is "no free lunch," RoFormerV2's performance would slightly decrease compared to RoBERTa and RoFormer under the same training settings. To compensate for this decline and more effectively exploit the model's potential, we added supervised multi-task pre-training.</p>

<p>Specifically, we collected 77 labeled datasets totaling 20GB and constructed 92 tasks for multi-task training. These datasets cover common natural language understanding tasks such as text classification, text matching, reading comprehension, information extraction, and coreference resolution, so that the model can acquire relatively comprehensive natural language understanding capabilities. To complete the training, we further developed a multi-task training framework based on bert4keras, which flexibly supports hybrid training of tasks in different formats and integrates techniques such as gradient normalization (refer to <a href="translation_8896.html">"Multi-task Learning Discussion (II): The Matter of Gradients"</a>) to ensure that each task achieves as optimal an effect as possible.</p>

<p>RoFormerV2 is not the first model to attempt multi-task pre-training. Before it, <a href="https://papers.cool/arxiv/1901.11504">MT-DNN</a>, <a href="https://papers.cool/arxiv/1910.10683">T5</a>, and the more recent <a href="https://papers.cool/arxiv/2201.06910">ZeroPrompt</a> have already affirmed the value of multi-task pre-training. Our main contribution is to have fully verified this on Chinese data and to be the first to open-source it.</p>

<h2>Experimental Results</h2>

<p>We mainly compare results on the CLUE benchmark:</p>

\[\small{\begin{array}{c|ccccccccccc}
\hline
& \text{iflytek} & \text{tnews} & \text{afqmc} & \text{cmnli} & \text{ocnli} & \text{wsc} & \text{csl} & \text{cmrc2018} & \text{c3} & \text{chid} & \text{cluener}\\
\hline
\text{BERT base} & 61.19 & 56.29 & 73.37 & 79.37 & 71.73 & 73.85 & 84.03 & 72.10 & 61.33 & 85.13 & 78.68\\
\hline
\text{RoBERTa base} & 61.12 & 58.35 & 73.61 & 80.81 & 74.27 & 82.28 & \textbf{85.33} & 75.40 & 67.11 & 86.04 & 79.38\\
\text{RoBERTa large} & 60.58 & 55.51 & 75.14 & \textbf{82.16} & 75.47 & 81.97 & 85.07 & 78.85 & 76.74 & \textbf{88.65} & \textbf{80.19}\\
\hline
\text{RoFormer base} & 61.08 & 56.74 & 73.82 & 80.97 & 73.10 & 80.57 & 84.93 & 73.50 & 66.29 & 86.30 & 79.69\\
\hline
\text{RoFormerV2 small} & 60.46 & 51.46 & 72.39 & 76.93 & 67.70 & 69.11 & 83.00 & 71.80 & 64.49 & 77.35 & 78.20\\
\text{RoFormerV2 base} & 62.50 & \textbf{58.74} & 75.63 & 80.62 & 74.23 & 82.71 & 84.17 & 77.00 & 75.57 & 85.95 & 79.87\\
\text{RoFormerV2 large} & \textbf{62.65} & 58.06 & \textbf{76.95} & 81.20 & \textbf{75.83} & \textbf{88.03} & 84.97 & \textbf{80.50} & \textbf{78.34} & 87.68 & \textbf{80.17}\\
\hline
\end{array}}\]

<p>As can be seen, the improvement from multi-task training is quite substantial. On most tasks, RoFormerV2 not only "reclaims" the performance gap caused by structural simplification but also shows a certain improvement. On average, it can be considered to have achieved the best performance among models of the same class. Additionally, on the two tasks CMNLI and CHID, RoFormerV2 is not as good as RoBERTa. This is because both tasks have a very large amount of training data (hundreds of thousands of samples). When the amount of training data is large enough, the performance of the model depends mainly on the model capacity, and the improvement brought by multi-task training is relatively small.</p>

<p>So, in summary: if your task type is relatively common and the data volume is not particularly large, RoFormerV2 is often a good choice; if you want to speed up training a bit, you can also choose RoFormerV2; but if your task data volume is especially large, RoFormerV2 usually has no advantage.</p>

<h2>Summary</h2>

<p>This article provides a basic introduction to our newly released RoFormerV2 model. It mainly improves speed through structural simplification and improves performance through the combination of unsupervised pre-training and supervised pre-training, thereby achieving a "win-win" in speed and effectiveness.</p>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="translation_8998.html" style="color: #005fcc;">https://kexue.fm/archives/8998</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
