
    <style type="text/css">

    body {
    margin: 48px auto;
    max-width: 68ch;              /* character-based width reads better */
    padding: 0 16px;

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 18px;
    line-height: 1.65;
    color: #333;
    background: #fafafa;
    }

    h1, h2, h3, h4 {
    line-height: 1.25;
    margin-top: 2.2em;
    margin-bottom: 0.6em;
    font-weight: 600;
    }

    h1 {
    font-size: 2.1em;
    margin-top: 0;
    }

    h2 {
    font-size: 1.6em;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.3em;
    }

    h3 {
    font-size: 1.25em;
    }

    h4 {
    font-size: 1.05em;
    color: #555;
    }

    /* Paragraphs and lists */
    p {
    margin: 1em 0;
    }

    ul, ol {
    margin: 1em 0 1em 1.5em;
    }

    li {
    margin: 0.4em 0;
    }

    a {
    color: #005fcc;
    text-decoration: none;
    }

    a:hover {
    text-decoration: underline;
    }

    code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.95em;
    background: #f2f2f2;
    padding: 0.15em 0.35em;
    border-radius: 4px;
    }

    pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 0.9em;
    background: #f5f5f5;
    padding: 1em 1.2em;
    overflow-x: auto;
    border-radius: 6px;
    line-height: 1.45;
    }

    pre code {
    background: none;
    padding: 0;
    }

    blockquote {
    margin: 1.5em 0;
    padding-left: 1em;
    border-left: 4px solid #ddd;
    color: #555;
    }

    hr {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3em 0;
    }

    table {
    border-collapse: collapse;
    margin: 1.5em 0;
    width: 100%;
    font-size: 0.95em;
    }

    th, td {
    padding: 0.5em 0.7em;
    border-bottom: 1px solid #e5e5e5;
    text-align: left;
    }

    th {
    font-weight: 600;
    }

    img {
    max-width: 100%;
    display: block;
    margin: 1.5em auto;
    }

    small {
    color: #666;
    }

    mjx-container {
    margin: 1em 0;
    }

    ::selection {
    background: #cce2ff;
    }

    </style>
    

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    tags: 'ams',
    macros: {
      mathbb: ["{\\mathbb{#1}}", 1],
      mathcal: ["{\\mathcal{#1}}", 1]
    }
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<article>
    <h1><a href="https://kexue.fm/archives/8679">The Amazing Johnson-Lindenstrauss Lemma: Theoretical Edition</a></h1>
    <p>By 苏剑林 | September 17, 2021</p>

    <p>Today we are going to learn about the Johnson-Lindenstrauss Lemma. Since the name is quite long, we will refer to it as the "JL Lemma" hereafter.</p>

    <p>In my personal opinion, the JL Lemma is one of the miraculous conclusions that every computer science student must understand. It is a famous result regarding dimensionality reduction and serves as one of the classic examples of the counter-intuitive "curse of dimensionality" phenomena in high-dimensional spaces. It can be said that the JL Lemma is the theoretical foundation for various dimensionality reduction and hashing techniques in machine learning. Furthermore, in modern machine learning, the JL Lemma provides important theoretical support for our understanding and tuning of model hyperparameters such as dimensions.</p>

    <h2>Logarithmic Dimensions</h2>

    <p>The JL Lemma can be expressed very popularly as:</p>

    <blockquote>
        <p><strong>Popular Version of the JL Lemma</strong>: To accommodate $N$ vectors, you only need $\mathcal{O}(\log N)$ dimensional space.</p>
    </blockquote>

    <p>Specifically, the JL Lemma states that regardless of the original dimensionality of these $N$ vectors, we can reduce them to $\mathcal{O}(\log N)$ while keeping the relative distance errors within a certain range. Imagine how powerful, counter-intuitive, and practical this conclusion is. For instance, in vector retrieval, the original vector dimensionality might be very large, making full retrieval extremely costly. The JL Lemma tells us that we can transform them into $\mathcal{O}(\log N)$ dimensions with retrieval performance remaining nearly unchanged—it's simply a "free lunch"!</p>

    <p>Readers might wonder: with such a powerful conclusion, would the corresponding dimensionality reduction method be extremely complex? The answer is quite the opposite; the reduction process involves only random linear projection! There is even a saying that the JL Lemma is a "conclusion that is easier to prove than to understand." That is, proving it mathematically is not particularly difficult, but intuitively grasping this counter-intuitive conclusion is actually harder.</p>

    <p>Coincidentally, we have previously introduced two counter-intuitive results: in the article <a href="translation_7076.html">"Distribution of the Angle Between Two Random Vectors in n-dimensional Space"</a>, we introduced the idea that "any two vectors in high-dimensional space are almost perpendicular," which is clearly far from our results in 2D or 3D space. In the article <a href="translation_7180.html">"Understanding Model Parameter Initialization Strategies from a Geometric Perspective"</a>, this result was further upgraded to "an $n \times n$ matrix sampled from $\mathcal{N}(0, 1/n)$ is almost an orthogonal matrix," which significantly contradicts our standard understanding that "orthogonality is very strict (requiring the transpose to equal the inverse)."</p>

    <p>But in fact, these two conclusions are not only correct but also directly related to the JL Lemma. One could say the JL Lemma is a refinement and application of them. Therefore, we first need to characterize these two conclusions with more quantitative language, such as exactly what the probability of being "almost perpendicular" is, or how large the error in "approximate orthogonality" actually is.</p>

    <h2>Probability Inequalities</h2>

    <p>For this, we need some probability knowledge, most importantly "Markov's Inequality":</p>

    <blockquote>
        <p><strong>Markov's Inequality</strong>: If $x$ is a non-negative random variable and $a > 0$, then
        \begin{equation}P(x\geq a)\leq \frac{\mathbb{E}[x]}{a}\end{equation}</p>
    </blockquote>

    <p>Note that this inequality does not impose other special restrictions on the distribution followed by $x$, requiring only that the sample space for the random variable is non-negative (or equivalently, the probability of negative $x$ is zero). The proof is quite simple:
    \begin{equation}\mathbb{E}[x]=\int_0^{\infty}x p(x) \geq \int_a^{\infty}x p(x) \geq \int_a^{\infty} a p(x) = a P(x\geq a)\end{equation}</p>

    <p>Markov's inequality requires the random variable to be non-negative, but the variables we usually deal with are not necessarily non-negative, so we usually need a transformation. For example, $x - \mathbb{E}[x]$ is not non-negative, but $|x - \mathbb{E}[x]|$ is non-negative. Thus, using Markov's inequality:
    \begin{equation}P(|x - \mathbb{E}[x]|\geq a) = P((x - \mathbb{E}[x])^2\geq a^2) \leq \frac{\mathbb{E}[(x - \mathbb{E}[x])^2]}{a^2}=\frac{\mathbb{V}ar[x]}{a^2}\end{equation}
    This is "Chebyshev's Inequality."</p>

    <p>Another classic technique is called the "Cramér-Chernoff Method," which is the primary method we will use later. It uses an exponential function to turn a random variable into a non-negative one: for any $\lambda > 0$, we have
    \begin{equation}x \geq a \quad\Leftrightarrow\quad \lambda x \geq \lambda a \quad\Leftrightarrow\quad e^{\lambda x} \geq e^{\lambda a}\end{equation}
    So, using Markov's inequality:
    \begin{equation}P(x \geq a) = P(e^{\lambda x} \geq e^{\lambda a})\leq e^{-\lambda a}\mathbb{E}[e^{\lambda x}]\end{equation}
    While the left side is independent of $\lambda$, there is a $\lambda$ on the right side, and this inequality holds for any $\lambda > 0$. Thus, theoretically, we can find the $\lambda$ that minimizes the right side to obtain the sharpest estimate:
    \begin{equation}P(x \geq a) \leq \min_{\lambda > 0} e^{-\lambda a}\mathbb{E}[e^{\lambda x}]\end{equation}</p>

    <h2>The Lemma of the Lemma</h2>

    <p>Now, we can introduce the following result, which is a lemma for the JL Lemma, or one could say, the theoretical foundation for all conclusions in this article:</p>

    <blockquote>
        <p><strong>Unit Norm Lemma</strong>: Let $u\in\mathbb{R}^{n}$ be a vector where each component is independently and identically sampled from $\mathcal{N}(0,1/n)$. Let $\varepsilon \in (0, 1)$ be a given constant. We have
        \begin{equation}P(|\| u\|^2 - 1| \geq \varepsilon) \leq 2\exp\left(-\frac{\varepsilon^2 n}{8}\right)\end{equation}</p>
    </blockquote>

    <p>This lemma tells us that when $n$ is large enough, the probability that the norm of $u$ significantly deviates from 1 is very small (for a given $\varepsilon$, it decreases exponentially with respect to $n$ to 0). Thus, an $n$-dimensional vector sampled from $\mathcal{N}(0,1/n)$ will be very close to a unit vector.</p>

    <p>Its proof involves the "Cramér-Chernoff Method": first, $|\| u\|^2 - 1| \geq \varepsilon$ implies $\| u\|^2 - 1 \geq \varepsilon$ or $1 - \| u\|^2\geq \varepsilon$. We need to derive these separately. Without loss of generality, we first derive the probability of $\| u\|^2 - 1 \geq \varepsilon$. According to the Cramér-Chernoff method:
    \begin{equation}P(\| u\|^2 - 1 \geq \varepsilon) \leq \min_{\lambda > 0} e^{-\lambda \varepsilon}\mathbb{E}\big[e^{\lambda (\| u\|^2 - 1)}\big] = \min_{\lambda > 0} e^{-\lambda (\varepsilon + 1)}\mathbb{E}\big[e^{\lambda \| u\|^2}\big]\end{equation}
    Writing $u$ in component form $(u_1, u_2, \cdots, u_n)$, where each component is independent and follows $\mathcal{N}(0,1/n)$, we have:
    \begin{equation}\mathbb{E}\big[e^{\lambda \| u\|^2}\big] = \mathbb{E}\big[e^{\lambda\sum\limits_i u_i^2}\big] = \mathbb{E}\big[\prod_i e^{\lambda u_i^2}\big]=\prod_i \mathbb{E}\big[ e^{\lambda u_i^2}\big]\end{equation}
    Since $\mathbb{E}\big[ e^{\lambda u_i^2}\big]=\int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi}}e^{-u_i^2/2}e^{\lambda u_i^2/n} du_i=\sqrt{n/(n-2\lambda)}$, then:
    \begin{equation}P(\| u\|^2 - 1 \geq \varepsilon) \leq \min_{\lambda > 0} e^{-\lambda (\varepsilon + 1)}\left(\frac{n}{n-2\lambda}\right)^{n/2}\end{equation}
    The minimum on the right side is attained at $\lambda = \frac{n\varepsilon}{2(1+\epsilon)}$. The derivation is left to the reader. Substituting it back, we get:
    \begin{equation}P(\| u\|^2 - 1 \geq \varepsilon) \leq e^{n(\log(1+\varepsilon) - \varepsilon)/2}\leq e^{-n\varepsilon^2/8}\end{equation}
    The proof that $\log(1+\varepsilon) - \varepsilon \leq -\varepsilon^2/4$ is also left to the reader. Similarly, we can derive the probability for $1 - \| u\|^2\geq \varepsilon$, resulting in:
    \begin{equation}P(1 - \| u\|^2\geq \varepsilon) \leq e^{n(\log(1-\varepsilon) + \varepsilon)/2}\leq e^{-n\varepsilon^2/8}\end{equation}
    Where it can be proved that $\log(1-\varepsilon) + \varepsilon \leq \log(1+\varepsilon) - \varepsilon$, so the above uses the bound for $\log(1+\varepsilon) - \varepsilon$. Adding the two expressions together, we get $P(|\| u\|^2 - 1| \geq \varepsilon)\leq 2e^{-n\varepsilon^2/8}$. Q.E.D.</p>

    <p>Starting from the "Unit Norm Lemma," we can prove the "Orthogonality Lemma":</p>

    <blockquote>
        <p><strong>Orthogonality Lemma</strong>: Let $u,v\in\mathbb{R}^{n}$ be two vectors independently and identically sampled from $\mathcal{N}(0,1/n)$. Let $\varepsilon \in (0, 1)$ be a given constant. We have
        \begin{equation}P(|\langle u, v\rangle| \geq \varepsilon) \leq 4\exp\left(-\frac{\varepsilon^2 n}{8}\right)\end{equation}</p>
    </blockquote>

    <p>This lemma tells us that when $n$ is large enough, the probability that the inner product of $u, v$ significantly deviates from 0 is very small. Combined with the "Unit Norm Lemma," we get the conclusion that "an $n \times n$ matrix sampled from $\mathcal{N}(0, 1/n)$ is almost an orthogonal matrix."</p>

    <p>With the "Unit Norm Lemma" as a foundation, the proof is not difficult. We know that if $u,v\sim \mathcal{N}(0,1/n)$, then $\frac{u\pm v}{\sqrt{2}}\sim \mathcal{N}(0,1/n)$. According to the proof of the "Unit Norm Lemma," we have:
    \begin{equation}P\left(\left\| \frac{u+v}{\sqrt{2}}\right\|^2 - 1 \geq \varepsilon\right) \leq e^{-n\varepsilon^2/8},\quad P\left(1-\left\| \frac{u-v}{\sqrt{2}}\right\|^2 \geq \varepsilon\right) \leq e^{-n\varepsilon^2/8}\end{equation}
    Note that adding $\left\| \frac{u+v}{\sqrt{2}}\right\|^2 - 1 \geq \varepsilon$ and $1-\left\| \frac{u-v}{\sqrt{2}}\right\|^2 \geq \varepsilon$ leads to $\langle u, v\rangle\geq \varepsilon$, hence:
    \begin{equation}P(\langle u, v\rangle\geq \varepsilon) \leq P\left(\left\| \frac{u+v}{\sqrt{2}}\right\|^2 - 1 \geq \varepsilon\right) + P\left(1-\left\| \frac{u-v}{\sqrt{2}}\right\|^2 \geq \varepsilon\right) \leq 2e^{-n\varepsilon^2/8}\end{equation}
    Similarly, we can prove $P(-\langle u, v\rangle\geq \varepsilon) \leq 2e^{-n\varepsilon^2/8}$. Combining both yields the "Orthogonality Lemma."</p>

    <h2>The Proof Process</h2>

    <p>Now we can proceed to prove the JL Lemma. Here is its mathematical statement:</p>

    <blockquote>
        <p><strong>Mathematical Version of the JL Lemma</strong>: Given $N$ vectors $v_1,v_2,\cdots,v_N\in\mathbb{R}^m$ and $n > \frac{24\log N}{\varepsilon^2}$, and a random matrix $A\in\mathbb{R}^{n\times m}$ where each element is independently and identically sampled from $\mathcal{N}(0,1/n)$, and a constant $\varepsilon \in (0, 1)$, then with a probability of at least $\frac{N-1}{N}$, for all $i\neq j$, the following holds:
        \begin{equation}(1-\varepsilon)\| v_i - v_j\|^2 \leq \| Av_i - A v_j\|^2 \leq (1+\varepsilon)\| v_i - v_j\|^2\label{eq:bound}\end{equation}</p>
    </blockquote>

    <p>The lemma tells us that regardless of the original vector dimensionality $m$, we only need $n > \frac{24\log N}{\varepsilon^2}$ dimensions to accommodate $N$ vectors such that the deviation in their relative distances does not exceed $\varepsilon$. Furthermore, the JL Lemma provides the dimensionality reduction method: just randomly sample an $n\times m$ matrix $A$ from $\mathcal{N}(0,1/n)$, and the transformation $v\to Av$ will achieve the goal with a probability of at least $\frac{N-1}{N}$. This is truly simple and practical!</p>

    <p>The proof process is also a direct application of the "Unit Norm Lemma." First, if $u\in\mathbb{R}^m$ is a given unit vector and $A\in\mathbb{R}^{n\times m}$ is sampled from $\mathcal{N}(0,1/n)$, then each component of $Au$ is independently distributed as $\mathcal{N}(0,1/n)$. The proof is not hard: by definition each component $(Au)_i = \sum\limits_j A_{i,j}u_j$. Since $A_{i,j}$ are independent, $(Au)_i$ are clearly independent. Since $A_{i,j}\sim\mathcal{N}(0,1/n)$, the sum of normal random variables is still normal, so $(Au)_i$ follows a normal distribution with mean $\sum\limits_j u_j\times 0=0$ and variance $\sum\limits_j u_j^2\times \frac{1}{n} = \frac{1}{n}$.</p>

    <p>So, essentially, $Au$ is equivalent to an $n$-dimensional vector sampled independently from $\mathcal{N}(0,1/n)$. Now substituting $u=\frac{v_i - v_j}{\| v_i - v_j\|}$ and using the "Unit Norm Lemma":
    \begin{equation}P\left(\left| \left\| \frac{A(v_i - v_j)}{\| v_i - v_j\|}\right\|^2 - 1\right| \geq \varepsilon\right) \leq 2\exp\left(-\frac{\varepsilon^2 n}{8}\right)\end{equation}
    This result holds for any $i\neq j$. Considering all pairs $i\neq j$, the probability that at least one pair is $\geq \varepsilon$ is at most:
    \begin{equation}P\left(\exists (i,j):\,\left| \left\| \frac{A(v_i - v_j)}{\| v_i - v_j\|}\right\|^2 - 1\right| \geq \varepsilon\right) \leq 2 {N\choose 2} \exp\left(-\frac{\varepsilon^2 n}{8}\right)\end{equation}
    Or conversely, the probability that for all $i\neq j$, $\left| \left\| \frac{A(v_i - v_j)}{\| v_i - v_j\|}\right\|^2 - 1\right| \leq \varepsilon$ (equivalent to $\eqref{eq:bound}$) holds is at least:
    \begin{equation}1 - 2 {N\choose 2} \exp\left(-\frac{\varepsilon^2 n}{8}\right) = 1 - N(N-1)\exp\left(-\frac{\varepsilon^2 n}{8}\right)\end{equation}
    Substituting $n > \frac{24\log N}{\varepsilon^2}$, we get:
    \begin{equation}1 - N(N-1)\exp\left(-\frac{\varepsilon^2 n}{8}\right)\geq 1 - N(N-1)N^{-3}\geq 1-N^{-1}\end{equation}
    With this, the proof is complete.</p>

    <p>The JL Lemma above preserves the Euclidean distance approximately. Many times, retrieval uses the inner product (like cosine similarity) rather than Euclidean distance. For this, we have:</p>

    <blockquote>
        <p><strong>Inner Product Version of the JL Lemma</strong>: Given $N$ unit vectors $v_1,v_2,\cdots,v_N\in\mathbb{R}^m$ and $n > \frac{24\log N}{\varepsilon^2}$, if random matrix $A\in\mathbb{R}^{n\times m}$ is sampled from $\mathcal{N}(0,1/n)$, and $\varepsilon \in (0, 1)$ is a given constant, then with a probability of at least $\frac{N-2}{N}$, for all $i\neq j$, the following holds:
        \begin{equation}\left|\langle Av_i, Av_j\rangle - \langle v_i, v_j\rangle\right|\leq\varepsilon\end{equation}</p>
    </blockquote>

    <p>The proof is simple, mimicking the "Orthogonality Lemma." According to the proof of the JL Lemma, in the same conditions, there is a probability of at least $\frac{N-2}{N}$ that both of the following hold for all $i\neq j$:
    \begin{equation}\begin{aligned}
    (1-\varepsilon)\| v_i - v_j\|^2 \leq \| Av_i - A v_j\|^2 \leq (1+\varepsilon)\| v_i - v_j\|^2 \\
    (1-\varepsilon)\| v_i + v_j\|^2 \leq \| Av_i + A v_j\|^2 \leq (1+\varepsilon)\| v_i + v_j\|^2
    \end{aligned}\end{equation}
    Multiplying the first by $-1$ gives $-(1+\varepsilon)\| v_i - v_j\|^2 \leq -\| Av_i - A v_j\|^2 \leq -(1-\varepsilon)\| v_i - v_j\|^2$, then adding it to the second gives:
    \begin{equation}4\langle v_i, v_j\rangle-2\varepsilon(\| v_i\|^2 + \| v_j\|)\leq 4\langle Av_i, Av_j\rangle \leq 4\langle v_i, v_j\rangle + 2\varepsilon(\| v_i\|^2 + \| v_j\|)\end{equation}
    Since $v_i, v_j$ are unit vectors, the above simplifies to $|\langle Av_i, Av_j\rangle - \langle v_i, v_j\rangle|\leq\varepsilon$.</p>

    <h2>Extreme Sufficiency</h2>

    <p>Students who have gone through the proof of the JL Lemma can feel that the $\log N$ in the conclusion essentially arises because the probability term $2\exp\left(-\frac{\varepsilon^2 n}{8}\right)$ in the "Unit Norm Lemma" decays exponentially. We can relax this decay rate to polynomial decay, which results in $\log N$.</p>

    <p>Overall, the JL Lemma tells us that to fit $N$ vectors with error $\varepsilon$, you only need $\mathcal{O}\left(\frac{\log N}{\varepsilon^2}\right)$ dimensions. The specific constant in front is not that important. In fact, the JL Lemma provides a very sufficient condition; in practice, the conditions are often much looser. For instance, in the proof of the JL Lemma, if we change the condition to $n > \frac{16\log N}{\varepsilon^2}$, then the probability that equation $\eqref{eq:bound}$ holds is at least:
    \begin{equation}1 - N(N-1)\exp\left(-\frac{\varepsilon^2 n}{8}\right)\geq 1 - N(N-1)N^{-2}=1/N\end{equation}
    Note that while $1/N$ is small, it is still greater than 0, so there still exists an $A$ such that $\eqref{eq:bound}$ holds; it's just that the cost of finding $A$ is higher (the success rate is only $1/N$). If we only care about existence, then this is enough.</p>

    <p>Moreover, the JL Lemma only considers dimensionality reduction under random linear projection and reaches $n > \frac{16\log N}{\varepsilon^2}$. If we used more sophisticated reduction techniques, like SVD-based reduction, it is possible to get better results (smaller coefficients). If non-linear reduction methods are considered, results could be even better. Therefore, do not worry too much about the constant in $\frac{\log N}{\varepsilon^2}$. We only need to know the scale of $\mathcal{O}\left(\frac{\log N}{\varepsilon^2}\right)$. If you really need to use it, you usually determine the constant based on the actual situation rather than relying on the theoretical result.</p>

    <h2>To Be Continued</h2>

    <p>In this article, we introduced the Johnson–Lindenstrauss Lemma (JL Lemma), a miraculous and important conclusion about dimensionality reduction and a manifestation of the unusual nature of high-dimensional space. it tells us that "only $\mathcal{O}(\log N)$ dimensional space is needed to accommodate $N$ vectors," allowing high-dimensional retrieval problems to be transposed into $\mathcal{O}(\log N)$ dimensions.</p>

    <p>This article primarily discussed the details of the theoretical proof. In the next article, we will attempt to apply it to understand some machine learning problems. Stay tuned!</p>
</article>
<hr>
<footer style="margin-top: 3em; padding: 1.5em; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #555;">
    <p style="margin: 0 0 0.5em 0;"><strong>Citation</strong></p>
    <p style="margin: 0 0 0.5em 0;">
        This is a machine translation of the original Chinese article:<br>
        <a href="https://kexue.fm/archives/8679" style="color: #005fcc;">https://kexue.fm/archives/8679</a>
    </p>
    <p style="margin: 0 0 0.5em 0;">
        Original author: 苏剑林 (Su Jianlin)<br>
        Original publication: <a href="https://kexue.fm" style="color: #005fcc;">科学空间 (Scientific Spaces)</a>
    </p>
    <p style="margin: 0; font-style: italic;">
        Translated using Gemini 3 Flash. Please refer to the original for authoritative content.
    </p>
</footer>
